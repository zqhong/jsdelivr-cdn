(window.webpackJsonp=window.webpackJsonp||[]).push([[67],{Z209:function(e,t,r){"use strict";r.r(t);var s=r("KHwQ"),n=r.n(s),a=r("txxJ"),i=r("LvDl");class o{constructor(e,t,r){e.init=()=>{const t=e.target;t.namespace=t.namespace||"",t.metricName=t.metricName||"",t.statistics=t.statistics||["Average"],t.dimensions=t.dimensions||{},t.period=t.period||"",t.region=t.region||"default",t.id=t.id||"",t.expression=t.expression||"",e.regionSegment=r.getSegmentForValue(e.target.region,"select region"),e.namespaceSegment=r.getSegmentForValue(e.target.namespace,"select namespace"),e.metricSegment=r.getSegmentForValue(e.target.metricName,"select metric"),e.dimSegments=Object(i.reduce)(e.target.dimensions,(e,t,s)=>(e.push(r.newKey(s)),e.push(r.newOperator("=")),e.push(r.newKeyValue(t)),e),[]),e.statSegments=Object(i.map)(e.target.statistics,e=>r.getSegmentForValue(e)),e.ensurePlusButton(e.statSegments),e.ensurePlusButton(e.dimSegments),e.removeDimSegment=r.newSegment({fake:!0,value:"-- remove dimension --"}),e.removeStatSegment=r.newSegment({fake:!0,value:"-- remove stat --"}),Object(i.isEmpty)(e.target.region)&&(e.target.region="default"),e.onChange||(e.onChange=()=>{})},e.getStatSegments=()=>Promise.resolve(Object(i.flatten)([n.a.copy(e.removeStatSegment),Object(i.map)(e.datasource.standardStatistics,e=>r.getSegmentForValue(e)),r.getSegmentForValue("pNN.NN")])),e.statSegmentChanged=(t,r)=>{t.value===e.removeStatSegment.value?e.statSegments.splice(r,1):t.type="value",e.target.statistics=Object(i.reduce)(e.statSegments,(e,t)=>(t.fake||e.push(t.value),e),[]),e.ensurePlusButton(e.statSegments),e.onChange()},e.ensurePlusButton=e=>{const t=e.length,s=e[Math.max(t-1,0)];s&&"plus-button"===s.type||e.push(r.newPlusButton())},e.getDimSegments=(t,r)=>{if("operator"===t.type)return Promise.resolve([]);const s=e.target;let a=Promise.resolve([]);if("key"===t.type||"plus-button"===t.type)a=e.datasource.getDimensionKeys(e.target.namespace,e.target.region);else if("value"===t.type){const t=e.dimSegments[r-2].value;delete s.dimensions[t],a=e.datasource.getDimensionValues(s.region,s.namespace,s.metricName,t,s.dimensions)}return a.then(e.transformToSegments(!0)).then(r=>("key"===t.type&&r.splice(0,0,n.a.copy(e.removeDimSegment)),r))},e.dimSegmentChanged=(t,s)=>{e.dimSegments[s]=t,t.value===e.removeDimSegment.value?e.dimSegments.splice(s,3):"plus-button"===t.type&&(e.dimSegments.push(r.newOperator("=")),e.dimSegments.push(r.newFake("select dimension value","value","query-segment-value")),t.type="key",t.cssClass="query-segment-key"),e.syncDimSegmentsWithModel(),e.ensurePlusButton(e.dimSegments),e.onChange()},e.syncDimSegmentsWithModel=()=>{const t={},r=e.dimSegments.length;for(let s=0;s<r-2;s+=3){const r=e.dimSegments[s],n=e.dimSegments[s+2];n.fake||(t[r.value]=n.value)}e.target.dimensions=t},e.getRegions=()=>e.datasource.metricFindQuery("regions()").then(e=>(e.unshift({text:"default"}),e)).then(e.transformToSegments(!0)),e.getNamespaces=()=>e.datasource.metricFindQuery("namespaces()").then(e.transformToSegments(!0)),e.getMetrics=()=>e.datasource.metricFindQuery("metrics("+e.target.namespace+","+e.target.region+")").then(e.transformToSegments(!0)),e.regionChanged=()=>{e.target.region=e.regionSegment.value,e.onChange()},e.namespaceChanged=()=>{e.target.namespace=e.namespaceSegment.value,e.onChange()},e.metricChanged=()=>{e.target.metricName=e.metricSegment.value,e.onChange()},e.transformToSegments=e=>s=>{const n=Object(i.map)(s,e=>r.newSegment({value:e.text,expandable:e.expandable}));return e&&Object(i.each)(t.getVariables(),e=>{n.unshift(r.newSegment({type:"template",value:"$"+e.name,expandable:!0}))}),n},e.init()}}o.$inject=["$scope","templateSrv","uiSegmentSrv"],a.c.directive("cloudwatchQueryParameter",(function(){return{templateUrl:"public/app/plugins/datasource/cloudwatch/partials/query.parameter.html",controller:o,restrict:"E",scope:{target:"=",datasource:"=",onChange:"&"}}}));var l=r("Obii"),u=r("q1tI"),c=r.n(u),d=r("kDLi"),m=r("2Ie6"),p=r("WnbS"),g=r("iODs"),h=r("3SGO"),f=r("UvM7"),v=r("nKUr");function y(){return(y=Object.assign||function(e){for(var t=1;t<arguments.length;t++){var r=arguments[t];for(var s in r)Object.prototype.hasOwnProperty.call(r,s)&&(e[s]=r[s])}return e}).apply(this,arguments)}var b,S=r("F/XL"),x=r("p0ib"),j=r("909l"),O=r("XlPw"),w=r("6blF"),C=r("psW0"),R=r("VnD/"),A=r("67Y/"),N=r("9Z1F"),I=r("Phjn"),q=r("Nzu2"),F=r("S1nX"),D=r("dC0D"),T=r("xMyE"),M=r("jvbL"),P=r("2WpN"),E=r("t8hP"),L=r("GQ3c"),Q=r("5kRJ"),k=r("NPB1");const V=({region:e})=>Object(v.jsxs)("p",{children:["Please visit the ",Object(v.jsx)("a",{target:"_blank",rel:"noreferrer",className:"text-link",href:`https://${e}.console.aws.amazon.com/servicequotas/home?region=${e}#!/services/monitoring/quotas/L-5E141212`,children:"AWS Service Quotas console"})," to request a quota increase or see our ",b||(b=Object(v.jsx)("a",{target:"_blank",rel:"noreferrer",className:"text-link",href:"https://grafana.com/docs/grafana/latest/datasources/cloudwatch/#service-quotas",children:"documentation"}))," to learn more."]});var G=(e,t=7e3)=>{const r=Object(i.memoize)((...r)=>Object(i.debounce)(e,t,{leading:!0}),(...e)=>JSON.stringify(e));return(...e)=>r(...e)(...e)};let _;!function(e){e.Scheduled="Scheduled",e.Running="Running",e.Complete="Complete",e.Failed="Failed",e.Cancelled="Cancelled",e.Timeout="Timeout"}(_||(_={}));var B=r("bnqK"),U=r("wZee"),W=r.n(U);function $(e,t,r){return t in e?Object.defineProperty(e,t,{value:r,enumerable:!0,configurable:!0,writable:!0}):e[t]=r,e}class K extends l.LanguageProvider{constructor(e,t){super(),$(this,"started",!1),$(this,"datasource",void 0),$(this,"cleanText",e=>e.replace(/[()]/g,"").trim()),$(this,"request",(e,t)=>this.datasource.awsRequest(e,t).toPromise()),$(this,"start",()=>(this.startTask||(this.startTask=Promise.resolve().then(()=>(this.started=!0,[]))),this.startTask)),$(this,"fetchedFieldsCache",void 0),$(this,"fetchFields",async e=>{if(this.fetchedFieldsCache&&Date.now()-this.fetchedFieldsCache.time<3e4&&Object(i.sortedUniq)(this.fetchedFieldsCache.logGroups).join("|")===Object(i.sortedUniq)(e).join("|"))return this.fetchedFieldsCache.fields;const t=await Promise.all(e.map(e=>this.datasource.getLogGroupFields({logGroupName:e}))),r=[...new Set(t.reduce((e,t)=>{var r;return e.concat(null===(r=t.logGroupFields)||void 0===r?void 0:r.map(e=>e.name))},[])).values()];return this.fetchedFieldsCache={time:Date.now(),logGroups:e,fields:r},r}),$(this,"handleKeyword",async e=>{var t;const r=await this.getFieldCompletionItems(null!==(t=null==e?void 0:e.logGroupNames)&&void 0!==t?t:[]),s=[{searchFunctionType:d.SearchFunctionType.Prefix,label:"Functions",items:B.h.concat(B.c,B.e)}];return r.suggestions.push(...s),r}),$(this,"handleCommand",async(e,t,r)=>{var s;const n=e.content.toLowerCase(),a=z(t),i=a===e;if("sort"===n)return this.handleSortCommand(i,t,r);var o;if("parse"===n&&i)return await this.getFieldCompletionItems(null!==(o=null==r?void 0:r.logGroupNames)&&void 0!==o?o:[]);const l=Z(e.next,"whitespace")&&!(null!==(s=e.next)&&void 0!==s&&s.next),u=l||function(e){let t=e;for(;t.next;){if(!t.next.types.includes("whitespace"))return t.next;t=t.next}return null}(e)===t,c=Z(t,"punctuation",","),d=c||Z(a,"punctuation",",");if(!u&&!d)return{suggestions:[]};if(["display","fields"].includes(n)){var m;const e=await this.getFieldCompletionItems(null!==(m=null==r?void 0:r.logGroupNames)&&void 0!==m?m:[]);return e.suggestions.push(...this.getFieldAndFilterFunctionCompletionItems().suggestions),e}if("stats"===n){const e=this.getStatsAggCompletionItems();return(c||l)&&(null==e||e.suggestions.forEach(e=>{e.skipFilter=!0})),e}if("filter"===n&&i){var p;const e=await this.getFieldCompletionItems(null!==(p=null==r?void 0:r.logGroupNames)&&void 0!==p?p:[]),t=this.getBoolFuncCompletionItems();return e.suggestions.push(...t.suggestions),e}return{suggestions:[]}}),$(this,"handleComparison",async e=>{var t;const r=await this.getFieldCompletionItems(null!==(t=null==e?void 0:e.logGroupNames)&&void 0!==t?t:[]),s=this.getComparisonCompletionItems();return r.suggestions.push(...s.suggestions),r}),$(this,"getCommandCompletionItems",()=>({suggestions:[{searchFunctionType:d.SearchFunctionType.Prefix,label:"Commands",items:B.g}]})),$(this,"getFieldAndFilterFunctionCompletionItems",()=>({suggestions:[{searchFunctionType:d.SearchFunctionType.Prefix,label:"Functions",items:B.d}]})),$(this,"getStatsAggCompletionItems",()=>({suggestions:[{searchFunctionType:d.SearchFunctionType.Prefix,label:"Functions",items:B.a}]})),$(this,"getBoolFuncCompletionItems",()=>({suggestions:[{searchFunctionType:d.SearchFunctionType.Prefix,label:"Functions",items:B.b}]})),$(this,"getComparisonCompletionItems",()=>({suggestions:[{searchFunctionType:d.SearchFunctionType.Prefix,label:"Functions",items:B.f.concat(B.b)}]})),$(this,"getFieldCompletionItems",async e=>({suggestions:[{label:"Fields",items:(await this.fetchFields(e)).map(e=>({label:e,insertText:e.match(/@?[_a-zA-Z]+[_.0-9a-zA-Z]*/)?void 0:`\`${e}\``}))}]})),this.datasource=e,Object.assign(this,t)}getSyntax(){return B.i}isStatsQuery(e){var t;const r=this.getSyntax();return!!(null!==(t=W.a.tokenize(e,r))&&void 0!==t?t:[]).find(e=>"string"!=typeof e&&"stats"===e.content.toString().toLowerCase()&&"query-command"===e.type)}async provideCompletionItems(e,t){const{value:r}=e,s=null==r?void 0:r.data.get("tokens");if(!s||!s.length)return{suggestions:[]};const n=s.filter(e=>{var t,s,n,a;return e.offsets.start<=(null===(t=r.selection)||void 0===t||null===(s=t.start)||void 0===s?void 0:s.offset)&&e.offsets.end>=(null===(n=r.selection)||void 0===n||null===(a=n.start)||void 0===a?void 0:a.offset)})[0],a=!n.prev,i=z(n);if(a||!a&&(null==i?void 0:i.types.includes("command-separator")))return this.getCommandCompletionItems();var o;if(function(e){const t=z(e);if(!t)return!1;const r="("===e.content?e:"("===t.content?t:void 0;if(r){const e=z(r);if(e)return J.includes(e.content.toLowerCase())&&e.types.includes("function")}return!1}(n))return await this.getFieldCompletionItems(null!==(o=null==t?void 0:t.logGroupNames)&&void 0!==o?o:[]);if(function(e,t){const r=H(t,["whitespace","function","punctuation","field-name","number"]);if(Z(r,"keyword","by")){const e=H(t,["whitespace"]);if(e===r||Z(e,"punctuation",","))return!0}return!1}(0,n))return this.handleKeyword(t);if(null!=i&&i.types.includes("comparison-operator"))return this.handleComparison(t);const l=function(e){let t=e;for(;t.prev;)if(t=t.prev,t.types.includes("query-command")&&(!t.prev||Z(z(t),"command-separator")))return t;return null}(n);return l?await this.handleCommand(l,n,t):{suggestions:[]}}async handleSortCommand(e,t,r){var s;return e?await this.getFieldCompletionItems(null!==(s=null==r?void 0:r.logGroupNames)&&void 0!==s?s:[]):Z(z(t),"field-name")?{suggestions:[{searchFunctionType:d.SearchFunctionType.Prefix,label:"Sort Order",items:[{label:"asc"},{label:"desc"}]}]}:{suggestions:[]}}}function z(e){let t=e;for(;t.prev;){if(!Z(t.prev,"whitespace"))return t.prev;t=t.prev}return null}const J=["avg","count","count_distinct","earliest","latest","sortsFirst","sortsLast","max","min","pct","stddev","ispresent","fromMillis","toMillis","isempty","isblank","isValidIp","isValidIpV4","isValidIpV6","isIpInSubnet","isIpv4InSubnet","isIpv6InSubnet"].map(e=>e.toLowerCase());function Z(e,t,r){return!(null==e||!e.types.includes(t))&&(!r||(null==e?void 0:e.content.toLowerCase())===r)}function H(e,t){let r=e.prev;e:for(;r;){for(const e of t)if("string"==typeof e){if(r.types.includes(e)){r=r.prev;continue e}}else if(r.types.includes(e.type)&&r.content.toLowerCase()===e.value){r=r.prev;continue e}break}return r}var X=r("R37w"),Y=r("T1DM");function ee(e){const{subscriber:t,counter:r,period:s,step:n,endPeriod:a}=e;t.next(r);const i=Math.min(s+n,a);this.schedule({subscriber:t,counter:r+1,period:i,step:n,endPeriod:a},i)}var te=r("Dw54"),re=r("ZFWI");function se(){return(se=Object.assign||function(e){for(var t=1;t<arguments.length;t++){var r=arguments[t];for(var s in r)Object.prototype.hasOwnProperty.call(r,s)&&(e[s]=r[s])}return e}).apply(this,arguments)}function ne(e,t,r){return t in e?Object.defineProperty(e,t,{value:r,enumerable:!0,configurable:!0,writable:!0}):e[t]=r,e}const ae=(e,t)=>g.d.dispatch(Object(h.b)(Object(f.a)(`CloudWatch request limit reached in ${t} for data source ${e}`,"",c.a.createElement(V,{region:t},null)))),ie=(e,t)=>g.d.dispatch(Object(h.b)(Object(f.a)(e,t)));class oe extends E.DataSourceWithBackend{constructor(e,t=Object(Q.a)(),r=Object(k.a)()){super(e),ne(this,"proxyUrl",void 0),ne(this,"defaultRegion",void 0),ne(this,"datasourceName",void 0),ne(this,"languageProvider",void 0),ne(this,"type","cloudwatch"),ne(this,"standardStatistics",["Average","Maximum","Minimum","Sum","SampleCount"]),ne(this,"debouncedAlert",G(ae,L.c.Error)),ne(this,"debouncedCustomAlert",G(ie,L.c.Error)),ne(this,"logQueries",{}),ne(this,"handleLiveLogQueries",(e,t)=>{const r=e.filter(e=>{var t;return null===(t=e.logGroupNames)||void 0===t?void 0:t.length});if(e.length>r.length)return Object(S.a)({data:[],error:{message:"Log group is required"}});if(Object(i.isEmpty)(r))return Object(S.a)({data:[],state:l.LoadingState.Done});const s=r.map(e=>{var r;return{intervalMs:1,maxDataPoints:1,datasourceId:this.id,queryString:this.replace(e.expression,t.scopedVars,!0),refId:e.refId,logGroupNames:null===(r=e.logGroupNames)||void 0===r?void 0:r.map(e=>this.replace(e,t.scopedVars,!0,"log groups")),statsGroups:e.statsGroups,region:this.getActualRegion(this.replace(e.region,t.scopedVars,!0,"region")),type:"liveLogAction"}}),n=this.timeSrv.timeRange(),a={from:n.from.valueOf().toString(),to:n.to.valueOf().toString(),queries:s};return this.awsRequest("/api/ds/query",a).pipe(Object(C.b)(e=>{const r=Object(E.toDataQueryResponse)({data:e},t.targets).data[0].meta.custom.channelName;return Object(E.getGrafanaLiveSrv)().getStream({scope:l.LiveChannelScope.Plugin,namespace:"cloudwatch",path:r})}),Object(R.a)(e=>"message"===e.type),Object(A.a)(({message:e})=>{const r=Object(E.toDataQueryResponse)({data:e});return r.state=r.data.every(e=>{var t,r,s;return s=null===(t=e.meta)||void 0===t||null===(r=t.custom)||void 0===r?void 0:r.Status,[_.Complete,_.Cancelled,_.Failed,_.Timeout].includes(s)})?l.LoadingState.Done:l.LoadingState.Loading,r.key=e.results[Object.keys(e.results)[0]].refId,this.addDataLinksToLogsResponse(r,t)}),Object(N.a)(e=>{var t;if(null!==(t=e.data)&&void 0!==t&&t.error)throw e.data.error;throw e}))}),ne(this,"handleLogQueries",(e,t)=>{const r=e.filter(e=>{var t;return null===(t=e.logGroupNames)||void 0===t?void 0:t.length});if(e.length>r.length)return Object(S.a)({data:[],error:{message:"Log group is required"}});if(Object(i.isEmpty)(r))return Object(S.a)({data:[],state:l.LoadingState.Done});const s=r.map(e=>({queryString:e.expression,refId:e.refId,logGroupNames:e.logGroupNames,region:this.replace(this.getActualRegion(e.region),t.scopedVars,!0,"region")}));return this.makeLogActionRequest("StartQuery",s,t.scopedVars).pipe(Object(C.b)(t=>this.logsQuery(t.map(t=>{var r,s,n;return{queryId:t.fields[0].values.get(0),region:null!==(r=null===(s=t.meta)||void 0===s||null===(n=s.custom)||void 0===n?void 0:n.Region)&&void 0!==r?r:"default",refId:t.refId,statsGroups:e.find(e=>e.refId===t.refId).statsGroups}}))),Object(A.a)(e=>this.addDataLinksToLogsResponse(e,t)))}),ne(this,"handleMetricQueries",(e,t)=>{var r,s;const n=e.filter(e=>{var t;return!!e.region&&!!e.namespace&&!!e.metricName&&!Object(i.isEmpty)(e.statistics)||(null===(t=e.expression)||void 0===t?void 0:t.length)>0}).map(e=>{e.region=this.replace(this.getActualRegion(e.region),t.scopedVars,!0,"region"),e.namespace=this.replace(e.namespace,t.scopedVars,!0,"namespace"),e.metricName=this.replace(e.metricName,t.scopedVars,!0,"metric name"),e.dimensions=this.convertDimensionFormat(e.dimensions,t.scopedVars),e.statistics=e.statistics.map(e=>this.replace(e,t.scopedVars,!0,"statistics")),e.period=String(this.getPeriod(e,t)),e.id=this.templateSrv.replace(e.id,t.scopedVars),e.expression=this.templateSrv.replace(e.expression,t.scopedVars);if(e.statistics.some(e=>{if(0===e.indexOf("p")){const t=/^p\d{2}(?:\.\d{1,2})?$/.exec(e);return!t||t[0]!==e}return!1}))throw{message:"Invalid extended statistics"};return se({intervalMs:t.intervalMs,maxDataPoints:t.maxDataPoints,datasourceId:this.id,type:"timeSeriesQuery"},e)});if(Object(i.isEmpty)(n))return Object(S.a)({data:[]});const a={from:null==t||null===(r=t.range)||void 0===r?void 0:r.from.valueOf().toString(),to:null==t||null===(s=t.range)||void 0===s?void 0:s.to.valueOf().toString(),queries:n};return this.performTimeSeriesQuery(a,t.range)}),ne(this,"getLogRowContext",async(e,{limit:t=10,direction:r="BACKWARD"}={})=>{let s=null,n=null;for(const t of e.dataFrame.fields)if("__logstream__grafana_internal__"===t.name){if(s=t,null!==n)break}else if("__log__grafana_internal__"===t.name&&(n=t,null!==s))break;const a={limit:t,startFromHead:"BACKWARD"!==r,logGroupName:le(n.values.get(e.rowIndex)),logStreamName:s.values.get(e.rowIndex)};"BACKWARD"===r?a.endTime=e.timeEpochMs:a.startTime=e.timeEpochMs;return{data:await this.makeLogActionRequest("GetLogEvents",[a]).toPromise()}}),ne(this,"getTargetsByQueryMode",e=>{const t=[],r=[];return e.forEach(e=>{var s;"Logs"===(null!==(s=e.queryMode)&&void 0!==s?s:"Metrics")?t.push(e):r.push(e)}),{logQueries:t,metricsQueries:r}}),this.templateSrv=t,this.timeSrv=r,this.proxyUrl=e.url,this.defaultRegion=e.jsonData.defaultRegion,this.datasourceName=e.name,this.languageProvider=new K(this)}query(e){let t=(e=n.a.copy(e)).targets.filter(e=>""!==e.id||!0!==e.hide);const{logQueries:r,metricsQueries:s}=this.getTargetsByQueryMode(t),a=[];return r.length>0&&(re.b.liveEnabled?a.push(this.handleLiveLogQueries(r,e)):a.push(this.handleLogQueries(r,e))),s.length>0&&a.push(this.handleMetricQueries(s,e)),Object(i.isEmpty)(a)?Object(S.a)({data:[],state:l.LoadingState.Done}):Object(x.a)(...a)}logsQuery(e){this.logQueries={},e.forEach(e=>{var t,r,s;this.logQueries[e.refId]={id:e.queryId,region:e.region,statsQuery:null!==(t=(null!==(r=null===(s=e.statsGroups)||void 0===s?void 0:s.length)&&void 0!==r?r:0)>0)&&void 0!==t&&t}});const t=(({startPeriod:e=0,endPeriod:t=5e3,step:r=1e3},s=Y.b)=>new w.a(n=>(n.add(s.schedule(ee,e,{subscriber:n,counter:0,period:e,step:r,endPeriod:t})),n)))({startPeriod:100,endPeriod:1e3,step:300}).pipe(Object(I.a)(t=>this.makeLogActionRequest("GetQueryResults",e)),Object(q.a)(),Object(F.a)()),r=t.pipe(Object(D.a)(({failures:e,prevRecordsMatched:t},r)=>{e++;for(const o of r){var s,n,a,i;const r=null===(s=o.meta)||void 0===s||null===(n=s.stats)||void 0===n||null===(a=n.find(e=>"Records scanned"===e.displayName))||void 0===a?void 0:a.value;r>(null!==(i=t[o.refId])&&void 0!==i?i:0)&&(e=0),t[o.refId]=r}return{failures:e,prevRecordsMatched:t}},{failures:0,prevRecordsMatched:{}}),Object(A.a)(({failures:e})=>e),Object(F.a)()),s=Object(j.b)(t,r).pipe(Object(T.a)(([e])=>{for(const s of e){var t,r;[_.Complete,_.Cancelled,_.Failed].includes(null===(t=s.meta)||void 0===t||null===(r=t.custom)||void 0===r?void 0:r.Status)&&this.logQueries.hasOwnProperty(s.refId)&&delete this.logQueries[s.refId]}}),Object(A.a)(([e,t])=>{if(t>=5)for(const t of e)Object(i.set)(t,"meta.custom.Status",_.Cancelled);return{data:e,key:"test-key",state:e.every(e=>{var t,r;return[_.Complete,_.Cancelled,_.Failed].includes(null===(t=e.meta)||void 0===t||null===(r=t.custom)||void 0===r?void 0:r.Status)})?l.LoadingState.Done:l.LoadingState.Loading,error:t>=5?{message:"error: query timed out after 5 attempts",type:l.DataQueryErrorType.Timeout}:void 0}}),Object(M.a)(({state:e})=>e!==l.LoadingState.Error&&e!==l.LoadingState.Done,!0));return n=s,a=()=>this.stopQueries(),new w.a(e=>{const t=n.subscribe({next:t=>e.next(t),error:t=>e.next(t),complete:()=>e.complete()});return()=>{t.unsubscribe(),a()}});var n,a}addDataLinksToLogsResponse(e,t){for(const n of e.data){var r,s;const e=this.timeSrv.timeRange(),a=e.from.toISOString(),i=e.to.toISOString(),o=t.targets.find(e=>e.refId===n.refId),l=null!==(r=null===(s=o.logGroupNames)||void 0===s?void 0:s.map(e=>this.replace(e,t.scopedVars,!0,"log groups")))&&void 0!==r?r:[],u={end:i,start:a,timeType:"ABSOLUTE",tz:"UTC",editorString:o.expression?this.replace(o.expression,t.scopedVars,!0):"",isLiveTail:!1,source:l},c=Object(X.a)(u,this.getActualRegion(this.replace(o.region,t.scopedVars,!0,"region")));for(const e of n.fields)e.config.links=[{url:c,title:"View in CloudWatch console",targetBlank:!0}]}return e}stopQueries(){Object.keys(this.logQueries).length>0&&this.makeLogActionRequest("StopQuery",Object.values(this.logQueries).map(e=>({queryId:e.id,region:e.region})),void 0,!1).pipe(Object(P.a)(()=>{this.logQueries={}}))}async describeLogGroups(e){var t,r,s;return null!==(t=null===(r=(await this.makeLogActionRequest("DescribeLogGroups",[e]).toPromise())[0])||void 0===r||null===(s=r.fields[0])||void 0===s?void 0:s.values.toArray())&&void 0!==t?t:[]}async getLogGroupFields(e){var t;const r=await this.makeLogActionRequest("GetLogGroupFields",[e]).toPromise(),s=r[0].fields[0].values.toArray(),n=r[0].fields[1].values.toArray();return{logGroupFields:null!==(t=s.map((e,t)=>({name:e,percent:n[t]})))&&void 0!==t?t:[]}}getVariables(){return this.templateSrv.getVariables().map(e=>"$"+e.name)}getPeriod(e,t){let r=this.templateSrv.replace(e.period,t.scopedVars);return r&&"auto"!==r.toLowerCase()&&(r=/^\d+$/.test(r)?parseInt(r,10):l.rangeUtil.intervalToSeconds(r),r<1&&(r=1)),r||""}performTimeSeriesQuery(e,{from:t,to:r}){return this.awsRequest("/api/ds/query",e).pipe(Object(A.a)(e=>{const t=Object(E.toDataQueryResponse)({data:e}).data;return!t||t.length<=0?{data:[]}:{data:t,error:Object.values(e.results).reduce((e,t)=>t.error?{message:t.error}:e,null)}}),Object(N.a)(t=>{if(/^Throttling:.*/.test(t.data.message)){const r=Object.keys(t.data.results);Object.values(e.queries).reduce((e,{refId:t,region:s})=>t&&!r.includes(t)||e.includes(s)?e:[...e,s],[]).forEach(e=>this.debouncedAlert(this.datasourceName,this.getActualRegion(e)))}return t.data&&"Metric request error"===t.data.message&&t.data.error&&(t.data.message=t.data.error),Object(O.a)(t)}))}transformSuggestDataFromDataframes(e){const t=Object(E.toDataQueryResponse)({data:e}).data;return Object(l.toLegacyResponseData)(t[0]).rows.map(([e,t])=>({text:e,value:t,label:t}))}doMetricQueryRequest(e,t){const r=this.timeSrv.timeRange();return this.awsRequest("/api/ds/query",{from:r.from.valueOf().toString(),to:r.to.valueOf().toString(),queries:[se({refId:"metricFindQuery",intervalMs:1,maxDataPoints:1,datasourceId:this.id,type:"metricFindQuery",subtype:e},t)]}).pipe(Object(A.a)(e=>this.transformSuggestDataFromDataframes(e))).toPromise()}makeLogActionRequest(e,t,r,s=!0){const n=this.timeSrv.timeRange(),a={from:n.from.valueOf().toString(),to:n.to.valueOf().toString(),queries:t.map(t=>se({refId:"A",intervalMs:1,maxDataPoints:1,datasourceId:this.id,type:"logAction",subtype:e},t))};s&&a.queries.forEach(e=>{e.hasOwnProperty("queryString")&&(e.queryString=this.replace(e.queryString,r,!0)),e.region=this.replace(e.region,r,!0,"region"),e.region=this.getActualRegion(e.region),e.logGroupNames&&(e.logGroupNames=e.logGroupNames.map(e=>this.replace(e,r,!0,"log groups")))});return this.awsRequest("/api/ds/query",a).pipe(Object(A.a)(e=>{return t={data:e},Object(E.toDataQueryResponse)(t).data||[];var t}),Object(N.a)(e=>{var t,r;if(null!==(t=e.data)&&void 0!==t&&t.error)throw e.data.error;if(null!==(r=e.data)&&void 0!==r&&r.message)throw e.data.message;throw e}))}getRegions(){return this.doMetricQueryRequest("regions",null).then(e=>[{label:"default",value:"default",text:"default"},...e])}getNamespaces(){return this.doMetricQueryRequest("namespaces",null)}async getMetrics(e,t){return e?this.doMetricQueryRequest("metrics",{region:this.templateSrv.replace(this.getActualRegion(t)),namespace:this.templateSrv.replace(e)}):[]}async getDimensionKeys(e,t){return e?this.doMetricQueryRequest("dimension_keys",{region:this.templateSrv.replace(this.getActualRegion(t)),namespace:this.templateSrv.replace(e)}):[]}async getDimensionValues(e,t,r,s,n){if(!t||!r)return[];return await this.doMetricQueryRequest("dimension_values",{region:this.templateSrv.replace(this.getActualRegion(e)),namespace:this.templateSrv.replace(t),metricName:this.templateSrv.replace(r.trim()),dimensionKey:this.templateSrv.replace(s),dimensions:this.convertDimensionFormat(n,{})})}getEbsVolumeIds(e,t){return this.doMetricQueryRequest("ebs_volume_ids",{region:this.templateSrv.replace(this.getActualRegion(e)),instanceId:this.templateSrv.replace(t)})}getEc2InstanceAttribute(e,t,r){return this.doMetricQueryRequest("ec2_instance_attribute",{region:this.templateSrv.replace(this.getActualRegion(e)),attributeName:this.templateSrv.replace(t),filters:r})}getResourceARNs(e,t,r){return this.doMetricQueryRequest("resource_arns",{region:this.templateSrv.replace(this.getActualRegion(e)),resourceType:this.templateSrv.replace(t),tags:r})}async metricFindQuery(e){let t,r,s,n;if(e.match(/^regions\(\)/))return this.getRegions();if(e.match(/^namespaces\(\)/))return this.getNamespaces();const a=e.match(/^metrics\(([^\)]+?)(,\s?([^,]+?))?\)/);if(a)return r=a[1],t=a[3],this.getMetrics(r,t);const i=e.match(/^dimension_keys\(([^\)]+?)(,\s?([^,]+?))?\)/);if(i)return r=i[1],t=i[3],this.getDimensionKeys(r,t);const o=e.match(/^dimension_values\(([^,]+?),\s?([^,]+?),\s?([^,]+?),\s?([^,]+?)(,\s?(.+))?\)/);if(o){t=o[1],r=o[2],s=o[3];const e=o[4];return n={},o[6]&&(n=JSON.parse(this.templateSrv.replace(o[6]))),this.getDimensionValues(t,r,s,e,n)}const l=e.match(/^ebs_volume_ids\(([^,]+?),\s?([^,]+?)\)/);if(l){t=l[1];const e=l[2];return this.getEbsVolumeIds(t,e)}const u=e.match(/^ec2_instance_attribute\(([^,]+?),\s?([^,]+?),\s?(.+?)\)/);if(u){t=u[1];const e=u[2];return n=JSON.parse(this.templateSrv.replace(u[3])),this.getEc2InstanceAttribute(t,e,n)}const c=e.match(/^resource_arns\(([^,]+?),\s?([^,]+?),\s?(.+?)\)/);if(c){t=c[1];const e=c[2],r=JSON.parse(this.templateSrv.replace(c[3]));return this.getResourceARNs(t,e,r)}return e.match(/^statistics\(\)/)?this.standardStatistics.map(e=>({value:e,label:e,text:e})):Promise.resolve([])}annotationQuery(e){const t=e.annotation,r=t.statistics.map(e=>this.templateSrv.replace(e)),s=t.prefixMatching?"":"300";let n=t.period||s;n=parseInt(n,10);const a={prefixMatching:t.prefixMatching,region:this.templateSrv.replace(this.getActualRegion(t.region)),namespace:this.templateSrv.replace(t.namespace),metricName:this.templateSrv.replace(t.metricName),dimensions:this.convertDimensionFormat(t.dimensions,{}),statistics:r,period:n,actionPrefix:t.actionPrefix||"",alarmNamePrefix:t.alarmNamePrefix||""};return this.awsRequest("/api/ds/query",{from:e.range.from.valueOf().toString(),to:e.range.to.valueOf().toString(),queries:[se({refId:"annotationQuery",datasourceId:this.id,type:"annotationQuery"},a)]}).pipe(Object(A.a)(e=>{const r=Object(E.toDataQueryResponse)({data:e}).data;return Object(l.toLegacyResponseData)(r[0]).rows.map(e=>({annotation:t,time:Date.parse(e[0]),title:e[1],tags:[e[2]],text:e[3]}))})).toPromise()}targetContainsTemplate(e){var t;return this.templateSrv.variableExists(e.region)||this.templateSrv.variableExists(e.namespace)||this.templateSrv.variableExists(e.metricName)||this.templateSrv.variableExists(e.expression)||(null===(t=e.logGroupNames)||void 0===t?void 0:t.some(e=>this.templateSrv.variableExists(e)))||Object(i.find)(e.dimensions,(e,t)=>this.templateSrv.variableExists(t)||this.templateSrv.variableExists(e))}async testDatasource(){const e=this.defaultRegion,t={};try{return await this.getDimensionValues(e,"AWS/Billing","EstimatedCharges","ServiceName",t),{status:"success",message:"Data source is working"}}catch(e){return Object(te.f)(e)}}awsRequest(e,t){const r={method:"POST",url:e,data:t};return Object(E.getBackendSrv)().fetch(r).pipe(Object(A.a)(e=>e.data))}getDefaultRegion(){return this.defaultRegion}getActualRegion(e){return"default"===e||void 0===e||""===e?this.getDefaultRegion():e}showContextToggle(){return!0}convertToCloudWatchTime(e,t){return Object(i.isString)(e)&&(e=l.dateMath.parse(e,t)),Math.round(e.valueOf()/1e3)}convertDimensionFormat(e,t){return Object.entries(e).reduce((e,[r,s])=>{if(r=this.replace(r,t,!0,"dimension keys"),Array.isArray(s))return se({},e,{[r]:s});const n=this.templateSrv.getVariables().find(({name:e})=>e===this.templateSrv.getVariableName(s));if(n){if(n.multi){return se({},e,{[r]:this.templateSrv.replace(s,t,"pipe").split("|")})}return se({},e,{[r]:[this.templateSrv.replace(s,t)]})}return se({},e,{[r]:[s]})},{})}replace(e,t,r,s){if(r&&e){const t=this.templateSrv.getVariables().find(({name:t})=>t===this.templateSrv.getVariableName(e));t&&t.multi&&this.debouncedCustomAlert("CloudWatch templating error","Multi template variables are not supported for "+(s||e))}return this.templateSrv.replace(e,t)}getQueryDisplayText(e){var t;return"Logs"===e.queryMode?null!==(t=e.expression)&&void 0!==t?t:"":JSON.stringify(e)}interpolateVariablesInQueries(e,t){return e.length?e.map(e=>se({},e,{region:this.getActualRegion(this.replace(e.region,t)),expression:this.replace(e.expression,t)},!("Logs"===e.queryMode)&&this.interpolateMetricsQueryVariables(e,t))):e}interpolateMetricsQueryVariables(e,t){return{alias:this.replace(e.alias,t),metricName:this.replace(e.metricName,t),namespace:this.replace(e.namespace,t),period:this.replace(e.period,t),dimensions:Object.entries(e.dimensions).reduce((e,[r,s])=>Array.isArray(s)?se({},e,{[r]:s}):se({},e,{[this.replace(r,t)]:this.replace(s,t)}),{})}}}function le(e){const t=e.lastIndexOf(":");return e.substr(t+1)}class ue{constructor(e){this.annotation=e.ctrl.annotation,Object(i.defaultsDeep)(this.annotation,{namespace:"",metricName:"",expression:"",dimensions:{},region:"default",id:"",alias:"",statistics:["Average"],matchExact:!0,prefixMatching:!1,actionPrefix:"",alarmNamePrefix:""}),this.onChange=this.onChange.bind(this)}onChange(e){Object.assign(this.annotation,e)}}var ce,de,me;ue.$inject=["$scope"],me="partials/annotations.editor.html",(de="templateUrl")in(ce=ue)?Object.defineProperty(ce,de,{value:me,enumerable:!0,configurable:!0,writable:!0}):ce[de]=me;var pe,ge,he=r("ftg2"),fe=r("NIg9"),ve=function(){function e(e,t){for(var r=0;r<t.length;r++){var s=t[r];s.enumerable=s.enumerable||!1,s.configurable=!0,"value"in s&&(s.writable=!0),Object.defineProperty(e,s.key,s)}}return function(t,r,s){return r&&e(t.prototype,r),s&&e(t,s),t}}(),ye=(pe=["",""],ge=["",""],Object.freeze(Object.defineProperties(pe,{raw:{value:Object.freeze(ge)}})));function be(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}var Se=function(){function e(){for(var t=this,r=arguments.length,s=Array(r),n=0;n<r;n++)s[n]=arguments[n];return be(this,e),this.tag=function(e){for(var r=arguments.length,s=Array(r>1?r-1:0),n=1;n<r;n++)s[n-1]=arguments[n];return"function"==typeof e?t.interimTag.bind(t,e):"string"==typeof e?t.transformEndResult(e):(e=e.map(t.transformString.bind(t)),t.transformEndResult(e.reduce(t.processSubstitutions.bind(t,s))))},s.length>0&&Array.isArray(s[0])&&(s=s[0]),this.transformers=s.map((function(e){return"function"==typeof e?e():e})),this.tag}return ve(e,[{key:"interimTag",value:function(e,t){for(var r=arguments.length,s=Array(r>2?r-2:0),n=2;n<r;n++)s[n-2]=arguments[n];return this.tag(ye,e.apply(void 0,[t].concat(s)))}},{key:"processSubstitutions",value:function(e,t,r){var s=this.transformSubstitution(e.shift(),t);return"".concat(t,s,r)}},{key:"transformString",value:function(e){return this.transformers.reduce((function(e,t){return t.onString?t.onString(e):e}),e)}},{key:"transformSubstitution",value:function(e,t){return this.transformers.reduce((function(e,r){return r.onSubstitution?r.onSubstitution(e,t):e}),e)}},{key:"transformEndResult",value:function(e){return this.transformers.reduce((function(e,t){return t.onEndResult?t.onEndResult(e):e}),e)}}]),e}(),xe=function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:"";return{onEndResult:function(t){if(""===e)return t.trim();if("start"===(e=e.toLowerCase())||"left"===e)return t.replace(/^\s*/,"");if("end"===e||"right"===e)return t.replace(/\s*$/,"");throw new Error("Side not supported: "+e)}}};function je(e){if(Array.isArray(e)){for(var t=0,r=Array(e.length);t<e.length;t++)r[t]=e[t];return r}return Array.from(e)}var Oe,we,Ce=function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:"initial";return{onEndResult:function(t){if("initial"===e){var r=t.match(/^[^\S\n]*(?=\S)/gm),s=r&&Math.min.apply(Math,je(r.map((function(e){return e.length}))));if(s){var n=new RegExp("^.{"+s+"}","gm");return t.replace(n,"")}return t}if("all"===e)return t.replace(/^[^\S\n]+/gm,"");throw new Error("Unknown type: "+e)}}},Re=function(e,t){return{onEndResult:function(r){if(null==e||null==t)throw new Error("replaceResultTransformer requires at least 2 arguments.");return r.replace(e,t)}}},Ae=function(e,t){return{onSubstitution:function(r,s){if(null==e||null==t)throw new Error("replaceSubstitutionTransformer requires at least 2 arguments.");return null==r?r:r.toString().replace(e,t)}}},Ne={separator:"",conjunction:"",serial:!1},Ie=function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:Ne;return{onSubstitution:function(t,r){if(Array.isArray(t)){var s=t.length,n=e.separator,a=e.conjunction,i=e.serial,o=r.match(/(\n?[^\S\n]+)$/);if(t=o?t.join(n+o[1]):t.join(n+" "),a&&s>1){var l=t.lastIndexOf(n);t=t.slice(0,l)+(i?n:"")+" "+a+t.slice(l+1)}}return t}}},qe=function(e){return{onSubstitution:function(t,r){if(null==e||"string"!=typeof e)throw new Error("You need to specify a string character to split by.");return"string"==typeof t&&t.includes(e)&&(t=t.split(e)),t}}},Fe=function(e){return null!=e&&!Number.isNaN(e)&&"boolean"!=typeof e},De=function(){return{onSubstitution:function(e){return Array.isArray(e)?e.filter(Fe):Fe(e)?e:""}}},Te=(new Se(Ie({separator:","}),Ce,xe),new Se(Ie({separator:",",conjunction:"and"}),Ce,xe),new Se(Ie({separator:",",conjunction:"or"}),Ce,xe),new Se(qe("\n"),De,Ie,Ce,xe),new Se(qe("\n"),Ie,Ce,xe,Ae(/&/g,"&amp;"),Ae(/</g,"&lt;"),Ae(/>/g,"&gt;"),Ae(/"/g,"&quot;"),Ae(/'/g,"&#x27;"),Ae(/`/g,"&#x60;")),new Se(Re(/(?:\n(?:\s*))+/g," "),xe),new Se(Re(/(?:\n\s*)/g,""),xe),new Se(Ie({separator:","}),Re(/(?:\s+)/g," "),xe),new Se(Ie({separator:",",conjunction:"or"}),Re(/(?:\s+)/g," "),xe),new Se(Ie({separator:",",conjunction:"and"}),Re(/(?:\s+)/g," "),xe),new Se(Ie,Ce,xe),new Se(Ie,Re(/(?:\s+)/g," "),xe),new Se(Ce,xe)),Me=new Se(Ce("all"),xe),Pe=r("CIDn"),Ee=r("vF1F");const Le=[{category:"Lambda",examples:[{title:"View latency statistics for 5-minute intervals",expr:Me`filter @type = "REPORT" |
                           stats avg(@duration), max(@duration), min(@duration) by bin(5m)`},{title:"Determine the amount of overprovisioned memory",expr:Te`
        filter @type = "REPORT" |
        stats max(@memorySize / 1024 / 1024) as provisonedMemoryMB,
              min(@maxMemoryUsed / 1024 / 1024) as smallestMemoryRequestMB,
              avg(@maxMemoryUsed / 1024 / 1024) as avgMemoryUsedMB,
              max(@maxMemoryUsed / 1024 / 1024) as maxMemoryUsedMB,
              provisonedMemoryMB - maxMemoryUsedMB as overProvisionedMB`},{title:"Find the most expensive requests",expr:Me`filter @type = "REPORT" |
                           fields @requestId, @billedDuration |
                           sort by @billedDuration desc`}]},{category:"VPC Flow Logs",examples:[{title:"Average, min, and max byte transfers by source and destination IP addresses",expr:"stats avg(bytes), min(bytes), max(bytes) by srcAddr, dstAddr"},{title:"IP addresses using UDP transfer protocol",expr:"filter protocol=17 | stats count(*) by srcAddr"},{title:"Top 10 byte transfers by source and destination IP addresses",expr:Me`stats sum(bytes) as bytesTransferred by srcAddr, dstAddr |
                           sort bytesTransferred desc |
                           limit 10`},{title:"Top 20 source IP addresses with highest number of rejected requests",expr:Me`filter action="REJECT" |
                           stats count(*) as numRejections by srcAddr |
                           sort numRejections desc |
                           limit 20`}]},{category:"CloudTrail",examples:[{title:"Number of log entries by service, event type, and region",expr:"stats count(*) by eventSource, eventName, awsRegion"},{title:"Number of log entries by region and EC2 event type",expr:Me`filter eventSource="ec2.amazonaws.com" |
                           stats count(*) as eventCount by eventName, awsRegion |
                           sort eventCount desc`},{title:"Regions, usernames, and ARNs of newly created IAM users",expr:Me`filter eventName="CreateUser" |
                           fields awsRegion, requestParameters.userName, responseElements.user.arn`}]},{category:"Common Queries",examples:[{title:"25 most recently added log events",expr:Me`fields @timestamp, @message |
                           sort @timestamp desc |
                           limit 25`},{title:"Number of exceptions logged every 5 minutes",expr:Me`filter @message like /Exception/ |
                           stats count(*) as exceptionCount by bin(5m) |
                           sort exceptionCount desc`},{title:"List of log events that are not exceptions",expr:"fields @message | filter @message not like /Exception/"}]},{category:"Route 53",examples:[{title:"Number of requests received every 10  minutes by edge location",expr:"stats count(*) by queryType, bin(10m)"},{title:"Number of unsuccessful requests by domain",expr:'filter responseCode="SERVFAIL" | stats count(*) by queryName'},{title:"Number of requests received every 10  minutes by edge location",expr:"stats count(*) as numRequests by resolverIp | sort numRequests desc | limit 10"}]},{category:"AWS AppSync",examples:[{title:"Number of unique HTTP status codes",expr:Me`fields ispresent(graphQLAPIId) as isApi |
                           filter isApi |
                           filter logType = "RequestSummary" |
                           stats count() as statusCount by statusCode |
                           sort statusCount desc`},{title:"Top 10 resolvers with maximum latency",expr:Me`fields resolverArn, duration |
                           filter logType = "Tracing" |
                           sort duration desc |
                           limit 10`},{title:"Most frequently invoked resolvers",expr:Me`fields ispresent(resolverArn) as isRes |
                           stats count() as invocationCount by resolverArn |
                           filter isRes |
                           filter logType = "Tracing" |
                           sort invocationCount desc |
                           limit 10`},{title:"Resolvers with most errors in mapping templates",expr:Me`fields ispresent(resolverArn) as isRes |
                           stats count() as errorCount by resolverArn, logType |
                           filter isRes and (logType = "RequestMapping" or logType = "ResponseMapping") and fieldInError |
                           sort errorCount desc |
                           limit 10`},{title:"Field latency statistics",expr:Me`fields requestId, latency |
                           filter logType = "RequestSummary" |
                           sort latency desc |
                           limit 10`},{title:"Resolver latency statistics",expr:Me`fields ispresent(resolverArn) as isRes |
                           filter isRes |
                           filter logType = "Tracing" |
                           stats min(duration), max(duration), avg(duration) as avgDur by resolverArn |
                           sort avgDur desc |
                           limit 10`},{title:"Top 10 requests with maximum latency",expr:Me`fields requestId, latency |
                           filter logType = "RequestSummary" |
                           sort latency desc |
                           limit 10`}]}];function Qe(e,t){const r=B.i,s=Object(Pe.c)(W.a.tokenize(e,r)).filter(e=>"string"!=typeof e).map((e,r)=>Object(v.jsx)("span",{className:`prism-token token ${e.types.join(" ")} ${e.aliases.join(" ")}`,children:e.content},`${t}-token-${r}`));return Object(v.jsx)("div",{className:"slate-query-field",children:s})}const ke=Ee.css`
  margin-top: 5px;
`;class Ve extends u.PureComponent{onClickExample(e){this.props.onClickExample(e)}renderExpression(e,t){return Object(v.jsx)("div",{className:"cheat-sheet-item__example",onClick:t=>this.onClickExample({refId:"A",expression:e,queryMode:"Logs",region:"default",id:"A"}),children:Object(v.jsx)("pre",{children:Qe(e,t)})},e)}renderLogsCheatSheet(){return Object(v.jsxs)("div",{children:[Oe||(Oe=Object(v.jsx)("h2",{children:"CloudWatch Logs Cheat Sheet"})),Le.map((e,t)=>Object(v.jsxs)("div",{children:[Object(v.jsx)("div",{className:"cheat-sheet-item__title "+Object(Ee.cx)(ke),children:e.category}),e.examples.map((e,t)=>Object(v.jsxs)("div",{className:"cheat-sheet-item",children:[Object(v.jsx)("h4",{children:e.title}),this.renderExpression(e.expr,"item-"+t)]},"item-"+t))]},`${e.category}-${t}`))]})}render(){return Object(v.jsxs)("div",{children:[we||(we=Object(v.jsx)("h3",{children:"CloudWatch Logs cheat sheet"})),Le.map((e,t)=>Object(v.jsxs)("div",{children:[Object(v.jsx)("div",{className:"cheat-sheet-item__title "+Object(Ee.cx)(ke),children:e.category}),e.examples.map((e,t)=>Object(v.jsxs)("div",{className:"cheat-sheet-item",children:[Object(v.jsx)("h4",{children:e.title}),this.renderExpression(e.expr,"item-"+t)]},"item-"+t))]},"cat-"+t))]})}}var Ge=r("xbdB");r.d(t,"plugin",(function(){return _e}));const _e=new l.DataSourcePlugin(oe).setQueryEditorHelp(Ve).setConfigEditor(e=>{const[t,r]=Object(u.useState)(),{options:s}=e,n=e=>{g.d.dispatch(Object(h.b)(Object(f.c)("CloudWatch Authentication",e)))};return Object(u.useEffect)(()=>{Object(p.a)().loadDatasource(s.name).then(e=>r(e)),"arn"===s.jsonData.authType?n('Since grafana 7.3 authentication type "arn" is deprecated, falling back to default SDK provider'):"credentials"!==s.jsonData.authType||s.jsonData.profile||s.jsonData.database||n('As of grafana 7.3 authentication type "credentials" should be used only for shared file credentials.              If you don\'t have a credentials file, switch to the default SDK provider for extracting credentials              from environment variables or IAM roles')},[s.jsonData.authType,s.jsonData.database,s.jsonData.profile,s.name]),Object(v.jsx)(v.Fragment,{children:Object(v.jsx)(m.ConnectionConfig,y({},e,{loadRegions:t&&(()=>t.getRegions().then(e=>e.filter(e=>"default"!==e.value).map(e=>e.value))),children:Object(v.jsx)(d.InlineField,{label:"Namespaces of Custom Metrics",labelWidth:28,tooltip:"Namespaces of Custom Metrics.",children:Object(v.jsx)(d.Input,{width:60,placeholder:"Namespace1,Namespace2",value:s.jsonData.customMetricsNamespaces||"",onChange:Object(l.onUpdateDatasourceJsonDataOption)(e,"customMetricsNamespaces")})})}))})}).setQueryEditor(fe.a).setExploreMetricsQueryField(fe.a).setExploreLogsQueryField(he.a).setAnnotationQueryCtrl(ue).setChannelSupport(new Ge.a)}}]);
//# sourceMappingURL=cloudwatchPlugin.62c612232a976d8836f5.js.map