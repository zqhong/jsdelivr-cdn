(window.webpackJsonp=window.webpackJsonp||[]).push([[37],{"0Tfw":function(e,t,n){"use strict";var r,i=n("q1tI"),a=n("vF1F"),s=n("kDLi"),o=n("nKUr");function c(){return(c=Object.assign||function(e){for(var t=1;t<arguments.length;t++){var n=arguments[t];for(var r in n)Object.prototype.hasOwnProperty.call(n,r)&&(e[r]=n[r])}return e}).apply(this,arguments)}const l=({currentFormValues:e,imageRendererAvailable:t,register:n})=>Object(o.jsxs)(s.CollapsableSection,{label:"Notification settings",isOpen:!1,children:[Object(o.jsx)(s.Field,{children:Object(o.jsx)(s.Checkbox,c({},n("isDefault"),{label:"Default",description:"Use this notification for all alerts"}))}),Object(o.jsx)(s.Field,{children:Object(o.jsx)(s.Checkbox,c({},n("settings.uploadImage"),{label:"Include image",description:"Captures an image and include it in the notification"}))}),e.uploadImage&&!t&&(r||(r=Object(o.jsx)(s.InfoBox,{title:"No image renderer available/installed",children:"Grafana cannot find an image renderer to capture an image for the notification. Please make sure the Grafana Image Renderer plugin is installed. Please contact your Grafana administrator to install the plugin."}))),Object(o.jsx)(s.Field,{children:Object(o.jsx)(s.Checkbox,c({},n("disableResolveMessage"),{label:"Disable Resolve Message",description:"Disable the resolve message [OK] that is sent when alerting state returns to false"}))}),Object(o.jsx)(s.Field,{children:Object(o.jsx)(s.Checkbox,c({},n("sendReminder"),{label:"Send reminders",description:"Send additional notifications for triggered alerts"}))}),e.sendReminder&&Object(o.jsx)(o.Fragment,{children:Object(o.jsx)(s.Field,{label:"Send reminder every",description:"Specify how often reminders should be sent, e.g. every 30s, 1m, 10m, 30m', or 1h etc. Alert reminders are sent after rules are evaluated. A reminder can never be sent more frequently than a configured alert rule evaluation interval.",children:Object(o.jsx)(s.Input,c({},n("frequency"),{width:8}))})})]}),u=["ref"];function d(){return(d=Object.assign||function(e){for(var t=1;t<arguments.length;t++){var n=arguments[t];for(var r in n)Object.prototype.hasOwnProperty.call(n,r)&&(e[r]=n[r])}return e}).apply(this,arguments)}const p=({control:e,option:t,register:n,invalid:r})=>{const i=t.secure?"secureSettings."+t.propertyName:"settings."+t.propertyName;switch(t.element){case"input":return Object(o.jsx)(s.Input,d({},n(""+i,{required:!!t.required&&"Required",validate:e=>""===t.validationRule||f(e,t.validationRule)}),{invalid:r,type:t.inputType,placeholder:t.placeholder}));case"select":return Object(o.jsx)(s.InputControl,{control:e,name:""+i,render:e=>{var n;let{}=e,i=function(e,t){if(null==e)return{};var n,r,i={},a=Object.keys(e);for(r=0;r<a.length;r++)n=a[r],t.indexOf(n)>=0||(i[n]=e[n]);return i}(e.field,u);return Object(o.jsx)(s.Select,d({menuShouldPortal:!0},i,{options:null!==(n=t.selectOptions)&&void 0!==n?n:void 0,invalid:r}))}});case"textarea":return Object(o.jsx)(s.TextArea,d({invalid:r},n(""+i,{required:!!t.required&&"Required",validate:e=>""===t.validationRule||f(e,t.validationRule)})));default:return console.error("Element not supported",t.element),null}},f=(e,t)=>!!RegExp(t).test(e)||"Invalid format";function b(){return(b=Object.assign||function(e){for(var t=1;t<arguments.length;t++){var n=arguments[t];for(var r in n)Object.prototype.hasOwnProperty.call(n,r)&&(e[r]=n[r])}return e}).apply(this,arguments)}const h=({control:e,currentFormValues:t,errors:n,selectedChannelOptions:r,register:i,onResetSecureField:a,secureFields:c})=>Object(o.jsx)(o.Fragment,{children:r.map((r,l)=>{var u;const d=`${r.label}-${l}`,f=t["settings."+r.showWhen.field]&&t["settings."+r.showWhen.field].value;return r.showWhen.field&&f!==r.showWhen.is?null:"checkbox"===r.element?Object(o.jsx)(s.Field,{children:Object(o.jsx)(s.Checkbox,b({},i(r.secure?"secureSettings."+r.propertyName:"settings."+r.propertyName),{label:r.label,description:r.description}))},d):Object(o.jsx)(s.Field,{label:r.label,description:r.description,invalid:n.settings&&!!n.settings[r.propertyName],error:n.settings&&(null===(u=n.settings[r.propertyName])||void 0===u?void 0:u.message),children:c&&c[r.propertyName]?Object(o.jsx)(s.Input,{readOnly:!0,value:"Configured",suffix:Object(o.jsx)(s.Button,{onClick:()=>a(r.propertyName),fill:"text",type:"button",size:"sm",children:"Clear"})}):Object(o.jsx)(p,{option:r,register:i,control:e})},d)})}),j=["ref"];function g(){return(g=Object.assign||function(e){for(var t=1;t<arguments.length;t++){var n=arguments[t];for(var r in n)Object.prototype.hasOwnProperty.call(n,r)&&(e[r]=n[r])}return e}).apply(this,arguments)}const O=({control:e,currentFormValues:t,errors:n,secureFields:r,selectedChannel:i,channels:a,register:c,resetSecureField:l})=>Object(o.jsxs)(o.Fragment,{children:[Object(o.jsx)(s.Field,{label:"Name",invalid:!!n.name,error:n.name&&n.name.message,children:Object(o.jsx)(s.Input,g({},c("name",{required:"Name is required"})))}),Object(o.jsx)(s.Field,{label:"Type",children:Object(o.jsx)(s.InputControl,{name:"type",render:e=>{let{}=e,t=function(e,t){if(null==e)return{};var n,r,i={},a=Object.keys(e);for(r=0;r<a.length;r++)n=a[r],t.indexOf(n)>=0||(i[n]=e[n]);return i}(e.field,j);return Object(o.jsx)(s.Select,g({menuShouldPortal:!0},t,{options:a}))},control:e,rules:{required:!0}})}),Object(o.jsx)(h,{selectedChannelOptions:i.options.filter(e=>e.required),currentFormValues:t,secureFields:r,onResetSecureField:l,register:c,errors:n,control:e})]}),v=({control:e,currentFormValues:t,errors:n,selectedChannel:r,secureFields:i,register:a,resetSecureField:c})=>{var l;return Object(o.jsxs)(s.CollapsableSection,{label:"Optional "+r.heading,isOpen:!1,children:[""!==r.info&&Object(o.jsx)(s.Alert,{severity:"info",title:null!==(l=r.info)&&void 0!==l?l:""}),Object(o.jsx)(h,{selectedChannelOptions:r.options.filter(e=>!e.required),currentFormValues:t,register:a,errors:n,control:e,onResetSecureField:c,secureFields:i})]})};var m,y,x,S=n("ZFWI");n.d(t,"a",(function(){return F}));const F=({control:e,errors:t,selectedChannel:n,selectableChannels:r,register:a,watch:c,getValues:u,imageRendererAvailable:d,onTestChannel:p,resetSecureField:f,secureFields:b})=>{const h=C(Object(s.useTheme)());Object(i.useEffect)(()=>{const e=new Set(null==n?void 0:n.options.filter(e=>e.showWhen.field).map(e=>"settings."+e.showWhen.field))||[];c(["type","sendReminder","uploadImage",...e])},[null==n?void 0:n.options,c]);const j=u();return n?Object(o.jsxs)("div",{className:h.formContainer,children:[Object(o.jsx)("div",{className:h.formItem,children:Object(o.jsx)(O,{selectedChannel:n,channels:r,secureFields:b,resetSecureField:f,currentFormValues:j,register:a,errors:t,control:e})}),n.options.filter(e=>!e.required).length>0&&Object(o.jsx)("div",{className:h.formItem,children:Object(o.jsx)(v,{selectedChannel:n,secureFields:b,resetSecureField:f,currentFormValues:j,register:a,errors:t,control:e})}),Object(o.jsx)("div",{className:h.formItem,children:Object(o.jsx)(l,{imageRendererAvailable:d,currentFormValues:j,register:a,errors:t,control:e})}),Object(o.jsx)("div",{className:h.formButtons,children:Object(o.jsxs)(s.HorizontalGroup,{children:[y||(y=Object(o.jsx)(s.Button,{type:"submit",children:"Save"})),Object(o.jsx)(s.Button,{type:"button",variant:"secondary",onClick:()=>p(u()),children:"Test"}),Object(o.jsx)("a",{href:S.b.appSubUrl+"/alerting/notifications",children:x||(x=Object(o.jsx)(s.Button,{type:"button",variant:"secondary",children:"Back"}))})]})})]}):m||(m=Object(o.jsx)(s.Spinner,{}))},C=Object(s.stylesFactory)(e=>({formContainer:a.css``,formItem:a.css`
      flex-grow: 1;
      padding-top: ${e.spacing.md};
    `,formButtons:a.css`
      padding-top: ${e.spacing.xl};
    `}))},"4vLh":function(e,t,n){"use strict";n.d(t,"b",(function(){return c})),n.d(t,"f",(function(){return l})),n.d(t,"a",(function(){return u})),n.d(t,"g",(function(){return d})),n.d(t,"e",(function(){return p})),n.d(t,"d",(function(){return f})),n.d(t,"c",(function(){return b}));var r=n("Obii"),i=n("t8hP"),a=n("HJRA"),s=n("qOGI");function o(){return(o=Object.assign||function(e){for(var t=1;t<arguments.length;t++){var n=arguments[t];for(var r in n)Object.prototype.hasOwnProperty.call(n,r)&&(e[r]=n[r])}return e}).apply(this,arguments)}function c(e){return async t=>{t(Object(s.b)());const n=await Object(i.getBackendSrv)().get("/api/alerts",e);t(Object(s.c)(n))}}function l(e,t){return async n=>{await Object(i.getBackendSrv)().post(`/api/alerts/${e}/pause`,t);n(c({state:(i.locationService.getSearchObject().state||"all").toString()}))}}function u(e){return async t=>{try{await Object(i.getBackendSrv)().post("/api/alert-notifications",e),a.a.emit(r.AppEvents.alertSuccess,["Notification created"]),i.locationService.push("/alerting/notifications")}catch(e){a.a.emit(r.AppEvents.alertError,[e.data.error])}}}function d(e){return async t=>{try{await Object(i.getBackendSrv)().put("/api/alert-notifications/"+e.id,e),a.a.emit(r.AppEvents.alertSuccess,["Notification updated"])}catch(e){a.a.emit(r.AppEvents.alertError,[e.data.error])}}}function p(e){return async(t,n)=>{const r=n().notificationChannel.notificationChannel;await Object(i.getBackendSrv)().post("/api/alert-notifications/test",o({id:r.id},e))}}function f(){return async e=>{const t=(await Object(i.getBackendSrv)().get("/api/alert-notifiers")).sort((e,t)=>e.name>t.name?1:-1);e(Object(s.f)(t))}}function b(e){return async t=>{await t(f());const n=await Object(i.getBackendSrv)().get("/api/alert-notifications/"+e);t(Object(s.d)(n))}}},gKHt:function(e,t,n){"use strict";n.d(t,"a",(function(){return a})),n.d(t,"b",(function(){return s})),n.d(t,"c",(function(){return o})),n.d(t,"d",(function(){return c}));var r=n("Wwog");function i(){return(i=Object.assign||function(e){for(var t=1;t<arguments.length;t++){var n=arguments[t];for(var r in n)Object.prototype.hasOwnProperty.call(n,r)&&(e[r]=n[r])}return e}).apply(this,arguments)}const a={id:-1,name:"",type:{value:"email",label:"Email"},sendReminder:!1,disableResolveMessage:!1,frequency:"15m",settings:{uploadImage:n("t8hP").config.rendererAvailable,autoResolve:!0,httpMethod:"POST",severity:"critical"},secureSettings:{},secureFields:{},isDefault:!1},s=Object(r.default)((e,t)=>e.map(e=>t?{value:e.value,label:e.label,description:e.description}:{value:e.value,label:e.label})),o=e=>{const t=Object.fromEntries(Object.entries(e.settings).map(([e,t])=>[e,t&&t.hasOwnProperty("value")?t.value:t]));return i({},a,e,{frequency:""===e.frequency?a.frequency:e.frequency,type:e.type.value,settings:i({},a.settings,t),secureSettings:i({},e.secureSettings)})},c=e=>{var t;return{name:e.name,type:e.type.value,frequency:null!==(t=e.frequency)&&void 0!==t?t:a.frequency,settings:i({},Object.assign(a.settings,e.settings)),secureSettings:i({},e.secureSettings)}}},x9oW:function(e,t,n){"use strict";n.r(t);var r,i=n("q1tI"),a=n("/MKj"),s=n("t8hP"),o=n("kDLi"),c=n("ZGyg"),l=n("0Tfw"),u=n("gKHt"),d=n("lzJ5"),p=n("4vLh"),f=n("qOGI"),b=n("nKUr");function h(){return(h=Object.assign||function(e){for(var t=1;t<arguments.length;t++){var n=arguments[t];for(var r in n)Object.prototype.hasOwnProperty.call(n,r)&&(e[r]=n[r])}return e}).apply(this,arguments)}function j(e,t,n){return t in e?Object.defineProperty(e,t,{value:n,enumerable:!0,configurable:!0,writable:!0}):e[t]=n,e}class g extends i.PureComponent{constructor(...e){super(...e),j(this,"onSubmit",e=>{this.props.createNotificationChannel(Object(u.c)(h({},u.a,e)))}),j(this,"onTestChannel",e=>{this.props.testNotificationChannel(Object(u.d)(h({},u.a,e)))})}componentDidMount(){this.props.loadNotificationTypes()}render(){const{navModel:e,notificationChannelTypes:t}=this.props;return Object(b.jsx)(c.b,{navModel:e,children:Object(b.jsxs)(c.b.Contents,{children:[r||(r=Object(b.jsx)("h2",{className:"page-sub-heading",children:"New notification channel"})),Object(b.jsx)(o.Form,{onSubmit:this.onSubmit,validateOn:"onChange",defaultValues:u.a,maxWidth:600,children:({register:e,errors:n,control:r,getValues:i,watch:a})=>{const o=t.find(e=>e.value===i().type.value);return Object(b.jsx)(l.a,{selectableChannels:Object(u.b)(t,!0),selectedChannel:o,onTestChannel:this.onTestChannel,register:e,errors:n,getValues:i,control:r,watch:a,imageRendererAvailable:s.config.rendererAvailable,resetSecureField:this.props.resetSecureField,secureFields:{}})}})]})})}}const O={createNotificationChannel:p.a,loadNotificationTypes:p.d,testNotificationChannel:p.e,resetSecureField:f.e},v=Object(a.connect)(e=>({navModel:Object(d.a)(e.navIndex,"channels"),notificationChannelTypes:e.notificationChannel.notificationChannelTypes}),O);t.default=v(g)}}]);
//# sourceMappingURL=NewNotificationChannel.62c612232a976d8836f5.js.map