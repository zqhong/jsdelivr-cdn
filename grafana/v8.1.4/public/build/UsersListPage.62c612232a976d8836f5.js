(window.webpackJsonp=window.webpackJsonp||[]).push([[60],{"1Xqh":function(e,t,s){"use strict";var n,r,i,c,a,o,l=s("q1tI"),h=s("GQ3c"),d=s("Y/nG"),u=s("kDLi"),j=s("HJRA"),b=s("nKUr");t.a=e=>{const{users:t,onRoleChange:s,onRemoveUser:O}=e,x=j.b.hasPermission(h.a.OrgUsersRoleUpdate),v=j.b.hasPermission(h.a.OrgUsersRemove),[g,m]=Object(l.useState)(!1);return Object(b.jsxs)("table",{className:"filter-table form-inline",children:[Object(b.jsx)("thead",{children:Object(b.jsxs)("tr",{children:[n||(n=Object(b.jsx)("th",{})),r||(r=Object(b.jsx)("th",{children:"Login"})),i||(i=Object(b.jsx)("th",{children:"Email"})),c||(c=Object(b.jsx)("th",{children:"Name"})),a||(a=Object(b.jsx)("th",{children:"Seen"})),o||(o=Object(b.jsx)("th",{children:"Role"})),Object(b.jsx)("th",{style:{width:"34px"}})]})}),Object(b.jsx)("tbody",{children:t.map((e,t)=>Object(b.jsxs)("tr",{children:[Object(b.jsx)("td",{className:"width-2 text-center",children:Object(b.jsx)("img",{className:"filter-table__avatar",src:e.avatarUrl})}),Object(b.jsx)("td",{className:"max-width-6",children:Object(b.jsx)("span",{className:"ellipsis",title:e.login,children:e.login})}),Object(b.jsx)("td",{className:"max-width-5",children:Object(b.jsx)("span",{className:"ellipsis",title:e.email,children:e.email})}),Object(b.jsx)("td",{className:"max-width-5",children:Object(b.jsx)("span",{className:"ellipsis",title:e.name,children:e.name})}),Object(b.jsx)("td",{className:"width-1",children:e.lastSeenAtAge}),Object(b.jsx)("td",{className:"width-8",children:Object(b.jsx)(d.a,{value:e.role,disabled:!x,onChange:t=>s(t,e)})}),v&&Object(b.jsxs)("td",{children:[Object(b.jsx)(u.Button,{size:"sm",variant:"destructive",onClick:()=>m(e.login),icon:"times"}),Object(b.jsx)(u.ConfirmModal,{body:`Are you sure you want to delete user ${e.login}?`,confirmText:"Delete",title:"Delete",onDismiss:()=>m(!1),isOpen:e.login===g,onConfirm:()=>{O(e)}})]})]},`${e.userId}-${t}`))})]})}},"4sTo":function(e,t,s){"use strict";var n=s("q1tI"),r=s("/MKj"),i=s("nKOl"),c=s("kDLi"),a=s("nKUr");class o extends n.PureComponent{render(){const{invitee:e,revokeInvite:t}=this.props;return Object(a.jsxs)("tr",{children:[Object(a.jsx)("td",{children:e.email}),Object(a.jsx)("td",{children:e.name}),Object(a.jsxs)("td",{className:"text-right",children:[Object(a.jsx)(c.ClipboardButton,{variant:"secondary",size:"sm",getText:()=>e.url,children:"Copy Invite"}),"Â "]}),Object(a.jsx)("td",{children:Object(a.jsx)(c.Button,{variant:"destructive",size:"sm",icon:"times",onClick:()=>t(e.code)})})]})}}const l={revokeInvite:i.d};var h,d,u,j=Object(r.connect)(()=>({}),l)(o);s.d(t,"a",(function(){return b}));class b extends n.PureComponent{render(){const{invitees:e}=this.props;return Object(a.jsxs)("table",{className:"filter-table form-inline",children:[Object(a.jsx)("thead",{children:Object(a.jsxs)("tr",{children:[h||(h=Object(a.jsx)("th",{children:"Email"})),d||(d=Object(a.jsx)("th",{children:"Name"})),u||(u=Object(a.jsx)("th",{})),Object(a.jsx)("th",{style:{width:"34px"}})]})}),Object(a.jsx)("tbody",{children:e.map((e,t)=>Object(a.jsx)(j,{invitee:e},`${e.id}-${t}`))})]})}}},DWvN:function(e,t,s){"use strict";s.r(t),function(e){s.d(t,"UsersListPage",(function(){return m}));var n=s("q1tI"),r=s("0cfB"),i=s("/MKj"),c=s("Obii"),a=s("kDLi"),o=s("ZGyg"),l=s("vKCI"),h=s("1Xqh"),d=s("4sTo"),u=s("nKOl"),j=s("lzJ5"),b=s("KvmV"),O=s("nABS"),x=s("nKUr");function v(){return(v=Object.assign||function(e){for(var t=1;t<arguments.length;t++){var s=arguments[t];for(var n in s)Object.prototype.hasOwnProperty.call(s,n)&&(e[n]=s[n])}return e}).apply(this,arguments)}function g(e,t,s){return t in e?Object.defineProperty(e,t,{value:s,enumerable:!0,configurable:!0,writable:!0}):e[t]=s,e}class m extends n.PureComponent{constructor(e){super(e),g(this,"onRoleChange",(e,t)=>{const s=v({},t,{role:e});this.props.updateUser(s)}),g(this,"onShowInvites",()=>{this.setState(e=>({showInvites:!e.showInvites}))}),g(this,"getPaginatedUsers",e=>{const t=30*(this.props.searchPage-1);return e.slice(t,t+30)}),this.props.externalUserMngInfo&&(this.externalUserMngInfoHtml=Object(c.renderMarkdown)(this.props.externalUserMngInfo)),this.state={showInvites:!1}}componentDidMount(){this.fetchUsers(),this.fetchInvitees()}async fetchUsers(){return await this.props.loadUsers()}async fetchInvitees(){return await this.props.loadInvitees()}renderTable(){const{invitees:e,users:t,setUsersSearchPage:s}=this.props,n=this.getPaginatedUsers(t),r=Math.ceil(t.length/30);return this.state.showInvites?Object(x.jsx)(d.a,{invitees:e}):Object(x.jsxs)(a.VerticalGroup,{spacing:"md",children:[Object(x.jsx)(h.a,{users:n,onRoleChange:(e,t)=>this.onRoleChange(e,t),onRemoveUser:e=>this.props.removeUser(e.userId)}),Object(x.jsx)(a.HorizontalGroup,{justify:"flex-end",children:Object(x.jsx)(a.Pagination,{onNavigate:s,currentPage:this.props.searchPage,numberOfPages:r,hideWhenSinglePage:!0})})]})}render(){const{navModel:e,hasFetched:t}=this.props,s=this.externalUserMngInfoHtml;return Object(x.jsx)(o.b,{navModel:e,children:Object(x.jsx)(o.b.Contents,{isLoading:!t,children:Object(x.jsxs)(x.Fragment,{children:[Object(x.jsx)(l.a,{onShowInvites:this.onShowInvites,showInvites:this.state.showInvites}),s&&Object(x.jsx)("div",{className:"grafana-info-box",dangerouslySetInnerHTML:{__html:s}}),t&&this.renderTable()]})})})}}const p={loadUsers:u.b,loadInvitees:u.a,setUsersSearchQuery:O.d,setUsersSearchPage:O.c,updateUser:u.e,removeUser:u.c};t.default=Object(r.hot)(e)(Object(i.connect)((function(e){return{navModel:Object(j.a)(e.navIndex,"users"),users:Object(b.c)(e.users),searchQuery:Object(b.e)(e.users),searchPage:Object(b.d)(e.users),invitees:Object(b.a)(e.users),externalUserMngInfo:e.users.externalUserMngInfo,hasFetched:e.users.hasFetched}}),p)(m))}.call(this,s("3UD+")(e))},KvmV:function(e,t,s){"use strict";s.d(t,"c",(function(){return n})),s.d(t,"a",(function(){return r})),s.d(t,"b",(function(){return i})),s.d(t,"e",(function(){return c})),s.d(t,"d",(function(){return a}));const n=e=>{const t=new RegExp(e.searchQuery,"i");return e.users.filter(e=>t.test(e.login)||t.test(e.email)||t.test(e.name))},r=e=>{const t=new RegExp(e.searchQuery,"i");return e.invitees.filter(e=>t.test(e.name)||t.test(e.email))},i=e=>e.invitees.length,c=e=>e.searchQuery,a=e=>e.searchPage},nKOl:function(e,t,s){"use strict";s.d(t,"b",(function(){return a})),s.d(t,"a",(function(){return o})),s.d(t,"e",(function(){return l})),s.d(t,"c",(function(){return h})),s.d(t,"d",(function(){return d}));var n=s("GQ3c"),r=s("t8hP"),i=s("nABS"),c=s("HJRA");function a(){return async e=>{const t=await Object(r.getBackendSrv)().get("/api/org/users");e(Object(i.e)(t))}}function o(){return async e=>{if(!c.b.hasPermission(n.a.OrgUsersAdd))return;const t=await Object(r.getBackendSrv)().get("/api/org/invites");e(Object(i.b)(t))}}function l(e){return async t=>{await Object(r.getBackendSrv)().patch("/api/org/users/"+e.userId,{role:e.role}),t(a())}}function h(e){return async t=>{await Object(r.getBackendSrv)().delete("/api/org/users/"+e),t(a())}}function d(e){return async t=>{await Object(r.getBackendSrv)().patch(`/api/org/invites/${e}/revoke`,{}),t(o())}}},vKCI:function(e,t,s){"use strict";var n,r=s("q1tI"),i=s("/MKj"),c=s("nABS"),a=s("KvmV"),o=s("EKT6"),l=s("kDLi"),h=s("HJRA"),d=s("GQ3c"),u=s("nKUr");class j extends r.PureComponent{render(){const{canInvite:e,externalUserMngLinkName:t,externalUserMngLinkUrl:s,searchQuery:r,pendingInvitesCount:i,setUsersSearchQuery:c,onShowInvites:a,showInvites:j}=this.props,b=[{label:"Users",value:"users"},{label:`Pending Invites (${i})`,value:"invites"}],O=h.b.hasPermission(d.a.OrgUsersAdd);return Object(u.jsxs)("div",{className:"page-action-bar",children:[Object(u.jsx)("div",{className:"gf-form gf-form--grow",children:Object(u.jsx)(o.a,{value:r,onChange:c,placeholder:"Search user by login, email or name"})}),i>0&&Object(u.jsx)("div",{style:{marginLeft:"1rem"},children:Object(u.jsx)(l.RadioButtonGroup,{value:j?"invites":"users",options:b,onChange:a})}),e&&O&&(n||(n=Object(u.jsx)(l.LinkButton,{href:"org/users/invite",children:"Invite"}))),s&&Object(u.jsx)(l.LinkButton,{href:s,target:"_blank",rel:"noopener",children:t})]})}}const b={setUsersSearchQuery:c.d};t.a=Object(i.connect)((function(e){return{searchQuery:Object(a.e)(e.users),pendingInvitesCount:Object(a.b)(e.users),externalUserMngLinkName:e.users.externalUserMngLinkName,externalUserMngLinkUrl:e.users.externalUserMngLinkUrl,canInvite:e.users.canInvite}}),b)(j)}}]);
//# sourceMappingURL=UsersListPage.62c612232a976d8836f5.js.map