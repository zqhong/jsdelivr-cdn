{"version":3,"sources":["webpack:///./public/app/features/alerting/NotificationsListPage.tsx","webpack:///./public/app/core/hooks/useNavModel.ts","webpack:///./public/app/features/alerting/unified/utils/cloud-alertmanager-notifier-types.ts","webpack:///./public/app/features/alerting/unified/utils/receiver-form.ts","webpack:///./public/app/features/alerting/unified/components/receivers/form/CloudCommonChannelSettings.tsx","webpack:///./public/app/features/alerting/unified/hooks/useControlledFieldArray.ts","webpack:///./public/app/features/alerting/unified/components/receivers/form/fields/styles.ts","webpack:///./public/app/features/alerting/unified/components/receivers/form/fields/SubformField.tsx","webpack:///./public/app/features/alerting/unified/components/receivers/form/fields/KeyValueMapInput.tsx","webpack:///./public/app/features/alerting/unified/components/receivers/form/CollapsibleSection.tsx","webpack:///./public/app/features/alerting/unified/components/receivers/form/fields/SubformArrayField.tsx","webpack:///./public/app/features/alerting/unified/components/receivers/form/fields/StringArrayInput.tsx","webpack:///./public/app/features/alerting/unified/components/receivers/form/fields/OptionField.tsx","webpack:///./public/app/features/alerting/unified/components/receivers/form/ChannelOptions.tsx","webpack:///./public/app/features/alerting/unified/components/receivers/form/ChannelSubForm.tsx","webpack:///./public/app/features/alerting/unified/components/receivers/form/fields/DeletedSubform.tsx","webpack:///./public/app/features/alerting/unified/components/receivers/form/ReceiverForm.tsx","webpack:///./public/app/features/alerting/unified/components/receivers/form/CloudReceiverForm.tsx","webpack:///./public/app/features/alerting/unified/components/receivers/form/GrafanaCommonChannelSettings.tsx","webpack:///./public/app/features/alerting/unified/components/receivers/form/GrafanaReceiverForm.tsx","webpack:///./public/app/features/alerting/unified/components/receivers/EditReceiverView.tsx","webpack:///./public/app/features/alerting/unified/components/receivers/TemplateForm.tsx","webpack:///./public/app/features/alerting/unified/utils/templates.ts","webpack:///./public/app/features/alerting/unified/components/receivers/EditTemplateView.tsx","webpack:///./public/app/features/alerting/unified/components/receivers/GlobalConfigForm.tsx","webpack:///./public/app/features/alerting/unified/components/receivers/NewReceiverView.tsx","webpack:///./public/app/features/alerting/unified/components/receivers/NewTemplateView.tsx","webpack:///./public/app/plugins/datasource/alertmanager/consts.ts","webpack:///./public/app/features/alerting/unified/utils/receivers.ts","webpack:///./public/app/features/alerting/unified/components/receivers/ReceiversSection.tsx","webpack:///./public/app/features/alerting/unified/components/receivers/ReceiversTable.tsx","webpack:///./public/app/features/alerting/unified/components/receivers/TemplatesTable.tsx","webpack:///./public/app/features/alerting/unified/components/receivers/ReceiversAndTemplatesView.tsx","webpack:///./public/app/features/alerting/unified/Receivers.tsx","webpack:///./public/app/features/alerting/NotificationsIndex.tsx","webpack:///./public/app/core/hooks/useQueryParams.ts","webpack:///./public/app/features/alerting/unified/components/rules/ActionIcon.tsx","webpack:///./public/app/features/alerting/unified/styles/table.ts","webpack:///./public/app/core/hooks/useCleanup.ts","webpack:///./node_modules/timers-browserify/main.js","webpack:///./node_modules/setimmediate/setImmediate.js","webpack:///./public/app/features/alerting/unified/hooks/useAlertManagerSourceName.ts","webpack:///./public/app/features/alerting/unified/components/DetailsField.tsx","webpack:///./public/app/features/alerting/unified/components/AlertManagerPicker.tsx","webpack:///./public/app/features/alerting/unified/components/AlertingPageWrapper.tsx","webpack:///./public/app/features/alerting/unified/components/CollapseToggle.tsx"],"names":["NotificationsListPage","navModel","id","navIndex","useSelector","state","getNavModel","useNavModel","notifications","setNotifications","useState","fetchNotifications","useAsyncFn","async","getBackendSrv","get","useEffect","then","res","deleteNotificationConfirmed","delete","Page","Contents","error","length","className","icon","href","style","minWidth","width","map","notification","name","type","justify","isDefault","disabled","variant","size","onClick","appEvents","publish","ShowConfirmModalEvent","title","text","text2","confirmText","yesText","onConfirm","loading","EmptyListCTA","buttonIcon","buttonLink","buttonTitle","proTip","proTipLink","proTipLinkTitle","proTipTarget","option","propertyName","label","description","rest","element","inputType","required","secure","placeholder","validationRule","showWhen","field","is","basicAuthOption","subformOptions","tlsConfigOption","httpConfigOption","cloudNotifierTypes","info","heading","options","globalConfigOptions","grafanaReceiverToFormValues","receiver","notifiers","channelMap","idCounter","items","grafana_managed_receiver_configs","channel","String","notifier","find","values","__id","secureSettings","settings","secureFields","disableResolveMessage","forEach","grafanaChannelConfigToFormChannelValues","cloudReceiverToFormValues","Object","entries","filter","endsWith","configs","replace","config","Error","sendResolved","send_resolved","cloudChannelConfigToFormChannelValues","flat","formValuesToGrafanaReceiver","defaultChannelValues","channelValues","existing","defaults","omitEmptyValues","uid","formChannelValuesToGrafanaChannelConfig","updateConfigWithReceiver","replaceReceiverName","oldReceivers","alertmanager_config","receivers","updated","existingReceiver","route","renameReceiverInRoute","oldName","newName","routes","obj","isArray","key","value","CloudCommonChannelSettings","pathPrefix","register","useFormContext","EMPTY_ARRAY","useControlledFieldArray","formAPI","softDelete","watch","getValues","reset","setValue","fields","update","useCallback","updateFn","JSON","parse","stringify","newItems","set","append","remove","index","slice","splice","getReceiverFormFieldStyles","theme","collapsibleSection","css","wrapper","spacing","colors","border","medium","shape","borderRadius","secondary","typography","sm","fontWeightRegular","deleteIcon","addButton","SubformField","errors","defaultValue","styles","useStyles2","_watchValue","undefined","show","setShow","data-testid","ActionIcon","tooltip","subOption","OptionField","KeyValueMapInput","onChange","getStyles","pairs","setPairs","recordToPairs","emitChange","pairsToRecord","updatePair","old","newPairs","pair","i","table","e","currentTarget","removed","deleteItem","record","CollapsibleSection","children","isCollapsed","setIsCollapsed","cx","caret","hidden","SubformArrayField","defaultValues","path","itemIndex","Math","random","StringArrayInput","v","row","itemValue","updateValue","newValue","invalid","message","OptionInput","control","unregister","keepValue","checkbox","validate","validateOption","render","menuShouldPortal","selectOptions","console","RegExp","test","ChannelOptions","selectedChannelOptions","onResetSecureField","currentFormValues","selectedOptionValue","readOnly","suffix","ChannelSubForm","onDuplicate","onDelete","commonSettingsComponent","CommonSettingsComponent","fieldName","selectedType","_secureFields","setSecureFields","updatedSecureFields","typeOptions","useMemo","sort","a","b","localeCompare","mandatoryOptions","o","optionalOptions","topRow","rules","buttons","innerContent","severity","breakpoints","xl","unit","channelSettingsHeader","DeletedSubForm","ReceiverForm","initialValues","defaultItem","alertManagerSourceName","onSubmit","takenReceiverNames","useForm","useCleanup","unifiedAlerting","saveAMConfig","useUnifiedAlertingSelector","handleSubmit","formState","validateNameIsAvailable","trim","toLowerCase","includes","item","__deleted","emit","AppEvents","alertError","nameIsAvailable","initialItem","currentValues","fill","makeAMLink","freeze","CloudReceiverForm","dispatch","useDispatch","existingValue","newReceiver","recv","configsKey","push","formValuesToCloudReceiver","updateAlertManagerConfigAction","newConfig","oldConfig","successMessage","redirectPath","GrafanaCommonChannelSettings","GrafanaReceiverForm","grafanaNotifiers","result","fetchGrafanaNotifiersAction","id2original","GRAFANA_RULES_SOURCE_NAME","EditReceiverView","receiverName","content","TemplateForm","mode","templateName","templateContent","match","indentedContent","split","line","join","ensureDefine","template_files","templates","data","nameIsUnique","autoFocus","target","rel","externalLink","textarea","rows","EditTemplateView","template","smtp_require_tls","GlobalConfigForm","global","NewReceiverView","NewTemplateView","receiverTypeNames","pagerduty","pushover","slack","opsgenie","webhook","victorops","wechat","extractNotifierTypeCounts","r","capitalize","reduce","acc","getGrafanaNotifierTypeCounts","_","Array","getCortexAlertManagerNotifierTypeCounts","ReceiversSection","addButtonLabel","addButtonTo","to","ReceiversTable","alertManagerName","tableStyles","getAlertTableStyles","receiverToDelete","setReceiverToDelete","showCannotDeleteReceiverModal","setShowCannotDeleteReceiverModal","types","count","section","evenRow","colSpan","idx","actionsCell","encodeURIComponent","onClickDeleteReceiver","isReceiverUsed","isOpen","onDismiss","ButtonRow","body","deleteReceiverAction","TemplatesTable","expandedTemplates","setExpandedTemplates","templateRows","templateToDelete","setTemplateToDelete","colExpand","isExpanded","CollapseToggle","onToggle","DetailsField","horizontal","deleteTemplateAction","ReceiversAndTemplatesView","isCloud","withErrorBoundary","setAlertManagerSourceName","useAlertManagerSourceName","isRoot","useLocation","pathname","configRequests","amConfigs","initialAsyncRequestState","receiverTypes","shouldLoadConfig","fetchAlertManagerConfigAction","disableAmSelect","AlertingPageWrapper","pageId","AlertManagerPicker","current","exact","params","decodeURIComponent","featureToggles","ngalert","Receivers","useQueryParams","search","locationSearchToObject","setImmediate","locationService","partial","tooltipPlacement","iconEl","useStyles","getStyle","placement","weak","background","primary","stateSelector","selectorRef","useRef","cleanUpAction","self","window","apply","Function","prototype","Timeout","clearFn","this","_id","_clearFn","exports","setTimeout","call","scope","arguments","clearTimeout","setInterval","clearInterval","timeout","close","unref","ref","enroll","msecs","_idleTimeoutId","_idleTimeout","unenroll","_unrefActive","active","_onTimeout","clearImmediate","registerImmediate","html","messagePrefix","onGlobalMessage","nextHandle","tasksByHandle","currentlyRunningATask","doc","document","attachTo","getPrototypeOf","toString","process","handle","nextTick","runIfPresent","postMessage","importScripts","postMessageIsAsynchronous","oldOnMessage","onmessage","canUsePostMessage","MessageChannel","port1","event","port2","createElement","documentElement","script","onreadystatechange","removeChild","appendChild","source","indexOf","addEventListener","attachEvent","callback","args","task","run","isAlertManagerSource","getAlertManagerDataSources","ds","queryParams","updateQueryParams","store","ALERTMANAGER_NAME_LOCAL_STORAGE_KEY","ALERTMANAGER_NAME_QUERY_KEY","querySource","storeSource","fieldHorizontal","fieldVertical","down","fontWeightBold","imgUrl","meta","getAllDataSources","DataSourceType","Alertmanager","substr","logos","small","backspaceRemovesValue","maxMenuHeight","noOptionsMessage","getOptionLabel","isLoading","restOfProps","expandButton"],"mappings":"yPAyHeA,MA9GmB,KAChC,MAAMC,ECPoBC,KAC1B,MAAMC,EAAWC,sBAAaC,GAAsBA,EAAMF,UAC1D,OAAOG,YAAYH,EAAUD,IDKZK,CAAY,aAEtBC,EAAeC,GAAoBC,mBAA8B,KAMjEL,EAAOM,GAAsBC,YAJXC,eACVC,0BAAgBC,IAAK,6BAIpCC,oBAAU,KACRL,IAAqBM,KAAMC,IACzBT,EAAiBS,MAElB,CAACP,IAEJ,MAgBMQ,EAA8BN,gBAC5BC,0BAAgBM,OAAQ,4BAA2BlB,GACzD,MAAMM,QAAsBG,IAC5BF,EAAiBD,IAGnB,OACE,cAACa,EAAA,EAAD,CAAMpB,SAAUA,EAAhB,SACE,eAACoB,EAAA,EAAKC,SAAN,WACGjB,EAAMkB,OAAS,4BAAIlB,EAAMkB,UACvBf,EAAcgB,QACf,2CACE,sBAAKC,UAAU,kBAAf,UACE,qBAAKA,UAAU,4BACf,cAAC,aAAD,CAAYC,KAAK,cAAcC,KAAK,4BAApC,6BAIF,wBAAOF,UAAU,mCAAjB,UACE,gCACE,+BACE,oBAAIG,MAAO,CAAEC,SAAU,SAAvB,eACE,6CAEF,oBAAID,MAAO,CAAEC,SAAU,SAAvB,kBACA,oBAAID,MAAO,CAAEE,MAAO,aAGxB,gCACGtB,EAAcuB,IAAKC,GAClB,+BACE,oBAAIP,UAAU,UAAd,SACE,mBAAGE,KAAO,yBAAwBK,EAAa9B,UAA/C,SAA2D8B,EAAaC,SAE1E,oBAAIR,UAAU,UAAd,SACE,mBAAGE,KAAO,yBAAwBK,EAAa9B,UAA/C,SAA2D8B,EAAaE,SAE1E,oBAAIT,UAAU,aAAd,SACE,eAAC,kBAAD,CAAiBU,QAAQ,WAAzB,UACGH,EAAaI,YAAb,MACC,cAAC,SAAD,CAAQC,UAAQ,EAACC,QAAQ,YAAYC,KAAK,KAA1C,uBAIF,cAAC,SAAD,CACED,QAAQ,cACRZ,KAAK,QACLa,KAAK,KACLC,QAAS,KAhELtC,QAiEiB8B,EAAa9B,GAhExDuC,IAAUC,QACR,IAAIC,wBAAsB,CACxBC,MAAO,SACPC,KAAM,mDACNC,MAAQ,sFACRpB,KAAM,YACNqB,YAAa,SACbC,QAAS,SACTC,UAAWpC,UACTM,EAA4BjB,iBAoCX8B,EAAa9B,eA+B7BM,EAAcgB,QAAUnB,EAAM6C,WAAhC,MACC,cAACC,EAAA,EAAD,CACEP,MAAM,iDACNQ,WAAW,cACXC,WAAW,4BACXC,YAAY,cACZC,OAAO,sDACPC,WAAW,kDACXC,gBAAgB,aAChBC,aAAa,mB,2QE/GzB,SAASC,EACPC,EACAC,EACAC,EACAC,EAA2C,IAE3C,UACEH,eACAC,QACAC,cACAE,QAAS,QACTC,UAAW,GACXC,UAAU,EACVC,QAAQ,EACRC,YAAa,GACbC,eAAgB,GAChBC,SAAU,CAAEC,MAAO,GAAIC,GAAI,KACxBT,GAIP,MAAMU,EAA6Cd,EACjD,aACA,aACA,gIACA,CACEK,QAAS,UACTU,eAAgB,CACdf,EAAO,WAAY,WAAY,IAC/BA,EAAO,WAAY,WAAY,IAC/BA,EAAO,gBAAiB,gBAAiB,OAKzCgB,EAA6ChB,EAAO,aAAc,aAAc,+BAAgC,CACpHK,QAAS,UACTU,eAAgB,CACdf,EAAO,UAAW,UAAW,2DAC7BA,EAAO,YAAa,YAAa,6DACjCA,EAAO,WAAY,WAAY,0DAC/BA,EAAO,cAAe,cAAe,4DACrCA,EAAO,uBAAwB,cAAe,gDAAiD,CAC7FK,QAAS,gBAKTY,EAA8CjB,EAClD,cACA,cACA,iGACA,CACEK,QAAS,UACTU,eAAgB,CACdf,EAAO,eAAgB,eAAgB,qEACvCA,EACE,oBACA,oBACA,wFAEFA,EAAO,YAAa,YAAa,uBACjCc,EACAE,KAKOE,EAAoC,CAC/C,CACE5C,KAAM,QACN6B,YAAa,8BACb5B,KAAM,QACN4C,KAAM,GACNC,QAAS,iBACTC,QAAS,CACPrB,EAAO,KAAM,KAAM,8CAA+C,CAAEO,UAAU,IAC9EP,EAAO,OAAQ,OAAQ,uBACvBA,EAAO,YAAa,YAAa,gDACjCA,EAAO,QAAS,QAAS,gDACzBA,EAAO,gBAAiB,WAAY,mCACpCA,EAAO,gBAAiB,WAAY,mCACpCA,EAAO,cAAe,SAAU,mCAChCA,EAAO,gBAAiB,WAAY,mCACpCA,EAAO,cAAe,cAAe,2BAA4B,CAAEK,QAAS,aAC5EL,EAAO,OAAQ,kBAAmB,2CAA4C,CAC5ES,YAAa,wCACbJ,QAAS,aAEXL,EAAO,OAAQ,kBAAmB,2CAA4C,CAAEK,QAAS,aACzFL,EACE,UACA,UACA,yHACA,CAAEK,QAAS,kBAEbW,IAGJ,CACE1C,KAAM,YACN6B,YAAa,kCACb5B,KAAM,YACN4C,KAAM,GACNC,QAAS,qBACTC,QAAS,CACPrB,EACE,cACA,cACA,yFAEFA,EACE,cACA,cACA,uFAEFA,EAAO,MAAO,MAAO,mCACrBA,EAAO,SAAU,SAAU,iDAAkD,CAC3ES,YAAa,gDAEfT,EAAO,aAAc,aAAc,gDAAiD,CAClFS,YAAa,mDAEfT,EAAO,cAAe,cAAe,iCAAkC,CACrES,YAAa,oDAEfT,EAAO,WAAY,WAAY,4BAA6B,CAAES,YAAa,UAC3ET,EACE,UACA,UACA,qFACA,CACEK,QAAS,kBAGbL,EAAO,SAAU,SAAU,oCAAqC,CAC9DK,QAAS,gBACTU,eAAgB,CACdf,EAAO,OAAQ,MAAO,GAAI,CAAEO,UAAU,IACtCP,EAAO,SAAU,SAAU,GAAI,CAAEO,UAAU,IAC3CP,EAAO,MAAO,MAAO,GAAI,CAAEO,UAAU,OAGzCP,EAAO,QAAS,QAAS,mCAAoC,CAC3DK,QAAS,gBACTU,eAAgB,CAACf,EAAO,OAAQ,MAAO,GAAI,CAAEO,UAAU,IAASP,EAAO,OAAQ,OAAQ,GAAI,CAAEO,UAAU,OAEzGU,IAGJ,CACE3C,KAAM,WACN6B,YAAa,iCACb5B,KAAM,WACN4C,KAAM,GACNC,QAAS,oBACTC,QAAS,CACPrB,EAAO,WAAY,WAAY,iCAAkC,CAAEO,UAAU,IAC7EP,EAAO,QAAS,QAAS,wEAAyE,CAChGO,UAAU,IAEZP,EAAO,QAAS,QAAS,sBAAuB,CAC9CS,YAAa,8CAEfT,EAAO,UAAW,UAAW,wBAAyB,CACpDS,YAAa,gDAEfT,EAAO,MAAO,MAAO,mDAAoD,CACvES,YAAa,4CAEfT,EAAO,WAAY,WAAY,kDAAmD,CAChFS,YAAa,sDAEfT,EACE,QACA,QACA,2GACA,CACES,YAAa,OAGjBT,EACE,SACA,SACA,6GACA,CACES,YAAa,OAGjBQ,IAGJ,CACE3C,KAAM,QACN6B,YAAa,8BACb5B,KAAM,QACN4C,KAAM,GACNC,QAAS,iBACTC,QAAS,CACPrB,EAAO,UAAW,cAAe,0BACjCA,EAAO,UAAW,UAAW,kDAAmD,CAAEO,UAAU,IAC5FP,EAAO,aAAc,aAAc,IACnCA,EAAO,WAAY,WAAY,IAC/BA,EAAO,aAAc,aAAc,GAAI,CAAEK,QAAS,aAClDL,EAAO,WAAY,WAAY,GAAI,CAAES,YAAa,8CAClDT,EAAO,cAAe,cAAe,GAAI,CAAES,YAAa,gDACxDT,EAAO,QAAS,QAAS,GAAI,CAAES,YAAa,8DAC5CT,EAAO,WAAY,WAAY,GAAI,CAAES,YAAa,8CAClDT,EAAO,SAAU,SAAU,GAAI,CAAES,YAAa,4CAC9CT,EAAO,YAAa,gBAAiB,qEAAsE,CACzGK,QAAS,iBAEXL,EAAO,UAAW,WAAY,GAAI,CAAES,YAAa,6CACjDT,EAAO,eAAgB,eAAgB,GAAI,CAAEK,QAAS,aACtDL,EAAO,OAAQ,eAAgB,GAAI,CAAEK,QAAS,WAAYI,YAAa,0CACvET,EAAO,QAAS,QAAS,GAAI,CAAES,YAAa,2CAC5CT,EAAO,aAAc,aAAc,GAAI,CAAES,YAAa,+CACtDT,EAAO,YAAa,YAAa,IACjCA,EAAO,YAAa,gBAAiB,IACrCA,EAAO,UAAW,UAAW,GAAI,CAC/BK,QAAS,gBACTU,eAAgB,CACdf,EAAO,OAAQ,OAAQ,GAAI,CAAEO,UAAU,IACvCP,EAAO,OAAQ,OAAQ,GAAI,CAAEO,UAAU,IACvCP,EAAO,MAAO,MAAO,+CACrBA,EAAO,OAAQ,OAAQ,IACvBA,EAAO,QAAS,QAAS,IACzBA,EAAO,UAAW,UAAW,GAAI,CAC/BK,QAAS,UACTU,eAAgB,CACdf,EAAO,OAAQ,OAAQ,GAAI,CAAEO,UAAU,IACvCP,EAAO,eAAgB,eAAgB,IACvCA,EAAO,UAAW,UAAW,IAC7BA,EAAO,QAAS,QAAS,OAG7BA,EAAO,QAAS,QAAS,OAG7BA,EAAO,SAAU,SAAU,GAAI,CAC7BK,QAAS,gBACTU,eAAgB,CACdf,EAAO,QAAS,QAAS,GAAI,CAAEO,UAAU,IACzCP,EAAO,QAAS,QAAS,GAAI,CAAEO,UAAU,IACzCP,EAAO,QAAS,QAAS,GAAI,CAAEK,QAAS,gBAG5CY,IAGJ,CACE3C,KAAM,WACN6B,YAAa,iCACb5B,KAAM,WACN4C,KAAM,GACNC,QAAS,oBACTC,QAAS,CACPrB,EAAO,UAAW,UAAW,wDAC7BA,EAAO,UAAW,UAAW,8CAC7BA,EAAO,UAAW,UAAW,yCAC7BA,EAAO,cAAe,cAAe,iCAAkC,CACrES,YAAa,oDAEfT,EAAO,SAAU,SAAU,gDAAiD,CAC1ES,YAAa,+CAEfT,EACE,UACA,UACA,qFACA,CACEK,QAAS,kBAGbL,EAAO,OAAQ,OAAQ,+DACvBA,EAAO,OAAQ,OAAQ,0BACvBA,EAAO,WAAY,WAAY,wEAC/BA,EAAO,aAAc,aAAc,oDAAqD,CACtFK,QAAS,gBACTU,eAAgB,CACdf,EAAO,OAAQ,OAAQ,6CAA8C,CAAEO,UAAU,IACjFP,EAAO,KAAM,KAAM,kDACnBA,EAAO,OAAQ,OAAQ,kDACvBA,EAAO,WAAY,WAAY,qDAGnCiB,IAGJ,CACE3C,KAAM,YACN6B,YAAa,kCACb5B,KAAM,YACN4C,KAAM,GACNC,QAAS,qBACTC,QAAS,CACPrB,EAAO,UAAW,UAAW,yDAC7BA,EAAO,UAAW,UAAW,0BAC7BA,EAAO,cAAe,cAAe,yCAA0C,CAAEO,UAAU,IAC3FP,EAAO,eAAgB,eAAgB,kEACvCA,EAAO,sBAAuB,sBAAuB,2CAA4C,CAC/FS,YAAa,6DAEfT,EAAO,gBAAiB,gBAAiB,oDAAqD,CAC5FS,YAAa,uDAEfT,EAAO,kBAAmB,kBAAmB,iDAAkD,CAC7FS,YAAa,yDAEfQ,IAGJ,CACE3C,KAAM,UACN6B,YAAa,kCACb5B,KAAM,UACN4C,KAAM,GACNC,QAAS,mBACTC,QAAS,CACPrB,EAAO,MAAO,MAAO,8CAA+C,CAAEO,UAAU,IAChFP,EACE,aACA,aACA,wLACA,CAAES,YAAa,IAAKC,eAAgB,gBAEtCO,KAKOK,EAAmD,CAE9DtB,EAAO,YAAa,YAAa,uCACjCA,EACE,iBACA,iBACA,qMAEFA,EAAO,aAAc,aAAc,uDAAwD,CACzFS,YAAa,cAEfT,EACE,qBACA,qBACA,8GAEFA,EAAO,qBAAsB,qBAAsB,oCACnDA,EAAO,qBAAsB,qBAAsB,0BACnDA,EAAO,mBAAoB,mBAAoB,6BAC/CA,EACE,mBACA,mBACA,oHACA,CACEK,QAAS,aAKbL,EAAO,gBAAiB,gBAAiB,IACzCA,EAAO,oBAAqB,oBAAqB,IACjDA,EAAO,oBAAqB,oBAAqB,GAAI,CACnDS,YAAa,qEAEfT,EAAO,gBAAiB,gBAAiB,2CACzCA,EAAO,mBAAoB,mBAAoB,IAC/CA,EAAO,mBAAoB,mBAAoB,GAAI,CAAES,YAAa,8BAClET,EAAO,iBAAkB,iBAAkB,GAAI,CAAES,YAAa,yCAC9DT,EAAO,oBAAqB,oBAAqB,IACjDA,EAAO,qBAAsB,qBAAsB,IACnDiB,EACAjB,EACE,kBACA,kBACA,sQACA,CACES,YAAa,Q,2OC1WZ,SAASc,EACdC,EACAC,GAC+D,QAC/D,MAAMC,EAAgC,GAItC,IAAIC,EAAY,EAWhB,MAAO,CAVQ,CACbrD,KAAMkD,EAASlD,KACfsD,MAAK,oBACHJ,EAASK,wCADN,aACH,EAA2CzD,IAAK0D,IAC9C,MAAMvF,EAAKwF,OAAOJ,KAClBD,EAAWnF,GAAMuF,EACjB,MAAME,EAAWP,EAAUQ,KAAK,EAAG1D,UAAWA,IAASuD,EAAQvD,MAC/D,OAuJR,SACEhC,EACAuF,EACAE,GAEA,MAAME,EAA+B,CACnCC,KAAM5F,EACNgC,KAAMuD,EAAQvD,KACd6D,eAAgB,GAChBC,SAAU,KAAKP,EAAQO,UACvBC,aAAc,KAAKR,EAAQQ,cAC3BC,sBAAuBT,EAAQS,uBAWjC,OAPAP,WAAUX,QAAQmB,QAASxC,IACrBA,EAAOQ,QAAU0B,EAAOG,SAASrC,EAAOC,uBACnCiC,EAAOG,SAASrC,EAAOC,cAC9BiC,EAAOI,aAAatC,EAAOC,eAAgB,KAIxCiC,EA7KMO,CAAwClG,EAAIuF,EAASE,YAL3D,QAMG,IAEMN,GAGX,SAASgB,EACdlB,EACAC,GAEA,MAAMC,EAA8B,GAEpC,IAAIC,EAAY,EAChB,MAAMC,EAA8Be,OAAOC,QAAQpB,GAEhDqB,OAAO,EAAEtE,KAAUA,EAAKuE,SAAS,aAAwB,qCAATvE,GAEhDH,IAAI,EAAEG,EAAMwE,KAAwD,CACnExE,EAAKyE,QAAQ,WAAY,IACzBD,IAGD3E,IAAI,EAAEG,EAAMwE,KACXA,EAAQ3E,IAAK6E,IACX,MAAM1G,EAAKwF,OAAOJ,KAClBD,EAAWnF,GAAM,CAAEgC,OAAM0E,UAEzB,IADiBxB,EAAUQ,KAAMD,GAAaA,EAASzD,OAASA,GAE9D,MAAM,IAAI2E,MAAO,2BAA0B3E,GAE7C,OAwGR,SACEhC,EACAgC,EACAuD,GAEA,MAAO,CACLK,KAAM5F,EACNgC,OACA8D,SAAU,KACLP,GAELQ,aAAc,GACdF,eAAgB,GAChBe,aAAcrB,EAAQsB,eArHXC,CAAsC9G,EAAIgC,EAAM0E,MAG1DK,OAKH,MAAO,CAJQ,CACbhF,KAAMkD,EAASlD,KACfsD,SAEcF,GAGX,SAAS6B,EACdrB,EACAR,EACA8B,GACU,MACV,MAAO,CACLlF,KAAM4D,EAAO5D,KACbuD,kCAAkC,UAACK,EAAON,aAAR,QAAiB,IAAIxD,IAAKqF,IAC1D,MAAMC,EAAqDhC,EAAW+B,EAActB,MACpF,OA8HN,SACED,EACAyB,EACArF,EACAoF,GAC8B,cAC9B,MAAM5B,EAAwC,CAC5CO,SAAUuB,EAAgB,KACpBF,GAAYA,EAASnF,OAAS2D,EAAO3D,MAArC,UAA4CmF,EAASrB,gBAArD,QAAsE,GADnD,UAEnBH,EAAOG,gBAFY,QAEA,KAEzBD,eAAc,UAAEF,EAAOE,sBAAT,QAA2B,GACzC7D,KAAM2D,EAAO3D,KACbD,OACAiE,sBAAqB,oBACnBL,EAAOK,6BADY,QACamB,aADb,EACaA,EAAUnB,6BADvB,QACgDoB,EAASpB,uBAE5EmB,IACF5B,EAAQ+B,IAAMH,EAASG,KAEzB,OAAO/B,EAlJIgC,CAAwCL,EAAeD,EAAsBtB,EAAO5D,KAAMoF,MA6BhG,SAASK,EACdd,EACAzB,EACAwC,GAC0B,MAC1B,MAAMC,EAAY,UAAGhB,EAAOiB,oBAAoBC,iBAA9B,QAA2C,GAG7D,GAAI3C,EAASlD,OAAS0F,GAAyBC,EAAahC,KAAK,EAAG3D,UAAWA,IAASkD,EAASlD,MAC/F,MAAM,IAAI4E,MAAO,2BAA0B1B,EAASlD,MAItD,GAAI0F,IAAwBC,EAAahC,KAAK,EAAG3D,UAAWA,IAAS0F,GACnE,MAAM,IAAId,MAAO,qBAAoBc,iDAGvC,MAAMI,EAAoC,KACrCnB,EADkC,CAErCiB,oBAAqB,KAEhBjB,EAAOiB,oBAFO,CAGjBC,UAAWH,EACPC,EAAa7F,IAAKiG,GAChBA,EAAiB/F,OAAS0F,EAAsBxC,EAAW6C,GAE7D,IAAIJ,EAAczC,OAa1B,OARI4C,EAAQF,oBAAoBI,OAASN,GAAuBxC,EAASlD,OAAS0F,IAChFI,EAAQF,oBAAoBI,MAUhC,SAASC,EAAsBD,EAAcE,EAAiBC,GAC5D,MAAML,EAAiB,KAClBE,GAEDF,EAAQ5C,WAAagD,IACvBJ,EAAQ5C,SAAWiD,GAEjBL,EAAQM,SACVN,EAAQM,OAASN,EAAQM,OAAOtG,IAAKkG,GAAUC,EAAsBD,EAAOE,EAASC,KAEvF,OAAOL,EApB+BG,CAClCH,EAAQF,oBAAoBI,MAC5BN,EACAxC,EAASlD,OAIN8F,EAsFF,SAASR,EAAmBe,GAYjC,OAXIC,kBAAQD,GACVA,EAAInC,QAAQoB,GACY,iBAARe,GAA4B,OAARA,GACpChC,OAAOC,QAAQ+B,GAAKnC,QAAQ,EAAEqC,EAAKC,MACnB,KAAVA,SAAgBA,SACVH,EAAYE,GAEpBjB,EAAgBkB,KAIfH,E,+NCpPF,MAAMI,EAA+D,EAAGC,aAAYlH,gBACzF,MAAM,SAAEmH,GAAaC,cACrB,OACE,qBAAKpH,UAAWA,EAAhB,SACE,cAAC,QAAD,UACE,cAAC,WAAD,KACMmH,EAAYD,EAAF,gBADhB,CAEE9E,MAAM,gBACNC,YAAY,0D,oDCKtB,MAAMgF,EAAc,GASb,SAASC,EAA2B/D,GAAqB,QAC9D,MAAM,KAAE/C,EAAF,QAAQ+G,EAAR,SAAiB1B,EAAjB,WAA2B2B,GAAejE,GAC1C,MAAEkE,EAAF,UAASC,EAAT,MAAoBC,EAApB,SAA2BC,GAAaL,EAExCM,EAAiC,oBAAGJ,EAAMjH,UAAT,QAAkBqF,SAAlB,QAA8BwB,EAE/DS,EAASC,sBACZC,IACC,MAAM5D,EAAS6D,KAAKC,MAAMD,KAAKE,UAAUT,MACnCU,EAAWJ,EAASH,UAAU,IACpCF,EAAMU,cAAIjE,EAAQ5D,EAAM4H,KAE1B,CAACV,EAAWlH,EAAMmH,EAAOE,IAG3B,MAAO,CACLA,SACAS,OAAQP,sBAAa3D,GAAc0D,EAAQD,GAAW,IAAIA,EAAQzD,IAAU,CAAC0D,IAC7ES,OAAQR,sBACLS,IACKhB,EACFI,EAAU,GAAEpH,KAAQgI,eAAmB,GAEvCV,EAAQhE,IACN,MAAMsE,EAAWtE,EAAM2E,QAEvB,OADAL,EAASM,OAAOF,EAAO,GAChBJ,KAIb,CAACN,EAAQtH,EAAMoH,EAAUJ,K,4BCtDxB,MAAMmB,EAA8BC,IAAD,CACxCC,mBAAoBC,KAAI;;;IAIxBC,QAASD,KAAI;cACDF,EAAMI,QAAQ,EAAG;eAChBJ,EAAMI,QAAQ;wBACLJ,EAAMK,OAAOC,OAAOC;qBACvBP,EAAMQ,MAAMC,aAAa;;IAG5ChH,YAAayG,KAAI;aACNF,EAAMK,OAAO7H,KAAKkI;iBACdV,EAAMW,WAAWzI,KAAK0I;mBACpBZ,EAAMW,WAAWE;;IAGlCC,WAAYZ,KAAI;;aAELF,EAAMI,QAAQ;WAChBJ,EAAMI,QAAQ;IAEvBW,UAAWb,KAAI;kBACCF,EAAMI,QAAQ;MCZnBY,EAA0B,EAAG1H,SAAQgF,aAAY2C,SAAQC,mBAAmB,MACvF,MAAMC,EAASC,qBAAWrB,GACpBnI,EAAQ,GAAE0G,IAAahF,EAAOC,gBAC9B,MAAEsF,GAAUL,cACZ6C,EAAcxC,EAAMjH,GACpBwG,OAAwBkD,IAAhBD,EAA4BH,EAAeG,GAElDE,EAAMC,GAAWnL,qBAAW+H,GAEnC,OACE,sBAAKhH,UAAW+J,EAAOhB,QAASsB,cAAgB7J,EAAF,aAA9C,UACE,6BAAK0B,EAAOE,QACXF,EAAOG,aAAe,mBAAGrC,UAAW+J,EAAO1H,YAArB,SAAmCH,EAAOG,cAChE8H,GACC,qCACE,cAACG,EAAA,EAAD,CACED,cAAgB7J,EAAF,iBACdP,KAAK,YACLsK,QAAQ,SACRxJ,QAAS,IAAMqJ,GAAQ,GACvBpK,UAAW+J,EAAOL,cAEnB,UAACxH,EAAOe,sBAAR,QAA0B,IAAI3C,IAAKkK,GAEhC,cAACC,GAAD,CACEX,aAAcA,aAAF,EAAEA,EAAeU,EAAUrI,cAEvCD,OAAQsI,EACRtD,WAAe1G,EAAF,IACbV,MAAO+J,aAAF,EAAEA,EAASW,EAAUrI,eAHrBqI,EAAUrI,mBASvBgI,GACA,cAAC,SAAD,CACEnK,UAAW+J,EAAOJ,UAClBlJ,KAAK,SACLI,QAAQ,YACRZ,KAAK,OACLa,KAAK,KACLC,QAAS,IAAMqJ,GAAQ,GACvBC,cAAgB7J,EAAF,cAPhB,qB,MCxCD,MAAMkK,EAA8B,EAAG1D,QAAO2D,eACnD,MAAMZ,EAASC,qBAAWY,KACnBC,EAAOC,GAAY7L,mBAAS8L,GAAc/D,IACjDzH,oBAAU,IAAMuL,EAASC,GAAc/D,IAAS,CAACA,IAEjD,MAAMgE,EAAcH,IAClBF,EAASM,GAAcJ,KAYnBK,EAAa,CAAC9G,EAA0BoE,KAC5C,MAAM2C,EAAMN,EAAMrC,GACZ4C,EAAWP,EAAMvK,IAAI,CAAC+K,EAAMC,IAAOA,IAAM9C,EAAQpE,EAASiH,GAChEP,EAASM,IACLhH,EAAO,IAAM+G,EAAI,KACnBH,EAAWI,IAIf,OACE,kCACKP,EAAM9K,QACP,wBAAOC,UAAW+J,EAAOwB,MAAzB,gBACE,gCACE,+BACE,sCACA,uCACA,6BAGJ,gCACGV,EAAMvK,IAAI,EAAEyG,EAAKC,GAAQwB,IACxB,+BACE,6BACE,cAAC,QAAD,CAAOxB,MAAOD,EAAK4D,SAAWa,GAAMN,EAAW,CAACM,EAAEC,cAAczE,MAAOA,GAAQwB,OAEjF,6BACE,cAAC,QAAD,CAAOxB,MAAOA,EAAO2D,SAAWa,GAAMN,EAAW,CAACnE,EAAKyE,EAAEC,cAAczE,OAAQwB,OAEjF,6BACE,cAAC8B,EAAA,EAAD,CAAYrK,KAAK,YAAYsK,QAAQ,SAASxJ,QAAS,IAvCnDyH,KAClB,MAAM4C,EAAWP,EAAMpC,QACjBiD,EAAUN,EAAS1C,OAAOF,EAAO,GAAG,GAC1CsC,EAASM,GACLM,EAAQ,IACVV,EAAWI,IAkC8DO,CAAWnD,SARnEA,SAejB,cAAC,SAAD,CACExI,UAAW+J,EAAOJ,UAClBlJ,KAAK,SACLI,QAAQ,YACRZ,KAAK,OACLa,KAAK,KACLC,QAAS,IAAM+J,EAAS,IAAID,EAAO,CAAC,GAAI,MAN1C,qBAcAD,GAAahC,IAAD,CAChBe,UAAWb,KAAI;kBACCF,EAAMI,QAAQ;IAE9BuC,MAAOzC,KAAI;;mBAEMF,EAAMI,QAAQ,MAAMJ,EAAMI,QAAQ;;MAK/CiC,GAAiBJ,IACrB,MAAMe,EAAiC,GACvC,IAAK,MAAO7E,EAAKC,KAAU6D,EACrB9D,IACF6E,EAAO7E,GAAOC,GAGlB,OAAO4E,GAGHb,GAAiBlE,GAA0DhC,OAAOC,QAAQ+B,UAAO,IC1F1FgF,GAAgC,EAAGzJ,QAAOC,cAAayJ,WAAU9L,gBAC5E,MAAM+J,EAASC,qBAAWY,KACnBmB,EAAaC,GAAkB/M,oBAAS,GAI/C,OACE,sBAAKe,UAAWiM,aAAGlC,EAAOhB,QAAS/I,GAAnC,UACE,sBAAKA,UAAW+J,EAAOzG,QAASvC,QAJb,IAAMiL,GAAgBD,GAIzC,UACE,cAAC,OAAD,CAAM/L,UAAW+J,EAAOmC,MAAOpL,KAAK,KAAKN,KAAMuL,EAAc,cAAgB,eAC7E,6BAAK3J,OAENC,GAAe,mBAAGrC,UAAW+J,EAAO1H,YAArB,SAAmCA,IACnD,qBAAKrC,UAAW+L,EAAchC,EAAOoC,YAASjC,EAA9C,SAA0D4B,QAK1DlB,GAAahC,IAAD,CAChBG,QAASD,KAAI;kBACGF,EAAMI,QAAQ;sBACVJ,EAAMI,QAAQ;IAElCkD,MAAOpD,KAAI;oBACOF,EAAMI,QAAQ;IAEhC1F,QAASwF,KAAI;;;;;IAMbqD,OAAQrD,KAAI;;IAGZzG,YAAayG,KAAI;aACNF,EAAMK,OAAO7H,KAAKkI;iBACdV,EAAMW,WAAWzI,KAAK0I;mBACpBZ,EAAMW,WAAWE;;MChCvB2C,GAA+B,EAAGlK,SAAQgF,aAAY2C,SAAQwC,oBAAoB,MAC7F,MAAMtC,EAASC,qBAAWrB,GACpB2D,EAAQ,GAAEpF,IAAahF,EAAOC,eAC9BoF,EAAUH,eACV,OAAES,EAAF,OAAUS,EAAV,OAAkBC,GAAWjB,EAAwB,CAAE9G,KAAM8L,EAAM/E,UAAS1B,SAAUwG,IAE5F,OACE,qBAAKrM,UAAW+J,EAAOhB,QAAvB,SACE,eAAC8C,GAAD,CACE7L,UAAW+J,EAAOlB,mBAClBzG,MAAQ,GAAEF,EAAOE,UAAUyF,EAAO9H,UAClCsC,YAAaH,EAAOG,YAHtB,WAKG,UAACwF,UAAUwE,SAAX,QAA4B,IAAI/L,IAAI,CAACwC,EAAOyJ,KAAc,MACzD,OACE,sBAAqBvM,UAAW+J,EAAOhB,QAAvC,UACE,cAACuB,EAAA,EAAD,CACED,cAAc,GAAEiC,KAAQC,kBACxBtM,KAAK,YACLsK,QAAQ,SACRxJ,QAAS,IAAMwH,EAAOgE,GACtBvM,UAAW+J,EAAOL,aANtB,UAQGxH,EAAOe,sBARV,aAQG,EAAuB3C,IAAK4B,IAAD,aAC1B,cAACuI,GAAD,CACEX,aAAchH,aAAF,EAAEA,EAAQZ,EAAOC,cAE7BD,OAAQA,EACRgF,WAAa,GAAEoF,KAAQC,KACvBzM,MAAO+J,SAAF,UAAEA,EAAS0C,UAAX,aAAE,EAAsBrK,EAAOC,eAH/BD,EAAOC,kBAXRoK,KAoBd,cAAC,SAAD,CACElC,cAAgBiC,EAAF,cACdtM,UAAW+J,EAAOJ,UAClBlJ,KAAK,SACLI,QAAQ,YACRZ,KAAK,OACLa,KAAK,KACLC,QAAS,IAAMuH,EAAO,CAAEjE,KAAMJ,OAAOuI,KAAKC,YAP5C,uBCzCKC,GAA8B,EAAG1F,QAAO2D,eACnD,MAAMZ,EAASC,qBAAWY,IAkB1B,OACE,kCACK5D,YAAOjH,SACRiH,EAAM1G,IAAI,CAACqM,EAAGnE,IACZ,sBAAiBxI,UAAW+J,EAAO6C,IAAnC,UACE,cAAC,QAAD,CAAO5F,MAAO2F,EAAGhC,SAAWa,GAZlB,EAACqB,EAAmBrE,KACjCxB,GAGL2D,EAAS3D,EAAM1G,IAAI,CAACqM,EAAGrB,IAAOA,IAAM9C,EAAQqE,EAAYF,KAQdG,CAAYtB,EAAEC,cAAczE,MAAOwB,KACrE,cAAC8B,EAAA,EAAD,CACEtK,UAAW+J,EAAOL,WAClBzJ,KAAK,YACLsK,QAAQ,SACRxJ,QAAS,IA1BDyH,KAClB,IAAKxB,EACH,OAEF,MAAM+F,EAAW/F,EAAMyB,QACvBsE,EAASrE,OAAOF,EAAO,GACvBmC,EAASoC,IAoBgBpB,CAAWnD,OANpBA,IAUd,cAAC,SAAD,CACExI,UAAW+J,EAAOJ,UAClBlJ,KAAK,SACLI,QAAQ,YACRZ,KAAK,OACLa,KAAK,KACLC,QAAS,IAAM4J,EAAS,IAAK3D,UAAS,GAAK,KAN7C,qBAcA4D,GAAahC,IAAD,CAChBgE,IAAK9D,KAAI;;;qBAGUF,EAAMI,QAAQ;;IAGjCU,WAAYZ,KAAI;mBACCF,EAAMI,QAAQ;IAE/BW,UAAWb,KAAI;kBACCF,EAAMI,QAAQ;6OCnDzB,MAAMyB,GAAyB,EAAGvI,SAAQ8K,UAAS9F,aAAYpH,QAAOgK,kBACpD,YAAnB5H,EAAOK,QAEP,cAACqH,EAAD,CACEE,aAAcA,EACd5H,OAAQA,EACR2H,OAAQ/J,EACRoH,WAAYA,IAIK,kBAAnBhF,EAAOK,QAEP,cAAC6J,GAAD,CACEC,cAAevC,EACf5H,OAAQA,EACRgF,WAAYA,EACZ2C,OAAQ/J,IAKZ,cAAC,QAAD,CACEsC,MAA0B,aAAnBF,EAAOK,QAAyBL,EAAOE,WAAQ8H,EACtD7H,YAAaH,EAAOG,kBAAe6H,EACnC8C,UAAWlN,EACXA,MAAOA,aAAF,EAAEA,EAAOmN,QAJhB,SAME,cAACC,GAAD,CACEzO,GAAK,GAAEyI,IAAahF,EAAOC,eAC3B2H,aAAcA,EACd5H,OAAQA,EACR8K,QAASA,EACT9F,WAAYA,MAMdgG,GAA0C,EAAGhL,SAAQ8K,UAASvO,KAAIyI,aAAa,OACnF,MAAM,QAAEiG,EAAF,SAAWhG,EAAX,WAAqBiG,GAAehG,cACpC5G,EAAQ,GAAE0G,IAAahF,EAAOC,eASpC,OANA5C,oBACE,IAAM,KACJ6N,EAAW5M,EAAM,CAAE6M,WAAW,KAEhC,CAACD,EAAY5M,IAEP0B,EAAOK,SACb,IAAK,WACH,OACE,cAAC,WAAD,IACE9D,GAAIA,EACJuB,UAAW+J,GAAOuD,UACdnG,EAAS3G,GAHf,CAIE4B,MAAOF,EAAOE,MACdC,YAAaH,EAAOG,eAG1B,IAAK,QACH,OACE,cAAC,QAAD,IACE5D,GAAIA,EACJuO,QAASA,EACTvM,KAAMyB,EAAOM,WACT2E,EAAS3G,EAAM,CACjBiC,WAAUP,EAAOO,UAAW,WAC5B8K,SAAWZ,GAAiC,KAA1BzK,EAAOU,gBAAwB4K,GAAeb,EAAGzK,EAAOU,kBAN9E,CAQED,YAAaT,EAAOS,eAI1B,IAAK,SACH,OACE,cAAC,eAAD,CACE8K,OAAQ,cAAG3K,OAAO,SAAE6H,IAAZ,EAA8B7H,E,oIAA9B,GAAGA,MAAH,WACN,cAAC,SAAD,IACE4K,kBAAgB,GACZ5K,EAFN,CAGES,QAAO,UAAErB,EAAOyL,qBAAT,aAA0BzD,EACjC8C,QAASA,EACTrC,SAAW3D,GAAU2D,EAAS3D,EAAMA,WAGxCmG,QAASA,EACT3M,KAAMA,IAIZ,IAAK,WACH,OACE,cAAC,WAAD,IACE/B,GAAIA,EACJuO,QAASA,GACL7F,EAAS3G,EAAM,CACjBiC,WAAUP,EAAOO,UAAW,WAC5B8K,SAAWZ,GAAiC,KAA1BzK,EAAOU,gBAAwB4K,GAAeb,EAAGzK,EAAOU,oBAIlF,IAAK,eACH,OACE,cAAC,eAAD,CACE6K,OAAQ,EAAG3K,OAASkE,QAAO2D,eAAiB,cAAC+B,GAAD,CAAkB1F,MAAOA,EAAO2D,SAAUA,IACtFwC,QAASA,EACT3M,KAAMA,IAGZ,IAAK,gBACH,OACE,cAAC,eAAD,CACEiN,OAAQ,EAAG3K,OAASkE,QAAO2D,eAAiB,cAACD,EAAD,CAAkB1D,MAAOA,EAAO2D,SAAUA,IACtFwC,QAASA,EACT3M,KAAMA,IAIZ,QAEE,OADAoN,QAAQ9N,MAAM,wBAAyBoC,EAAOK,SACvC,OAIPwH,GAAS,CACbuD,SAAUxE,KAAI;;KAKV0E,GAAiB,CAACxG,EAAepE,MAC9BiL,OAAOjL,GAAgBkL,KAAK9G,IAAgB,iBCtI9C,SAAS+G,IAAwC,cACtD1B,EADsD,uBAEtD2B,EAFsD,mBAGtDC,EAHsD,aAItDzJ,EAJsD,OAKtDqF,EALsD,WAMtD3C,EAAa,KAEb,MAAM,MAAEO,GAAUL,cACZ8G,EAAoBzG,IAC1B,OACE,mCACGuG,EAAuB1N,IAAI,CAAC4B,EAAmCsG,KAAkB,QAChF,MAAMzB,EAAO,GAAE7E,EAAOE,SAASoG,IAGzB2F,EAAsBD,EAAmB,GAAEhH,aAAsBhF,EAAOW,SAASC,SAEvF,GAAIZ,EAAOW,SAASC,OAASqL,IAAwBjM,EAAOW,SAASE,GACnE,OAAO,KAGT,GAAIyB,GAAgBA,EAAatC,EAAOC,cACtC,OACE,cAAC,QAAD,CAAiBC,MAAOF,EAAOE,MAAOC,YAAaH,EAAOG,kBAAe6H,EAAzE,SACE,cAAC,QAAD,CACEkE,UAAU,EACVpH,MAAM,aACNqH,OACE,cAAC,SAAD,CACEtN,QAAS,IAAMkN,EAAmB/L,EAAOC,cACzCtB,QAAQ,OACRJ,KAAK,SACLK,KAAK,KAJP,sBALMiG,GAmBhB,MAAMjH,EAAwD,QAAI,EAACoC,EAAOQ,OACtEmH,aAD+D,EAC/DA,EAAQvF,eACRuF,aAF+D,EAE/DA,EAAQtF,gBAFkD,aAAG,EAEArC,EAAOC,cAElE2H,EAAeuC,SAAH,UAAGA,EAAe9H,gBAAlB,aAAG,EAA0BrC,EAAOC,cAEtD,OACE,cAACsI,GAAD,CACEX,aAAcA,EAEdhK,MAAOA,EACPoH,WAAYhF,EAAOQ,OAAYwE,EAAF,kBAAmCA,EAAF,YAC9DhF,OAAQA,GAHH6E,O,6OC/CV,SAASuH,IAAwC,cACtDjC,EADsD,WAEtDnF,EAFsD,YAGtDqH,EAHsD,SAItDC,EAJsD,UAKtD7K,EALsD,OAMtDkG,EANsD,aAOtDrF,EACAiK,wBAAyBC,IACD,MACxB,MAAM3E,EAASC,qBAAWY,IACpBpK,EAAQmO,GAAuB,GAAEzH,IAAayH,KAC9C,QAAExB,EAAF,MAAW1F,EAAX,SAAkBN,GAAaC,cAC/BwH,EAAY,UAAGnH,EAAMjH,EAAK,gBAAd,QAA0B6L,EAAc5L,KAE1DlB,oBAAU,KACR4H,EAAYD,EAAF,UACT,CAACC,EAAUD,IAEd,MAAO2H,EAAeC,GAAmB7P,mBAASuF,UAAgB,IAE5DyJ,EAAsBlH,IAC1B,GAAI8H,EAAc9H,GAAM,CACtB,MAAMgI,EAAsB,MAAKvK,UAC1BuK,EAAoBhI,GAC3B+H,EAAgBC,KAIdC,EAAcC,kBAClB,IACEtL,EACGrD,IAAI,EAAGE,OAAMC,WAAT,CACH2B,MAAO5B,EACPwG,MAAOvG,KAERyO,KAAK,CAACC,EAAGC,IAAMD,EAAE/M,MAAMiN,cAAcD,EAAEhN,QAC5C,CAACuB,IAGGO,EAAWP,EAAUQ,KAAK,EAAG1D,UAAWA,IAASmO,GAGjDU,EAAmBpL,aAAH,EAAGA,EAAUX,QAAQwB,OAAQwK,GAAMA,EAAE9M,UACrD+M,EAAkBtL,aAAH,EAAGA,EAAUX,QAAQwB,OAAQwK,IAAOA,EAAE9M,UAE3D,OACE,sBAAKzC,UAAW+J,EAAOhB,QAASsB,cAAY,iBAA5C,UACE,sBAAKrK,UAAW+J,EAAO0F,OAAvB,UACE,8BACE,cAAC,QAAD,CAAOrN,MAAM,qBAAqBiI,cAAgBnD,EAAF,OAAhD,SACE,cAAC,eAAD,CACE1G,KAAMA,EAAK,QACXsJ,aAAcuC,EAAc5L,KAC5BgN,OAAQ,QAAG3K,OAAO,SAAO6H,IAAjB,EAA8B7H,E,oIAA9B,GAAGA,MAAH,WACN,cAAC,SAAD,IACE4K,kBAAgB,GACZ5K,EAFN,CAGEzC,MAAO,GACPkD,QAASyL,EACTrE,SAAW3D,GAAU2D,EAAS3D,aAAD,EAACA,EAAOA,WAGzCmG,QAASA,EACTuC,MAAO,CAAEjN,UAAU,SAIzB,sBAAKzC,UAAW+J,EAAO4F,QAAvB,UACE,cAAC,SAAD,CAAQ7O,KAAK,KAAKD,QAAQ,YAAYJ,KAAK,SAASM,QAAS,IAAMwN,IAAetO,KAAK,OAAvF,uBAGCuO,GACC,cAAC,SAAD,CACEnE,cAAgBnD,EAAF,gBACdpG,KAAK,KACLD,QAAQ,YACRJ,KAAK,SACLM,QAAS,IAAMyN,IACfvO,KAAK,YANP,0BAaLiE,GACC,sBAAKlE,UAAW+J,EAAO6F,aAAvB,UACE,cAAC7B,GAAD,CACE1B,cAAeA,EACf2B,uBAAwBsB,WAAkBvP,OAASuP,EAAoBE,EACvEhL,aAAcqK,EACdhF,OAAQA,EACRoE,mBAAoBA,EACpB/G,WAAYA,MAEVoI,YAAkBvP,QAAlBuP,MAA4BE,MAAiBzP,SAC/C,eAAC8L,GAAD,CAAoBzJ,MAAQ,YAAW8B,EAAS1D,gBAAhD,UACqB,KAAlB0D,EAASb,MACR,cAAC,QAAD,CAAOlC,MAAM,GAAG0O,SAAS,OAAzB,SACG3L,EAASb,OAGd,cAAC0K,GAAD,CACE1B,cAAeA,EACf2B,uBAAwBwB,EACxBhL,aAAcqK,EACdZ,mBAAoBA,EACpBpE,OAAQA,EACR3C,WAAYA,OAIlB,cAAC2E,GAAD,CAAoBzJ,MAAM,wBAA1B,SACE,cAACsM,EAAD,CAAyBxH,WAAYA,YAQjD,MAAM0D,GAAahC,IAAD,CAChB+G,QAAS7G,KAAI;;qBAEMF,EAAMI,QAAQ;;IAGjC4G,aAAc9G,KAAI;;IAGlBC,QAASD,KAAI;cACDF,EAAMI,QAAQ,EAAG;eAChBJ,EAAMI,QAAQ;wBACLJ,EAAMK,OAAOC,OAAOC;qBACvBP,EAAMQ,MAAMC,aAAa;iBAC7BT,EAAMkH,YAAY1L,OAAO2L,KAAKnH,EAAMkH,YAAYE;IAE/DP,OAAQ3G,KAAI;;;;IAKZmH,sBAAuBnH,KAAI;kBACXF,EAAMI,QAAQ;MC5JzB,SAASkH,IAAe,WAAEhJ,IAC/B,MAAM,SAAEC,GAAaC,cAQrB,OALA7H,oBAAU,KACR4H,EAAYD,EAAF,SACVC,EAAYD,EAAF,eACT,CAACC,EAAUD,IAEP,6B,8NCQF,SAASiJ,IAAsC,OACpDhL,EADoD,cAEpDiL,EAFoD,YAGpDC,EAHoD,UAIpD1M,EAJoD,uBAKpD2M,EALoD,SAMpDC,EANoD,mBAOpDC,EAPoD,wBAQpD/B,IAEA,MAAM1E,EAASC,qBAAWY,IAEpByB,EAAgB+D,GAAiB,CACrC5P,KAAM,GACNsD,MAAO,CAAC,MAEDuM,EAFA,CAGHhM,KAAMJ,OAAOuI,KAAKC,cAKlBlF,EAAUkJ,YAA+B,CAE7CpE,cAAepE,KAAKC,MAAMD,KAAKE,UAAUkE,MAG3CqE,YAAY9R,GAAUA,EAAM+R,gBAAgBC,cAE5C,MAAM,QAAEnP,GAAYoP,YAA4BjS,GAAUA,EAAMgS,eAE1D,aACJE,EADI,SAEJ3J,EACA4J,WAAW,OAAElH,GAHT,UAIJnC,GACEH,GAEE,OAAEM,EAAF,OAAUS,EAAV,OAAkBC,GAAWjB,EAA2B,CAAE9G,KAAM,QAAS+G,UAASC,YAAY,IAE9FwJ,EAA4CjJ,sBAC/CvH,IACCgQ,EAAmBlQ,IAAKE,GAASA,EAAKyQ,OAAOC,eAAeC,SAAS3Q,EAAKyQ,OAAOC,gBAC7E,kDAEN,CAACV,IAcH,OACE,eAAC,IAAD,MAAkBjJ,EAAlB,YACIpC,EAAOiB,oBAAoBI,QAA5B,QACC,cAAC,QAAD,CAAOqJ,SAAS,UAAU1O,MAAM,YAAhC,2HAIF,uBAAMoP,SAAUO,EAlBI1M,IACtBmM,EAAS,MACJnM,EADG,CAENN,MAAOM,EAAON,MAAMiB,OAAQqM,IAAUA,EAAKC,eAI7B,KAChBrQ,IAAUsQ,KAAKC,YAAUC,WAAY,CAAC,uEAUpC,UACE,oBAAIxR,UAAW+J,EAAOzG,QAAtB,SAAgC8M,EAAgB,uBAAyB,yBACzE,cAAC,QAAD,CAAOhO,MAAM,OAAO4K,UAAWnD,EAAOrJ,KAAMV,MAAO+J,EAAOrJ,MAAQqJ,EAAOrJ,KAAKyM,QAA9E,SACE,cAAC,QAAD,IACExO,GAAG,QACC0I,EAAS,OAAQ,CACnB1E,SAAU,mBACV8K,SAAU,CAAEkE,gBAAiBT,KAJjC,CAME3Q,MAAO,QAGVwH,EAAOvH,IAAI,CAACwC,EAAO0F,KAAU,MAC5B,MAAMtB,EAAc,SAAQsB,KAC5B,GAAI1F,EAAMuO,UACR,OAAO,cAACnB,GAAD,CAAiChJ,WAAYA,GAAxBpE,EAAMuB,MAEpC,MAAMqN,EAActB,aAAH,EAAGA,EAAetM,MAAMK,KAAK,EAAGE,UAAWA,IAASvB,EAAMuB,MAC3E,OACE,cAACiK,GAAD,CACEjC,cAAevJ,EAEfyL,YAAa,KACX,MAAMoD,EAAmBjK,IAAY5D,MAAM0E,GAC3CF,EAAO,MAAKqJ,EAAN,CAAqBtN,KAAMJ,OAAOuI,KAAKC,cAE/C+B,SAAU,IAAMjG,EAAOC,GACvBtB,WAAYA,EACZvD,UAAWA,EACXa,aAAckN,aAAF,EAAEA,EAAalN,aAC3BqF,OAAQA,SAAF,UAAEA,EAAQ/F,aAAV,aAAE,EAAgB0E,GACxBiG,wBAAyBA,GAVpB3L,EAAMuB,QAcjB,cAAC,SAAD,CACE5D,KAAK,SACLR,KAAK,OACLY,QAAQ,YACRE,QAAS,IAAMuH,EAAO,MAAK+H,EAAN,CAAmBhM,KAAMJ,OAAOuI,KAAKC,aAJ5D,oCAQA,sBAAKzM,UAAW+J,EAAO4F,QAAvB,UACGlO,IAAY,QACX,cAAC,SAAD,CAAQb,UAAU,EAAMX,KAAK,gBAAgBY,QAAQ,UAArD,0BAIAY,IAAD,QAAY,cAAC,SAAD,CAAQhB,KAAK,SAAb,kCACb,cAAC,aAAD,CACEG,SAAUa,EACVmQ,KAAK,UACL/Q,QAAQ,YACRX,KAAM2R,YAAW,yBAA0BvB,GAJ7C,8BAcV,MAAM1F,GAAahC,IAAD,CAChBtF,QAASwF,KAAI;cACDF,EAAMI,QAAQ,EAAG;IAE7B2G,QAAS7G,KAAI;kBACGF,EAAMI,QAAQ;;;qBAGXJ,EAAMI,QAAQ;;aC/InC,MAAMtD,GAA2Cb,OAAOiN,OAAO,CAC7DzN,KAAM,GACNgB,cAAc,EACdf,eAAgB,GAChBC,SAAU,GACVC,aAAc,GACd/D,KAAM,UAGKsR,GAA+B,EAAGnM,WAAU0K,yBAAwBnL,aAC/E,MAAM6M,EAAWC,yBAGVC,GAAiBjD,kBAAQ,IACzBrJ,EAGEhB,EAA0BgB,EAAUxC,GAFlC,MAAC8G,EAAW,IAGpB,CAACtE,IAeE4K,EAAqBvB,kBACzB,wCAAM9J,EAAOiB,oBAAoBC,iBAAjC,aAAM,EAAsC/F,IAAI,EAAGE,UAAWA,GAAMuE,OAAQvE,GAASA,KAASoF,aAAL,EAAKA,EAAUpF,cAAxG,QAAiH,IACjH,CAAC2E,EAAQS,IAGX,OACE,6CACE,cAAC,QAAD,CAAOzE,MAAM,OAAO0O,SAAS,OAA7B,oGAGA,cAACM,GAAD,CACEhL,OAAQA,EACRoL,SAzBYnM,IAChB,MAAM+N,Ed6CH,SACL/N,EACAyB,GAEA,MAAMuM,EAAiB,CACrB5R,KAAM4D,EAAO5D,MAef,OAbA4D,EAAON,MAAMY,QAAQ,EAAGL,OAAM5D,OAAM8D,WAAUc,mBAC5C,MAAMrB,EAAU8B,EAAgB,KAC3BvB,EAD0B,CAE7Be,cAAeD,UAAgBQ,EAASR,gBAGpCgN,EAAgB5R,EAAF,WACf2R,EAAKC,GAGPD,EAAKC,GAA0BC,KAAKtO,GAFrCoO,EAAKC,GAAc,CAACrO,KAKjBoO,EcjEeG,CAA0BnO,EAAQsB,IACtDsM,EACEQ,YAA+B,CAC7BC,UAAWxM,EAAyBd,EAAQgN,EAAavM,aAAtB,EAAsBA,EAAUpF,MACnEkS,UAAWvN,EACXmL,yBACAqC,eAAgB/M,EAAW,yBAA2B,yBACtDgN,aAAcf,YAAW,0BAA2BvB,OAkBpDF,cAAe8B,EACfvO,UAAWP,EACXkN,uBAAwBA,EACxBD,YAAa3K,GACb8K,mBAAoBA,EACpB/B,wBAAyBxH,Q,iNCpE1B,MAAM4L,GAAiE,EAAG3L,aAAYlH,gBAC3F,MAAM,SAAEmH,GAAaC,cACrB,OACE,qBAAKpH,UAAWA,EAAhB,SACE,cAAC,QAAD,UACE,cAAC,WAAD,MACMmH,EAAYD,EAAF,yBADhB,CAEE9E,MAAM,2BACNC,YAAY,6F,OCatB,MAAMqD,GAA6Cb,OAAOiN,OAAO,CAC/DzN,KAAM,GACNC,eAAgB,GAChBC,SAAU,GACVC,aAAc,GACdC,uBAAuB,EACvBhE,KAAM,UAGKqS,GAAiC,EAAGlN,WAAU0K,yBAAwBnL,aACjF,MAAM4N,EAAmBlC,YAA4BjS,GAAUA,EAAMmU,kBAE/Df,EAAWC,wBAEjB1S,oBAAU,KACFwT,EAAiBC,QAAUD,EAAiBtR,SAChDuQ,EAASiB,gBAEV,CAACF,EAAkBf,IAGtB,MAAOE,EAAegB,GAAejE,kBAAQ,IAItCrJ,GAAamN,EAAiBC,OAG5BvP,EAA4BmC,EAAUmN,EAAiBC,QAFrD,MAAC9I,EAAW,IAGpB,CAACtE,EAAUmN,EAAiBC,SAEzBzC,EAAYnM,IAChB,MAAM+N,EAAc1M,EAA4BrB,EAAQ8O,EAAaxN,IACrEsM,EACEQ,YAA+B,CAC7BC,UAAWxM,EAAyBd,EAAQgN,EAAavM,aAAtB,EAAsBA,EAAUpF,MACnEkS,UAAWvN,EACXmL,uBAAwB6C,IACxBR,eAAgB/M,EAAW,yBAA2B,wBACtDgN,aAAc,8BAKdpC,EAAqBvB,kBACzB,wCAAM9J,EAAOiB,oBAAoBC,iBAAjC,aAAM,EAAsC/F,IAAI,EAAGE,UAAWA,GAAMuE,OAAQvE,GAASA,KAASoF,aAAL,EAAKA,EAAUpF,cAAxG,QAAiH,IACjH,CAAC2E,EAAQS,IAGX,OAAImN,EAAiBC,OAEjB,cAAC7C,GAAD,CACEhL,OAAQA,EACRoL,SAAUA,EACVH,cAAe8B,EACfvO,UAAWoP,EAAiBC,OAC5B1C,uBAAwBA,EACxBD,YAAa3K,GACb8K,mBAAoBA,EACpB/B,wBAAyBoE,KAI7B,QAAO,cAAC,qBAAD,CAAoBzR,KAAK,2B,OC5E7B,MAAMgS,GAA8B,EAAGjO,SAAQkO,eAAc/C,6BAA6B,MAC/F,MAAM5M,EAAQ,UAAGyB,EAAOiB,oBAAoBC,iBAA9B,aAAG,EAAsClC,KAAK,EAAG3D,UAAWA,IAAS6S,GACnF,OAAK3P,EAQD4M,IAA2B6C,IACtB,cAACL,GAAD,CAAqB3N,OAAQA,EAAQmL,uBAAwBA,EAAwB1K,SAAUlC,IAE/F,cAACqO,GAAD,CAAmB5M,OAAQA,EAAQmL,uBAAwBA,EAAwB1K,SAAUlC,IAVpG,QACE,cAAC,UAAD,CAASmM,SAAS,QAAQ1O,MAAM,qBAAhC,2D,2NCCN,MAAM0E,GAAmBhB,OAAOiN,OAAO,CACrCtR,KAAM,GACN8S,QAAS,KASEC,GAA0B,EAAG3N,WAAU0K,yBAAwBnL,aAAa,cACvF,MAAM4E,EAASC,qBAAWY,IACpBoH,EAAWC,wBAEjBvB,YAAY9R,GAAUA,EAAM+R,gBAAgBC,cAE5C,MAAM,QAAEnP,EAAF,MAAW3B,GAAU+Q,YAA4BjS,GAAUA,EAAMgS,eA0CjE,aACJE,EADI,SAEJ3J,EACA4J,WAAW,OAAElH,IACX4G,YAAgB,CAClB+C,KAAM,WACNnH,cAAezG,UAAYC,KAS7B,OACE,uBAAM0K,SAAUO,EAxDF1M,IAAmB,MAGjC,MAAMkP,ECxCH,SAAsBG,EAAsBC,GAIjD,IAAIJ,EAAUI,EAAgBzC,OAC9B,IAAKqC,EAAQK,MAAM,iBAAkB,CACnC,MAAMC,EAAkBN,EACrBO,MAAM,MACNvT,IAAKwT,GAAS,KAAOA,GACrBC,KAAK,MACRT,EAAW,cAAaG,UAAqBG,eAE/C,OAAON,ED4BWU,CAAa5P,EAAO5D,KAAM4D,EAAOkP,SAG3CW,EAAiB,MAClB9O,EAAO8O,eADQ,CAElB,CAAC7P,EAAO5D,MAAO8S,IAIb1N,GAAYA,EAASpF,OAAS4D,EAAO5D,aAChCyT,EAAerO,EAASpF,MAIjC,MAAM0T,EAAY,KACb,UAAC/O,EAAOiB,oBAAoB8N,iBAA5B,QAAyC,IAAInP,OAAQvE,GAASA,KAASoF,aAAL,EAAKA,EAAUpF,OACpF4D,EAAO5D,MAGHiS,EAAsC,CAC1CwB,iBACA7N,oBAAqB,MAChBjB,EAAOiB,oBADO,CAEjB8N,eAGJlC,EACEQ,YAA+B,CAC7BlC,yBACAmC,YACAC,UAAWvN,EACXwN,eAAgB,kBAChBC,aAAc,+BAqBlB,UACE,6BAAKhN,EAAW,wBAA0B,4BACzC9F,GACC,cAAC,QAAD,CAAO+P,SAAS,QAAQ1O,MAAM,wBAA9B,SACGrB,EAAMmN,UAAYnN,SAAlB,UAAkBA,EAAeqU,YAAjC,aAAiB,EAAsBlH,UAAWhJ,OAAOnE,KAG9D,cAAC,QAAD,CAAOsC,MAAM,gBAAgBtC,MAAO+J,SAAF,UAAEA,EAAQrJ,YAAV,aAAE,EAAcyM,QAASD,UAAU,UAACnD,EAAOrJ,YAAR,QAAC,EAAayM,SAAnF,SACE,cAAC,QAAD,MACM9F,EAAS,OAAQ,CACnB1E,SAAU,CAAEuE,OAAO,EAAMiG,QAAS,aAClCM,SAAU,CAAE6G,aAlB0B5T,IACtC2E,EAAO8O,eAAezT,KAASoF,aAAA,EAAAA,EAAUpF,QAASA,GAEtD,qDAYA,CAKEH,MAAO,GACPgU,WAAW,OAGf,cAAC,QAAD,CACEhS,YACE,uDACkB,IAChB,mBACEnC,KAAK,oDACLoU,OAAO,UACPC,IAAI,aACJvU,UAAW+J,EAAOyK,aAJpB,oCAFF,IAUI,IACF,mBACEtU,KAAK,uEACLoU,OAAO,UACPC,IAAI,aACJvU,UAAW+J,EAAOyK,aAJpB,uDAUJpS,MAAM,UACNtC,MAAO+J,SAAF,UAAEA,EAAQyJ,eAAV,aAAE,EAAiBrG,QACxBD,UAAU,UAACnD,EAAOyJ,eAAR,QAAC,EAAgBrG,SAzB7B,SA2BE,cAAC,WAAD,MACM9F,EAAS,UAAW,CAAE1E,SAAU,CAAEuE,OAAO,EAAMiG,QAAS,eAD9D,CAEEjN,UAAW+J,EAAO0K,SAClBC,KAAM,QAGV,sBAAK1U,UAAW+J,EAAO4F,QAAvB,UACGlO,IAAY,QACX,cAAC,SAAD,CAAQb,UAAU,EAAMX,KAAK,gBAAgBY,QAAQ,UAArD,0BAIAY,IAAD,QAAY,cAAC,SAAD,CAAQZ,QAAQ,UAAhB,6BACb,cAAC,aAAD,CACED,SAAUa,EACVvB,KAAM2R,YAAW,yBAA0BvB,GAC3CzP,QAAQ,YACRJ,KAAK,SACLmR,KAAK,UALP,2BAcFhH,GAAahC,IAAD,CAChB4L,aAAc1L,KAAI;aACPF,EAAMK,OAAO7H,KAAKkI;;IAG7BqG,QAAS7G,KAAI;;qBAEMF,EAAMI,QAAQ;;IAGjCyL,SAAU3L,KAAI;;aEnKT,MAAM6L,GAA8B,EAAGxP,SAAQsO,eAAcnD,6BAA6B,MAC/F,MAAMsE,EAAQ,UAAGzP,EAAO8O,sBAAV,aAAG,EAAwBR,GACzC,OAAKmB,EAQH,cAACrB,GAAD,CACEjD,uBAAwBA,EACxBnL,OAAQA,EACRS,SAAU,CAAEpF,KAAMiT,EAAcH,QAASsB,KAV3C,QACE,cAAC,UAAD,CAAS/E,SAAS,QAAQ1O,MAAM,qBAAhC,2D,2NCON,MAAMkL,GAA4B,CAChCwI,kBAAkB,GAGPC,GAA8B,EAAG3P,SAAQmL,6BAA6B,MACjF,MAAM0B,EAAWC,wBACjBvB,YAAY9R,GAAUA,EAAM+R,gBAAgBC,cAC5C,MAAM,QAAEnP,EAAF,MAAW3B,GAAU+Q,YAA4BjS,GAAUA,EAAMgS,cAEjE7G,EAASC,qBAAWY,IAEpBrD,EAAUkJ,YAAoB,CAElCpE,cAAepE,KAAKC,MAClBD,KAAKE,UAAL,MACKkE,GADL,UAEMlH,EAAOiB,oBAAoB2O,cAFjC,QAE2C,SAKzC,aACJjE,EACAC,WAAW,OAAElH,IACXtC,EAoBJ,OACE,cAAC,IAAD,MAAkBA,EAAlB,UACE,uBAAMgJ,SAAUO,EApBM1M,IACxB4N,EACEQ,YAA+B,CAC7BC,UAAW,MACNtN,EADI,CAEPiB,oBAAqB,MAChBjB,EAAOiB,oBADO,CAEjB2O,OAAQjP,EAAgB1B,OAG5BsO,UAAWvN,EACXmL,yBACAqC,eAAgB,yBAChBC,aAAcf,YAAW,0BAA2BvB,QAOtD,UACE,oBAAItQ,UAAW+J,EAAOzG,QAAtB,2BACCxD,GACC,cAAC,QAAD,CAAO+P,SAAS,QAAQ1O,MAAM,wBAA9B,SACGrB,EAAMmN,SAAWhJ,OAAOnE,KAG5B0D,EAAoBlD,IAAK4B,GACxB,cAACuI,GAAD,CACEX,aAAcuC,GAAcnK,EAAOC,cAEnCD,OAAQA,EACRpC,MAAO+J,EAAO3H,EAAOC,cACrB+E,WAAY,IAHPhF,EAAOC,eAMhB,8BACE,eAAC,kBAAD,WACGV,IAAY,QACX,cAAC,SAAD,CAAQb,UAAU,EAAMX,KAAK,gBAAgBY,QAAQ,UAArD,0BAIAY,IAAD,QAAY,cAAC,SAAD,CAAQhB,KAAK,SAAb,kCACb,cAAC,aAAD,CACEG,SAAUa,EACVmQ,KAAK,UACL/Q,QAAQ,YACRX,KAAM2R,YAAW,yBAA0BvB,GAJ7C,gCAeN1F,GAAahC,IAAD,CAChBtF,QAASwF,KAAI;cACDF,EAAMI,QAAQ,EAAG;MClGlBgM,GAA6B,EAAG1E,yBAAwBnL,YAC/DmL,IAA2B6C,IACtB,cAACL,GAAD,CAAqBxC,uBAAwBA,EAAwBnL,OAAQA,IAE7E,cAAC4M,GAAD,CAAmBzB,uBAAwBA,EAAwBnL,OAAQA,ICNzE8P,GAA6B,EAAG9P,SAAQmL,4BAC5C,cAACiD,GAAD,CAAcpO,OAAQA,EAAQmL,uBAAwBA,I,iBCVxD,MAAM4E,GAA4C,CACvDC,UAAW,YACXC,SAAU,WACVC,MAAO,QACPC,SAAU,WACVC,QAAS,UACTC,UAAW,YACXC,OAAQ,U,iNCEH,SAASC,GAA0BhS,EAAoBqP,GACV,MAAlD,OAAIrP,EAAQ,iCAoBd,SACEuB,EACA8N,GAEA,OAAO9N,EACJ3E,IAAK8R,GAASA,EAAK3R,MACnBH,IAAKG,IAAD,mCAAUsS,EAAiB5O,KAAMwR,GAAMA,EAAElV,OAASA,UAAlD,aAAU,EAA+CD,YAAzD,QAAiEoV,qBAAWnV,KAChFoV,OACC,CAACC,EAAKrV,KAAN,mBACKqV,EADL,CAEE,CAACrV,IAAO,UAACqV,EAAIrV,UAAL,QAAc,GAAK,KAE7B,IA/BKsV,CAA4B,UAACrS,EAASK,wCAAV,QAA8C,GAAIgP,GAKzF,SAAiDrP,GAC/C,OAAOmB,OAAOC,QAAQpB,GACnBqB,OAAO,EAAEgC,KAAiB,qCAARA,GAA8CA,EAAI/B,SAAS,aAC7ED,OAAO,EAAEiR,EAAGhP,KAAWiP,MAAMnP,QAAQE,MAAYA,EAAMjH,QACvD8V,OAA2B,CAACC,GAAM/O,EAAKC,MAAW,QACjD,MAAMvG,EAAOsG,EAAI7B,QAAQ,WAAY,IAC/B1E,EAAI,UAAG0U,GAAkBzU,UAArB,QAA8BmV,qBAAWnV,GACnD,aACKqV,EADL,CAEE,CAACtV,IAAO,UAACsV,EAAItV,UAAL,QAAc,IAAMyV,MAAMnP,QAAQE,GAASA,EAAMjH,OAAS,MAEnE,IAdEmW,CAAwCxS,G,iBCC1C,MAAMyS,GAA8B,EACzCnW,YACAmB,QACAkB,cACA+T,iBACAC,cACAvK,eAEA,MAAM/B,EAASC,qBAAWY,IAC1B,OACE,qCACE,sBAAK5K,UAAWiM,aAAGlC,EAAOzG,QAAStD,GAAnC,UACE,gCACE,6BAAKmB,IACL,mBAAGnB,UAAW+J,EAAO1H,YAArB,SAAmCA,OAErC,cAAC,QAAD,CAAMiU,GAAID,EAAV,SACE,cAAC,SAAD,CAAQpW,KAAK,OAAb,SAAqBmW,SAGxBtK,MAKDlB,GAAahC,IAAD,CAChBtF,QAASwF,KAAI;;;IAIbzG,YAAayG,KAAI;aACNF,EAAMK,OAAO7H,KAAKkI;mCCzBxB,MAAMiN,GAA4B,EAAGpR,SAAQqR,uBAClD,MAAMxE,EAAWC,wBACXwE,EAAczM,qBAAW0M,MACzB3M,EAASC,qBAAWY,IAEpBmI,EAAmBlC,YAA4BjS,GAAUA,EAAMmU,mBAG9D4D,EAAkBC,GAAuB3X,sBACzC4X,EAA+BC,GAAoC7X,oBAAS,GAiB7EyV,EAAOzF,kBACX,wCACE9J,EAAOiB,oBAAoBC,iBAD7B,aACE,EAAsC/F,IAAKoD,IAAD,YAAe,CACvDlD,KAAMkD,EAASlD,KACfuW,MAAOlS,OAAOC,QAAQ4Q,GAA0BhS,EAAD,UAAWqP,EAAiBC,cAA5B,QAAsC,KAAK1S,IACxF,EAAEG,EAAMuW,KACFA,EAAQ,EACF,GAAEvW,MAASuW,KAEdvW,aARf,QAWS,IACT,CAAC0E,EAAQ4N,EAAiBC,SAG5B,OACE,eAACmD,GAAD,CACEnW,UAAW+J,EAAOkN,QAClB9V,MAAM,iBACNkB,YAAY,8EACZ+T,eAAe,oBACfC,YAAaxE,YAAW,wCAAyC2E,GALnE,UAOE,wBAAOxW,UAAWyW,EAAYlL,MAAOlB,cAAY,kBAAjD,kBACE,qCACE,wBACA,wBACA,4BAJJ,QAME,gCACE,+BACE,oDACA,sCACA,+CAGJ,mCACIqK,EAAK3U,QACL,oBAAIC,UAAWyW,EAAYS,QAA3B,iBACE,oBAAIC,QAAS,EAAb,sCAGHzC,EAAKpU,IAAI,CAACoD,EAAU0T,IACnB,qBAAwBpX,UAAWoX,EAAM,GAAM,EAAIX,EAAYS,aAAUhN,EAAzE,UACE,6BAAKxG,EAASlD,OACd,6BAAKkD,EAASqT,MAAMhD,KAAK,QACzB,qBAAI/T,UAAWyW,EAAYY,YAA3B,UACE,cAAC/M,EAAA,EAAD,CACED,cAAY,OACZiM,GAAIzE,YACD,qCAAoCyF,mBAAmB5T,EAASlD,aACjEgW,GAEFjM,QAAQ,qBACRtK,KAAK,QAEP,cAACqK,EAAA,EAAD,CACEvJ,QAAS,KAAMwW,OAzEAlE,EAyEsB3P,EAASlD,UAxExDgX,aAAenE,EAAclO,GAC/B2R,GAAiC,GAEjCF,EAAoBvD,IAJOA,OA0Ef9I,QAAQ,uBACRtK,KAAK,mBAhBFyD,EAASlD,eAuBrBqW,GACD,eAAC,QAAD,CACEY,QAAQ,EACRtW,MAAM,8BACNuW,UAAW,IAAMZ,GAAiC,GAHpD,kBAKE,oJAIA,cAAC,QAAMa,UAAP,UACE,cAAC,SAAD,CAAQ9W,QAAQ,YAAYE,QAAS,IAAM+V,GAAiC,GAAQlF,KAAK,UAAzF,0BAMH+E,GACD,cAAC,eAAD,CACEc,QAAQ,EACRtW,MAAM,uBACNyW,KAAO,kDAAiDjB,MACxDrV,YAAY,cACZE,UAjGe,KACjBmV,GACF3E,EAAS6F,YAAqBlB,EAAkBH,IAElDI,OAAoB1M,IA8FdwN,UAAW,IAAMd,OAAoB1M,SAOzCU,GAAahC,IAAD,CAChBqO,QAASnO,KAAI;kBACGF,EAAMI,QAAQ;oQCjIzB,MAAM8O,GAA4B,EAAG3S,SAAQqR,uBAClD,MAAMxE,EAAWC,yBACV8F,EAAmBC,GAAwB/Y,mBAAkC,IAC9EwX,EAAczM,qBAAW0M,MAEzBuB,EAAehJ,kBAAQ,IAAMpK,OAAOC,QAAQK,EAAO8O,gBAAiB,CAAC9O,KACpE+S,EAAkBC,GAAuBlZ,qBAShD,OACE,eAACkX,GAAD,CACEhV,MAAM,oBACNkB,YAAY,wEACZ+T,eAAe,eACfC,YAAaxE,YAAW,wCAAyC2E,GAJnE,UAME,wBAAOxW,UAAWyW,EAAYlL,MAAOlB,cAAY,kBAAjD,UACE,qCACE,qBAAKrK,UAAWyW,EAAY2B,YAD9B,QAEE,yBAFF,QAGE,4BAJJ,QAME,gCACE,+BACE,uBACA,0CACA,+CAGJ,mCACIH,EAAalY,QACb,oBAAIC,UAAWyW,EAAYS,QAA3B,iBACE,oBAAIC,QAAS,EAAb,sCAGHc,EAAa3X,IAAI,EAAEE,EAAM8S,GAAU8D,KAClC,MAAMiB,IAAeN,EAAkBvX,GACvC,OACE,eAAC,WAAD,WACE,qBAAeR,UAAWoX,EAAM,GAAM,EAAIX,EAAYS,aAAUhN,EAAhE,UACE,6BACE,cAACoO,GAAA,EAAD,CACEvM,aAAcgM,EAAkBvX,GAChC+X,SAAU,IAAMP,EAAqB,MAAKD,EAAN,CAAyB,CAACvX,IAAQ6X,SAG1E,6BAAK7X,IACL,qBAAIR,UAAWyW,EAAYY,YAA3B,UACE,cAAC/M,EAAA,EAAD,CACEgM,GAAIzE,YACD,qCAAoCyF,mBAAmB9W,UACxDgW,GAEFjM,QAAQ,gBACRtK,KAAK,QAEP,cAACqK,EAAA,EAAD,CAAYvJ,QAAS,IAAMoX,EAAoB3X,GAAO+J,QAAQ,kBAAkBtK,KAAK,mBAjBhFO,GAoBR6X,GACC,qBAAIrY,UAAWoX,EAAM,GAAM,EAAIX,EAAYS,aAAUhN,EAArD,kBACE,wBACA,oBAAIiN,QAAS,EAAb,SACE,cAACqB,GAAA,EAAD,CAAcpW,MAAM,cAAcqW,YAAY,EAA9C,SACE,8BAAMnF,aA1BD9S,aAqCpB0X,GACD,cAAC,eAAD,CACET,QAAQ,EACRtW,MAAM,kBACNyW,KAAO,6CAA4CM,MACnD5W,YAAY,cACZE,UA/Ee,KACjB0W,GACFlG,EAAS0G,YAAqBR,EAAkB1B,IAElD2B,OAAoBjO,IA4EdwN,UAAW,IAAMS,OAAoBjO,S,OC1FxC,MAAMyO,GAAuC,EAAGxT,SAAQqR,uBAC7D,MAAMoC,EAAUpC,IAAqBrD,IAC/BpJ,EAASC,qBAAWY,IAC1B,OACE,qCACE,cAACkN,GAAD,CAAgB3S,OAAQA,EAAQqR,iBAAkBA,IAClD,cAACD,GAAD,CAAgBpR,OAAQA,EAAQqR,iBAAkBA,IACjDoC,GACC,eAAC,QAAD,CAAO5Y,UAAW+J,EAAOkN,QAASpH,SAAS,OAAO1O,MAAM,mCAAxD,kBACE,qLAIA,cAAC,aAAD,CAAYjB,KAAM2R,YAAW,uCAAwC2E,GAAmB3V,QAAQ,YAAhG,uCASJ+J,GAAahC,IAAD,CAChBqO,QAASnO,KAAI;kBACGF,EAAMI,QAAQ;0CCmEjB6P,mCAxFO,KACpB,MAAOvI,EAAwBwI,GAA6BC,eACtD/G,EAAWC,wBAGX+G,EADWC,cACOC,SAASlU,SAAS,2BAEpCmU,EAAiBtI,YAA4BjS,GAAUA,EAAMwa,YAE3DpG,OAAQ7N,EAAV,QAAkB1D,EAAlB,MAA2B3B,GAC9BwQ,GAA0B6I,EAAe7I,IAA4B+I,KAClEC,EAAgBzI,YAA4BjS,GAAUA,EAAMmU,kBAE5DwG,EAAmBP,IAAW7T,EAEpC5F,oBAAU,KACJ+Q,GAA0BiJ,GAC5BvH,EAASwH,YAA8BlJ,KAExC,CAACA,EAAwB0B,EAAUuH,IAEtCha,oBAAU,KACJ+Q,IAA2B6C,KAA+BmG,EAActG,QAAUsG,EAAc7X,SAClGuQ,EAASiB,gBAEV,CAAC3C,EAAwB0B,EAAUsH,IAEtC,MAAMG,GAAmBT,EAEzB,OAAK1I,EAKH,eAACoJ,EAAA,EAAD,CAAqBC,OAAO,YAA5B,UACE,cAACC,EAAA,EAAD,CACEC,QAASvJ,EACT1P,SAAU6Y,EACV9O,SAAUmO,IAEXhZ,IAAU2B,GACT,cAAC,QAAD,CAAOoO,SAAS,QAAQ1O,MAAM,oCAA9B,SACGrB,EAAMmN,SAAW,mBAGrBxL,IAAY0D,IAAZ,QAAsB,cAAC,qBAAD,CAAoB/D,KAAK,+BAC/C+D,IAAWrF,GACV,eAAC,IAAD,WACE,cAAC,IAAD,CAAOga,OAAO,EAAMxN,KAAK,0BAAzB,SACE,cAACqM,GAAD,CAA2BxT,OAAQA,EAAQqR,iBAAkBlG,MAE/D,cAAC,IAAD,CAAOwJ,OAAO,EAAMxN,KAAK,wCAAzB,SACE,cAAC2I,GAAD,CAAiB9P,OAAQA,EAAQmL,uBAAwBA,MAE3D,cAAC,IAAD,CAAOwJ,OAAO,EAAMxN,KAAK,+CAAzB,SACG,EAAGqH,YACFA,aAAA,EAAAA,EAAOoG,OAAOvZ,OACZ,cAACmU,GAAD,CACErE,uBAAwBA,EACxBnL,OAAQA,EACRsO,aAAcuG,mBAAmBrG,aAAD,EAACA,EAAOoG,OAAOvZ,UAKvD,cAAC,IAAD,CAAOsZ,OAAO,EAAMxN,KAAK,wCAAzB,SACE,cAAC0I,GAAD,CAAiB7P,OAAQA,EAAQmL,uBAAwBA,MAE3D,cAAC,IAAD,CAAOwJ,OAAO,EAAMxN,KAAK,+CAAzB,SACG,EAAGqH,YACFA,aAAA,EAAAA,EAAOoG,OAAOvZ,OACZ,cAAC4S,GAAD,CACE9C,uBAAwBA,EACxBnL,OAAQA,EACRkO,aAAc2G,mBAAmBrG,aAAD,EAACA,EAAOoG,OAAOvZ,UAKvD,cAAC,IAAD,CAAOsZ,OAAO,EAAMxN,KAAK,wCAAzB,SACE,cAACwI,GAAD,CAAkB3P,OAAQA,EAAQmL,uBAAwBA,YAlDlE,QAAO,cAAC,IAAD,CAAUgG,GAAG,8BA0DoB,CAAEnW,MAAO,SCpGtCgF,mBAAO8U,eAAeC,QAAUC,GAAY5b,G,qCCL3D,sFAIO,SAAS6b,IACd,MAAM,OAAEC,GAAWpB,cAMnB,MAAO,CALahK,kBAAQ,IAAMqL,iCAAuBD,GAAU,IAAK,CAACA,IAC1DtS,sBACb,CAAC3D,EAAqBc,IAAsBqV,EAAa,IAAMC,kBAAgBC,QAAQrW,EAAQc,IAC/F,Q,wcCSG,MAAMoF,EAAwB,IAS/B,UATgC,QACpCC,EADoC,KAEpCtK,EAFoC,GAGpCqW,EAHoC,OAIpChC,EAJoC,QAKpCvT,EALoC,UAMpCf,EANoC,iBAOpC0a,EAAmB,OAEf,EADDpY,E,oIACC,MACJ,MAAMqY,EAAS,cAAC,OAAD,GAAM3a,UAAWiM,aAAG2O,oBAAUC,GAAW7a,GAAYe,QAASA,EAASP,KAAMP,GAAUqC,IAEtG,OACE,cAAC,UAAD,CAASgR,QAAS/I,EAASuQ,UAAWJ,EAAtC,SAEQpE,EACF,MACE,cAAC,OAAD,CAAMA,GAAIA,EAAIhC,OAAQA,EAAtB,SACGqG,KAIAA,KAMFE,EAAW,IAAM/R,KAAI;;qCC9ClC,kDAEO,MAAM4N,EAAuB9N,IAAD,CACjC2C,MAAOzC,KAAI;;qBAEQF,EAAMQ,MAAMC;wBACTT,EAAMK,OAAOC,OAAO6R;wBACpBnS,EAAMK,OAAO+R,WAAW1R;;;iBAG/BV,EAAMI,QAAQ;;;;mBAIZJ,EAAMI,QAAQ;;;;;;IAO/BkO,QAASpO,KAAI;wBACSF,EAAMK,OAAO+R,WAAWC;IAE9C7C,UAAWtP,KAAI;;IAGfuO,YAAavO,KAAI;;;;;;qBAMEF,EAAMI,QAAQ;;yCClCnC,0EAIO,SAAS0H,EAAcwK,GAC5B,MAAMlJ,EAAWC,wBAEXkJ,EAAcC,iBAAOF,GAC3BC,EAAYtB,QAAUqB,EACtB3b,oBAAU,IACD,KACLyS,EAASqJ,YAAc,CAAEH,cAAeC,EAAYtB,YAErD,CAAC7H,M,sBCbN,iCAC6B,oBAATsJ,MAAwBA,MAChCC,OACRC,EAAQC,SAASC,UAAUF,MAiB/B,SAASG,EAAQld,EAAImd,GACnBC,KAAKC,IAAMrd,EACXod,KAAKE,SAAWH,EAflBI,EAAQC,WAAa,WACnB,OAAO,IAAIN,EAAQH,EAAMU,KAAKD,WAAYE,EAAOC,WAAYC,eAE/DL,EAAQM,YAAc,WACpB,OAAO,IAAIX,EAAQH,EAAMU,KAAKI,YAAaH,EAAOC,WAAYG,gBAEhEP,EAAQK,aACRL,EAAQO,cAAgB,SAASC,GAC3BA,GACFA,EAAQC,SAQZd,EAAQD,UAAUgB,MAAQf,EAAQD,UAAUiB,IAAM,aAClDhB,EAAQD,UAAUe,MAAQ,WACxBZ,KAAKE,SAASG,KAAKC,EAAON,KAAKC,MAIjCE,EAAQY,OAAS,SAASxL,EAAMyL,GAC9BR,aAAajL,EAAK0L,gBAClB1L,EAAK2L,aAAeF,GAGtBb,EAAQgB,SAAW,SAAS5L,GAC1BiL,aAAajL,EAAK0L,gBAClB1L,EAAK2L,cAAgB,GAGvBf,EAAQiB,aAAejB,EAAQkB,OAAS,SAAS9L,GAC/CiL,aAAajL,EAAK0L,gBAElB,IAAID,EAAQzL,EAAK2L,aACbF,GAAS,IACXzL,EAAK0L,eAAiBb,YAAW,WAC3B7K,EAAK+L,YACP/L,EAAK+L,eACNN,KAKP,EAAQ,QAIRb,EAAQzB,aAAgC,oBAATe,MAAwBA,KAAKf,mBAClB,IAAXxF,GAA0BA,EAAOwF,cACxCsB,MAAQA,KAAKtB,aACrCyB,EAAQoB,eAAkC,oBAAT9B,MAAwBA,KAAK8B,qBAClB,IAAXrI,GAA0BA,EAAOqI,gBACxCvB,MAAQA,KAAKuB,iB,4CC9DvC,6BACI,aAEA,IAAIrI,EAAOwF,aAAX,CAIA,IAII8C,EA6HIC,EAZAtZ,EArBAuZ,EACAC,EAjGJC,EAAa,EACbC,EAAgB,GAChBC,GAAwB,EACxBC,EAAM7I,EAAO8I,SAoJbC,EAAWjZ,OAAOkZ,gBAAkBlZ,OAAOkZ,eAAehJ,GAC9D+I,EAAWA,GAAYA,EAAS7B,WAAa6B,EAAW/I,EAGf,qBAArC,GAAGiJ,SAAS9B,KAAKnH,EAAOkJ,SApFxBZ,EAAoB,SAASa,GACzBD,EAAQE,UAAS,WAAcC,EAAaF,QAIpD,WAGI,GAAInJ,EAAOsJ,cAAgBtJ,EAAOuJ,cAAe,CAC7C,IAAIC,GAA4B,EAC5BC,EAAezJ,EAAO0J,UAM1B,OALA1J,EAAO0J,UAAY,WACfF,GAA4B,GAEhCxJ,EAAOsJ,YAAY,GAAI,KACvBtJ,EAAO0J,UAAYD,EACZD,GAwEJG,GAIA3J,EAAO4J,iBA9CV3a,EAAU,IAAI2a,gBACVC,MAAMH,UAAY,SAASI,GAE/BT,EADaS,EAAM1K,OAIvBkJ,EAAoB,SAASa,GACzBla,EAAQ8a,MAAMT,YAAYH,KA2CvBN,GAAO,uBAAwBA,EAAImB,cAAc,WAtCpDzB,EAAOM,EAAIoB,gBACf3B,EAAoB,SAASa,GAGzB,IAAIe,EAASrB,EAAImB,cAAc,UAC/BE,EAAOC,mBAAqB,WACxBd,EAAaF,GACbe,EAAOC,mBAAqB,KAC5B5B,EAAK6B,YAAYF,GACjBA,EAAS,MAEb3B,EAAK8B,YAAYH,KAKrB5B,EAAoB,SAASa,GACzBjC,WAAWmC,EAAc,EAAGF,KAlD5BX,EAAgB,gBAAkB/Q,KAAKC,SAAW,IAClD+Q,EAAkB,SAASqB,GACvBA,EAAMQ,SAAWtK,GACK,iBAAf8J,EAAM1K,MACyB,IAAtC0K,EAAM1K,KAAKmL,QAAQ/B,IACnBa,GAAcS,EAAM1K,KAAK1L,MAAM8U,EAAcxd,UAIjDgV,EAAOwK,iBACPxK,EAAOwK,iBAAiB,UAAW/B,GAAiB,GAEpDzI,EAAOyK,YAAY,YAAahC,GAGpCH,EAAoB,SAASa,GACzBnJ,EAAOsJ,YAAYd,EAAgBW,EAAQ,OAgEnDJ,EAASvD,aA1KT,SAAsBkF,GAEI,mBAAbA,IACTA,EAAW,IAAIhE,SAAS,GAAKgE,IAI/B,IADA,IAAIC,EAAO,IAAIzJ,MAAMmG,UAAUrc,OAAS,GAC/BuL,EAAI,EAAGA,EAAIoU,EAAK3f,OAAQuL,IAC7BoU,EAAKpU,GAAK8Q,UAAU9Q,EAAI,GAG5B,IAAIqU,EAAO,CAAEF,SAAUA,EAAUC,KAAMA,GAGvC,OAFAhC,EAAcD,GAAckC,EAC5BtC,EAAkBI,GACXA,KA6JTK,EAASV,eAAiBA,EA1J1B,SAASA,EAAec,UACbR,EAAcQ,GAyBzB,SAASE,EAAaF,GAGlB,GAAIP,EAGA1B,WAAWmC,EAAc,EAAGF,OACzB,CACH,IAAIyB,EAAOjC,EAAcQ,GACzB,GAAIyB,EAAM,CACNhC,GAAwB,EACxB,KAjCZ,SAAagC,GACT,IAAIF,EAAWE,EAAKF,SAChBC,EAAOC,EAAKD,KAChB,OAAQA,EAAK3f,QACb,KAAK,EACD0f,IACA,MACJ,KAAK,EACDA,EAASC,EAAK,IACd,MACJ,KAAK,EACDD,EAASC,EAAK,GAAIA,EAAK,IACvB,MACJ,KAAK,EACDD,EAASC,EAAK,GAAIA,EAAK,GAAIA,EAAK,IAChC,MACJ,QACID,EAASjE,WAnDrB,EAmDsCkE,IAiBlBE,CAAID,GACN,QACEvC,EAAec,GACfP,GAAwB,MAvE5C,CAyLkB,oBAATrC,UAAyC,IAAXvG,EAAyB8G,KAAO9G,EAASuG,Q,kECzLhF,kGAMA,SAASuE,EAAqBvP,GAC5B,OACEA,IAA2B6C,OACzB2M,cAA6B3b,KAAM4b,GAAOA,EAAGvf,OAAS8P,GAQrD,SAASyI,IACd,MAAOiH,EAAaC,GAAqB7F,cAEnCtS,EAASC,sBACZuI,IACMuP,EAAqBvP,KAGtBA,IAA2B6C,KAC7B+M,IAAMvgB,OAAOwgB,KACbF,EAAkB,CAAE,CAACG,KAA8B,SAEnDF,IAAM7X,IAAI8X,IAAqC7P,GAC/C2P,EAAkB,CAAE,CAACG,KAA8B9P,OAGvD,CAAC2P,IAGGI,EAAcL,EAAYI,KAEhC,GAAIC,GAAsC,iBAAhBA,EACxB,OAAIR,EAAqBQ,GAChB,CAACA,EAAavY,GAGd,MAACoC,EAAWpC,GAGvB,MAAMwY,EAAcJ,IAAM5gB,IAAI6gB,KAC9B,OAAIG,GAAsC,iBAAhBA,GAA4BT,EAAqBS,IACzExY,EAAOwY,GACA,CAACA,EAAaxY,IAGhB,CAACqL,IAA2BrL,K,kCCpDrC,oFAWO,MAAM0Q,EAA0B,EAAGxY,YAAWoC,QAAOqW,aAAY3M,eACtE,MAAM/B,EAASC,qBAAWY,GAE1B,OACE,sBAAK5K,UAAWiM,aAAGjM,EAAW+J,EAAOjH,MAAO2V,EAAa1O,EAAOwW,gBAAkBxW,EAAOyW,eAAzF,UACE,8BAAMpe,IACN,8BAAM0J,QAKNlB,EAAahC,IAAD,CAChB2X,gBAAiBzX,KAAI;;MAEjBF,EAAMkH,YAAY2Q,KAAK;;;IAI3BD,cAAe1X,KAAI;;IAGnBhG,MAAOgG,KAAI;;cAECF,EAAMI,QAAQ;;;;uBAILJ,EAAMI,QAAQ;mBAClBJ,EAAMW,WAAWzI,KAAK0I;qBACpBZ,EAAMW,WAAWmX;;;;;eAKvB9X,EAAMK,OAAO7H,KAAKkI;;yCC5CjC,8GAYO,MAAMsQ,EAAgC,EAAGjP,WAAUkP,UAASjZ,YAAW,MAC5E,MAAMmJ,EAASC,qBAAWY,GAEpBrH,EAA0C0L,kBAAQ,IAC/C,CACL,CACE7M,MAAO,UACP4E,MAAOmM,IACPwN,OAAQ,8BACRC,KAAM,OAELC,cACA9b,OAAQgb,GAAOA,EAAGtf,OAASqgB,IAAeC,cAC1CzgB,IAAKyf,IAAD,CACH3d,MAAO2d,EAAGvf,KAAKwgB,OAAO,EAAG,IACzBha,MAAO+Y,EAAGvf,KACVmgB,OAAQZ,EAAGa,KAAKvd,KAAK4d,MAAMC,MAC3BN,KAAMb,EAAGa,SAGd,IAGH,OAAuB,IAAnBrd,EAAQxD,OACH,KAIP,cAAC,QAAD,CACEC,UAAW+J,EAAOjH,MAClBV,MAAOxB,EAAW,eAAiB,sBACnCA,SAAUA,EACVyJ,cAAY,sBAJd,SAME,cAAC,SAAD,CACEqD,kBAAgB,EAChBrN,MAAO,GACPL,UAAU,6BACVmhB,uBAAuB,EACvBxW,SAAW3D,GAAUA,EAAMA,OAAS2D,EAAS3D,EAAMA,OACnDzD,QAASA,EACT6d,cAAe,IACfC,iBAAiB,uBACjBra,MAAO6S,EACPyH,eAAiB/R,GAAMA,EAAEnN,WAM3BwI,EAAahC,IAAD,CAChB9F,MAAOgG,KAAI;qBACQF,EAAMI,QAAQ;2CCjEnC,gGAWO,MAAM0Q,EAAiC,EAAG5N,WAAU6N,SAAQ4H,gBACjE,MAAM/iB,EAAWK,YACfF,sBAAaC,GAAsBA,EAAMF,UACzCib,GAGF,OACE,cAAC,IAAD,CAAMnb,SAAUA,EAAhB,SACE,cAAC,IAAKqB,SAAN,CAAe0hB,UAAWA,EAA1B,SAAsCzV,Q,oYCPrC,MAAMwM,EAA4B,IAA6E,IAA5E,YAAEvM,EAAF,SAAewM,EAAf,UAAyBvY,EAAzB,KAAoCoB,EAApC,KAA0CN,EAAO,MAA2B,EAAlB0gB,E,oIAAkB,MACpH,MAAMzX,EAAS6Q,oBAAUhQ,GAEzB,OACE,2BAAQ5K,UAAWiM,aAAGlC,EAAO0X,aAAczhB,GAAYe,QAAS,IAAMwX,GAAUxM,IAAkByV,EAAlG,WACE,cAAC,OAAD,CAAM1gB,KAAMA,EAAMN,KAAMuL,EAAc,cAAgB,eACrD3K,OAKMwJ,EAAY,KAAM,CAC7B6W,aAAc3Y,KAAI","file":"NotificationsListPage.62c612232a976d8836f5.js","sourcesContent":["import React, { useState, FC, useEffect } from 'react';\nimport EmptyListCTA from 'app/core/components/EmptyListCTA/EmptyListCTA';\nimport Page from 'app/core/components/Page/Page';\nimport { getBackendSrv } from '@grafana/runtime';\nimport { useAsyncFn } from 'react-use';\nimport { appEvents } from 'app/core/core';\nimport { useNavModel } from 'app/core/hooks/useNavModel';\nimport { HorizontalGroup, Button, LinkButton } from '@grafana/ui';\nimport { AlertNotification } from 'app/types/alerting';\nimport { ShowConfirmModalEvent } from '../../types/events';\n\nconst NotificationsListPage: FC = () => {\n  const navModel = useNavModel('channels');\n\n  const [notifications, setNotifications] = useState<AlertNotification[]>([]);\n\n  const getNotifications = async () => {\n    return await getBackendSrv().get(`/api/alert-notifications`);\n  };\n\n  const [state, fetchNotifications] = useAsyncFn(getNotifications);\n  useEffect(() => {\n    fetchNotifications().then((res) => {\n      setNotifications(res);\n    });\n  }, [fetchNotifications]);\n\n  const deleteNotification = (id: number) => {\n    appEvents.publish(\n      new ShowConfirmModalEvent({\n        title: 'Delete',\n        text: 'Do you want to delete this notification channel?',\n        text2: `Deleting this notification channel will not delete from alerts any references to it`,\n        icon: 'trash-alt',\n        confirmText: 'Delete',\n        yesText: 'Delete',\n        onConfirm: async () => {\n          deleteNotificationConfirmed(id);\n        },\n      })\n    );\n  };\n\n  const deleteNotificationConfirmed = async (id: number) => {\n    await getBackendSrv().delete(`/api/alert-notifications/${id}`);\n    const notifications = await fetchNotifications();\n    setNotifications(notifications);\n  };\n\n  return (\n    <Page navModel={navModel}>\n      <Page.Contents>\n        {state.error && <p>{state.error}</p>}\n        {!!notifications.length && (\n          <>\n            <div className=\"page-action-bar\">\n              <div className=\"page-action-bar__spacer\" />\n              <LinkButton icon=\"channel-add\" href=\"alerting/notification/new\">\n                New channel\n              </LinkButton>\n            </div>\n            <table className=\"filter-table filter-table--hover\">\n              <thead>\n                <tr>\n                  <th style={{ minWidth: '200px' }}>\n                    <strong>Name</strong>\n                  </th>\n                  <th style={{ minWidth: '100px' }}>Type</th>\n                  <th style={{ width: '1%' }}></th>\n                </tr>\n              </thead>\n              <tbody>\n                {notifications.map((notification) => (\n                  <tr key={notification.id}>\n                    <td className=\"link-td\">\n                      <a href={`alerting/notification/${notification.id}/edit`}>{notification.name}</a>\n                    </td>\n                    <td className=\"link-td\">\n                      <a href={`alerting/notification/${notification.id}/edit`}>{notification.type}</a>\n                    </td>\n                    <td className=\"text-right\">\n                      <HorizontalGroup justify=\"flex-end\">\n                        {notification.isDefault && (\n                          <Button disabled variant=\"secondary\" size=\"sm\">\n                            default\n                          </Button>\n                        )}\n                        <Button\n                          variant=\"destructive\"\n                          icon=\"times\"\n                          size=\"sm\"\n                          onClick={() => {\n                            deleteNotification(notification.id);\n                          }}\n                        />\n                      </HorizontalGroup>\n                    </td>\n                  </tr>\n                ))}\n              </tbody>\n            </table>\n          </>\n        )}\n\n        {!(notifications.length || state.loading) && (\n          <EmptyListCTA\n            title=\"There are no notification channels defined yet\"\n            buttonIcon=\"channel-add\"\n            buttonLink=\"alerting/notification/new\"\n            buttonTitle=\"Add channel\"\n            proTip=\"You can include images in your alert notifications.\"\n            proTipLink=\"http://docs.grafana.org/alerting/notifications/\"\n            proTipLinkTitle=\"Learn more\"\n            proTipTarget=\"_blank\"\n          />\n        )}\n      </Page.Contents>\n    </Page>\n  );\n};\n\nexport default NotificationsListPage;\n","import { useSelector } from 'react-redux';\nimport { StoreState } from 'app/types/store';\nimport { getNavModel } from '../selectors/navModel';\nimport { NavModel } from '../core';\n\nexport const useNavModel = (id: string): NavModel => {\n  const navIndex = useSelector((state: StoreState) => state.navIndex);\n  return getNavModel(navIndex, id);\n};\n","import { NotificationChannelOption, NotifierDTO } from 'app/types';\n\nfunction option(\n  propertyName: string,\n  label: string,\n  description: string,\n  rest: Partial<NotificationChannelOption> = {}\n): NotificationChannelOption {\n  return {\n    propertyName,\n    label,\n    description,\n    element: 'input',\n    inputType: '',\n    required: false,\n    secure: false,\n    placeholder: '',\n    validationRule: '',\n    showWhen: { field: '', is: '' },\n    ...rest,\n  };\n}\n\nconst basicAuthOption: NotificationChannelOption = option(\n  'basic_auth',\n  'Basic auth',\n  'Sets the `Authorization` header with the configured username and password. Password and password_file are mutually exclusive.',\n  {\n    element: 'subform',\n    subformOptions: [\n      option('username', 'Username', ''),\n      option('password', 'Password', ''),\n      option('password_file', 'Password file', ''),\n    ],\n  }\n);\n\nconst tlsConfigOption: NotificationChannelOption = option('tls_config', 'TLS config', 'Configures the TLS settings.', {\n  element: 'subform',\n  subformOptions: [\n    option('ca_file', 'CA file', 'CA certificate to validate the server certificate with.'),\n    option('cert_file', 'Cert file', 'Certificate for client cert authentication to the server.'),\n    option('key_file', 'Key file', 'Key file for client cert authentication to the server.'),\n    option('server_name', 'Server name', 'ServerName extension to indicate the name of the server.'),\n    option('insecure_skip_verify', 'Skip verify', 'Disable validation of the server certificate.', {\n      element: 'checkbox',\n    }),\n  ],\n});\n\nconst httpConfigOption: NotificationChannelOption = option(\n  'http_config',\n  'HTTP Config',\n  'Note that `basic_auth`, `bearer_token` and `bearer_token_file` options are mutually exclusive.',\n  {\n    element: 'subform',\n    subformOptions: [\n      option('bearer_token', 'Bearer token', 'Sets the `Authorization` header with the configured bearer token.'),\n      option(\n        'bearer_token_file',\n        'Bearer token file',\n        'Sets the `Authorization` header with the bearer token read from the configured file.'\n      ),\n      option('proxy_url', 'Proxy URL', 'Optional proxy URL.'),\n      basicAuthOption,\n      tlsConfigOption,\n    ],\n  }\n);\n\nexport const cloudNotifierTypes: NotifierDTO[] = [\n  {\n    name: 'Email',\n    description: 'Send notification over SMTP',\n    type: 'email',\n    info: '',\n    heading: 'Email settings',\n    options: [\n      option('to', 'To', 'The email address to send notifications to.', { required: true }),\n      option('from', 'From', 'The sender address.'),\n      option('smarthost', 'SMTP host', 'The SMTP host through which emails are sent.'),\n      option('hello', 'Hello', 'The hostname to identify to the SMTP server.'),\n      option('auth_username', 'Username', 'SMTP authentication information'),\n      option('auth_password', 'Password', 'SMTP authentication information'),\n      option('auth_secret', 'Secret', 'SMTP authentication information'),\n      option('auth_identity', 'Identity', 'SMTP authentication information'),\n      option('require_tls', 'Require TLS', 'The SMTP TLS requirement', { element: 'checkbox' }),\n      option('html', 'Email HTML body', 'The HTML body of the email notification.', {\n        placeholder: '{{ template \"email.default.html\" . }}',\n        element: 'textarea',\n      }),\n      option('text', 'Email text body', 'The text body of the email notification.', { element: 'textarea' }),\n      option(\n        'headers',\n        'Headers',\n        'Further headers email header key/value pairs. Overrides any headers previously set by the notification implementation.',\n        { element: 'key_value_map' }\n      ),\n      tlsConfigOption,\n    ],\n  },\n  {\n    name: 'PagerDuty',\n    description: 'Send notifications to PagerDuty',\n    type: 'pagerduty',\n    info: '',\n    heading: 'PagerDuty settings',\n    options: [\n      option(\n        'routing_key',\n        'Routing key',\n        'The PagerDuty integration key (when using PagerDuty integration type `Events API v2`)'\n      ),\n      option(\n        'service_key',\n        'Service key',\n        'The PagerDuty integration key (when using PagerDuty integration type `Prometheus`).'\n      ),\n      option('url', 'URL', 'The URL to send API requests to'),\n      option('client', 'Client', 'The client identification of the Alertmanager.', {\n        placeholder: '{{ template \"pagerduty.default.client\" . }}',\n      }),\n      option('client_url', 'Client URL', 'A backlink to the sender of the notification.', {\n        placeholder: '{{ template \"pagerduty.default.clientURL\" . }}',\n      }),\n      option('description', 'Description', 'A description of the incident.', {\n        placeholder: '{{ template \"pagerduty.default.description\" .}}',\n      }),\n      option('severity', 'Severity', 'Severity of the incident.', { placeholder: 'error' }),\n      option(\n        'details',\n        'Details',\n        'A set of arbitrary key/value pairs that provide further detail about the incident.',\n        {\n          element: 'key_value_map',\n        }\n      ),\n      option('images', 'Images', 'Images to attach to the incident.', {\n        element: 'subform_array',\n        subformOptions: [\n          option('href', 'URL', '', { required: true }),\n          option('source', 'Source', '', { required: true }),\n          option('alt', 'Alt', '', { required: true }),\n        ],\n      }),\n      option('links', 'Links', 'Links to attach to the incident.', {\n        element: 'subform_array',\n        subformOptions: [option('href', 'URL', '', { required: true }), option('text', 'Text', '', { required: true })],\n      }),\n      httpConfigOption,\n    ],\n  },\n  {\n    name: 'Pushover',\n    description: 'Send notifications to Pushover',\n    type: 'pushover',\n    info: '',\n    heading: 'Pushover settings',\n    options: [\n      option('user_key', 'User key', 'The recipient user’s user key.', { required: true }),\n      option('token', 'Token', 'Your registered application’s API token, see https://pushover.net/app', {\n        required: true,\n      }),\n      option('title', 'Title', 'Notification title.', {\n        placeholder: '{{ template \"pushover.default.title\" . }}',\n      }),\n      option('message', 'Message', 'Notification message.', {\n        placeholder: '{{ template \"pushover.default.message\" . }}',\n      }),\n      option('url', 'URL', 'A supplementary URL shown alongside the message.', {\n        placeholder: '{{ template \"pushover.default.url\" . }}',\n      }),\n      option('priority', 'Priority', 'Priority, see https://pushover.net/api#priority', {\n        placeholder: '{{ if eq .Status \"firing\" }}2{{ else }}0{{ end }}',\n      }),\n      option(\n        'retry',\n        'Retry',\n        'How often the Pushover servers will send the same notification to the user. Must be at least 30 seconds.',\n        {\n          placeholder: '1m',\n        }\n      ),\n      option(\n        'expire',\n        'Expire',\n        'How long your notification will continue to be retried for, unless the user acknowledges the notification.',\n        {\n          placeholder: '1h',\n        }\n      ),\n      httpConfigOption,\n    ],\n  },\n  {\n    name: 'Slack',\n    description: 'Send notifications to Slack',\n    type: 'slack',\n    info: '',\n    heading: 'Slack settings',\n    options: [\n      option('api_url', 'Webhook URL', 'The Slack webhook URL.'),\n      option('channel', 'Channel', 'The #channel or @user to send notifications to.', { required: true }),\n      option('icon_emoji', 'Emoji icon', ''),\n      option('icon_url', 'Icon URL', ''),\n      option('link_names', 'Names link', '', { element: 'checkbox' }),\n      option('username', 'Username', '', { placeholder: '{{ template \"slack.default.username\" . }}' }),\n      option('callback_id', 'Callback ID', '', { placeholder: '{{ template \"slack.default.callbackid\" . }}' }),\n      option('color', 'Color', '', { placeholder: '{{ if eq .Status \"firing\" }}danger{{ else }}good{{ end }}' }),\n      option('fallback', 'Fallback', '', { placeholder: '{{ template \"slack.default.fallback\" . }}' }),\n      option('footer', 'Footer', '', { placeholder: '{{ template \"slack.default.footer\" . }}' }),\n      option('mrkdwn_in', 'Mrkdwn fields', 'An array of field names that should be formatted by mrkdwn syntax.', {\n        element: 'string_array',\n      }),\n      option('pretext', 'Pre-text', '', { placeholder: '{{ template \"slack.default.pretext\" . }}' }),\n      option('short_fields', 'Short fields', '', { element: 'checkbox' }),\n      option('text', 'Message body', '', { element: 'textarea', placeholder: '{{ template \"slack.default.text\" . }}' }),\n      option('title', 'Title', '', { placeholder: '{{ template \"slack.default.title\" . }}' }),\n      option('title_link', 'Title link', '', { placeholder: '{{ template \"slack.default.titlelink\" . }}' }),\n      option('image_url', 'Image URL', ''),\n      option('thumb_url', 'Thumbnail URL', ''),\n      option('actions', 'Actions', '', {\n        element: 'subform_array',\n        subformOptions: [\n          option('text', 'Text', '', { required: true }),\n          option('type', 'Type', '', { required: true }),\n          option('url', 'URL', 'Either url or name and value are mandatory.'),\n          option('name', 'Name', ''),\n          option('value', 'Value', ''),\n          option('confirm', 'Confirm', '', {\n            element: 'subform',\n            subformOptions: [\n              option('text', 'Text', '', { required: true }),\n              option('dismiss_text', 'Dismiss text', ''),\n              option('ok_text', 'OK text', ''),\n              option('title', 'Title', ''),\n            ],\n          }),\n          option('style', 'Style', ''),\n        ],\n      }),\n      option('fields', 'Fields', '', {\n        element: 'subform_array',\n        subformOptions: [\n          option('title', 'Title', '', { required: true }),\n          option('value', 'Value', '', { required: true }),\n          option('short', 'Short', '', { element: 'checkbox' }),\n        ],\n      }),\n      httpConfigOption,\n    ],\n  },\n  {\n    name: 'OpsGenie',\n    description: 'Send notifications to OpsGenie',\n    type: 'opsgenie',\n    info: '',\n    heading: 'OpsGenie settings',\n    options: [\n      option('api_key', 'API key', 'The API key to use when talking to the OpsGenie API.'),\n      option('api_url', 'API URL', 'The host to send OpsGenie API requests to.'),\n      option('message', 'Message', 'Alert text limited to 130 characters.'),\n      option('description', 'Description', 'A description of the incident.', {\n        placeholder: '{{ template \"opsgenie.default.description\" . }}',\n      }),\n      option('source', 'Source', 'A backlink to the sender of the notification.', {\n        placeholder: '{{ template \"opsgenie.default.source\" . }}',\n      }),\n      option(\n        'details',\n        'Details',\n        'A set of arbitrary key/value pairs that provide further detail about the incident.',\n        {\n          element: 'key_value_map',\n        }\n      ),\n      option('tags', 'Tags', 'Comma separated list of tags attached to the notifications.'),\n      option('note', 'Note', 'Additional alert note.'),\n      option('priority', 'Priority', 'Priority level of alert. Possible values are P1, P2, P3, P4, and P5.'),\n      option('responders', 'Responders', 'List of responders responsible for notifications.', {\n        element: 'subform_array',\n        subformOptions: [\n          option('type', 'Type', '\"team\", \"user\", \"escalation\" or schedule\".', { required: true }),\n          option('id', 'ID', 'Exactly one of these fields should be defined.'),\n          option('name', 'Name', 'Exactly one of these fields should be defined.'),\n          option('username', 'Username', 'Exactly one of these fields should be defined.'),\n        ],\n      }),\n      httpConfigOption,\n    ],\n  },\n  {\n    name: 'VictorOps',\n    description: 'Send notifications to VictorOps',\n    type: 'victorops',\n    info: '',\n    heading: 'VictorOps settings',\n    options: [\n      option('api_key', 'API key', 'The API key to use when talking to the VictorOps API.'),\n      option('api_url', 'API URL', 'The VictorOps API URL.'),\n      option('routing_key', 'Routing key', 'A key used to map the alert to a team.', { required: true }),\n      option('message_type', 'Message type', 'Describes the behavior of the alert (CRITICAL, WARNING, INFO).'),\n      option('entity_display_name', 'Entity display name', 'Contains summary of the alerted problem.', {\n        placeholder: '{{ template \"victorops.default.entity_display_name\" . }}',\n      }),\n      option('state_message', 'State message', 'Contains long explanation of the alerted problem.', {\n        placeholder: '{{ template \"victorops.default.state_message\" . }}',\n      }),\n      option('monitoring_tool', 'Monitoring tool', 'The monitoring tool the state message is from.', {\n        placeholder: '{{ template \"victorops.default.monitoring_tool\" . }}',\n      }),\n      httpConfigOption,\n    ],\n  },\n  {\n    name: 'Webhook',\n    description: 'Send notifications to a webhook',\n    type: 'webhook',\n    info: '',\n    heading: 'Webhook settings',\n    options: [\n      option('url', 'URL', 'The endpoint to send HTTP POST requests to.', { required: true }),\n      option(\n        'max_alerts',\n        'Max alerts',\n        'The maximum number of alerts to include in a single webhook message. Alerts above this threshold are truncated. When leaving this at its default value of 0, all alerts are included.',\n        { placeholder: '0', validationRule: '(^\\\\d+$|^$)' }\n      ),\n      httpConfigOption,\n    ],\n  },\n];\n\nexport const globalConfigOptions: NotificationChannelOption[] = [\n  // email\n  option('smtp_from', 'SMTP from', 'The default SMTP From header field.'),\n  option(\n    'smtp_smarthost',\n    'SMTP smarthost',\n    'The default SMTP smarthost used for sending emails, including port number. Port number usually is 25, or 587 for SMTP over TLS (sometimes referred to as STARTTLS). Example: smtp.example.org:587'\n  ),\n  option('smtp_hello', 'SMTP hello', 'The default hostname to identify to the SMTP server.', {\n    placeholder: 'localhost',\n  }),\n  option(\n    'smtp_auth_username',\n    'SMTP auth username',\n    \"SMTP Auth using CRAM-MD5, LOGIN and PLAIN. If empty, Alertmanager doesn't authenticate to the SMTP server.\"\n  ),\n  option('smtp_auth_password', 'SMTP auth password', 'SMTP Auth using LOGIN and PLAIN.'),\n  option('smtp_auth_identity', 'SMTP auth identity', 'SMTP Auth using PLAIN.'),\n  option('smtp_auth_secret', 'SMTP auth secret', 'SMTP Auth using CRAM-MD5.'),\n  option(\n    'smtp_require_tls',\n    'SMTP require TLS',\n    'The default SMTP TLS requirement. Note that Go does not support unencrypted connections to remote SMTP endpoints.',\n    {\n      element: 'checkbox',\n    }\n  ),\n\n  // slack\n  option('slack_api_url', 'Slack API URL', ''),\n  option('victorops_api_key', 'VictorOps API key', ''),\n  option('victorops_api_url', 'VictorOps API URL', '', {\n    placeholder: 'https://alert.victorops.com/integrations/generic/20131114/alert/',\n  }),\n  option('pagerduty_url', 'PagerDuty URL', 'https://events.pagerduty.com/v2/enqueue'),\n  option('opsgenie_api_key', 'OpsGenie API key', ''),\n  option('opsgenie_api_url', 'OpsGenie API URL', '', { placeholder: 'https://api.opsgenie.com/' }),\n  option('wechat_api_url', 'WeChat API URL', '', { placeholder: 'https://qyapi.weixin.qq.com/cgi-bin/' }),\n  option('wechat_api_secret', 'WeChat API secret', ''),\n  option('wechat_api_corp_id', 'WeChat API corp id', ''),\n  httpConfigOption,\n  option(\n    'resolve_timeout',\n    'Resolve timeout',\n    'ResolveTimeout is the default value used by alertmanager if the alert does not include EndsAt, after this time passes it can declare the alert as resolved if it has not been updated. This has no impact on alerts from Prometheus, as they always include EndsAt.',\n    {\n      placeholder: '5m',\n    }\n  ),\n];\n","import { isArray } from 'angular';\nimport {\n  AlertManagerCortexConfig,\n  GrafanaManagedReceiverConfig,\n  Receiver,\n  Route,\n} from 'app/plugins/datasource/alertmanager/types';\nimport { CloudNotifierType, NotifierDTO, NotifierType } from 'app/types';\nimport {\n  CloudChannelConfig,\n  CloudChannelMap,\n  CloudChannelValues,\n  GrafanaChannelMap,\n  GrafanaChannelValues,\n  ReceiverFormValues,\n} from '../types/receiver-form';\n\nexport function grafanaReceiverToFormValues(\n  receiver: Receiver,\n  notifiers: NotifierDTO[]\n): [ReceiverFormValues<GrafanaChannelValues>, GrafanaChannelMap] {\n  const channelMap: GrafanaChannelMap = {};\n  // giving each form receiver item a unique id so we can use it to map back to \"original\" items\n  // as well as to use as `key` prop.\n  // @TODO use uid once backend is fixed to provide it. then we can get rid of the GrafanaChannelMap\n  let idCounter = 1;\n  const values = {\n    name: receiver.name,\n    items:\n      receiver.grafana_managed_receiver_configs?.map((channel) => {\n        const id = String(idCounter++);\n        channelMap[id] = channel;\n        const notifier = notifiers.find(({ type }) => type === channel.type);\n        return grafanaChannelConfigToFormChannelValues(id, channel, notifier);\n      }) ?? [],\n  };\n  return [values, channelMap];\n}\n\nexport function cloudReceiverToFormValues(\n  receiver: Receiver,\n  notifiers: NotifierDTO[]\n): [ReceiverFormValues<CloudChannelValues>, CloudChannelMap] {\n  const channelMap: CloudChannelMap = {};\n  // giving each form receiver item a unique id so we can use it to map back to \"original\" items\n  let idCounter = 1;\n  const items: CloudChannelValues[] = Object.entries(receiver)\n    // filter out only config items that are relevant to cloud\n    .filter(([type]) => type.endsWith('_configs') && type !== 'grafana_managed_receiver_configs')\n    // map property names to cloud notifier types by removing the `_config` suffix\n    .map(([type, configs]): [CloudNotifierType, CloudChannelConfig[]] => [\n      type.replace('_configs', '') as CloudNotifierType,\n      configs as CloudChannelConfig[],\n    ])\n    // convert channel configs to form values\n    .map(([type, configs]) =>\n      configs.map((config) => {\n        const id = String(idCounter++);\n        channelMap[id] = { type, config };\n        const notifier = notifiers.find((notifier) => notifier.type === type);\n        if (!notifier) {\n          throw new Error(`unknown cloud notifier: ${type}`);\n        }\n        return cloudChannelConfigToFormChannelValues(id, type, config);\n      })\n    )\n    .flat();\n  const values = {\n    name: receiver.name,\n    items,\n  };\n  return [values, channelMap];\n}\n\nexport function formValuesToGrafanaReceiver(\n  values: ReceiverFormValues<GrafanaChannelValues>,\n  channelMap: GrafanaChannelMap,\n  defaultChannelValues: GrafanaChannelValues\n): Receiver {\n  return {\n    name: values.name,\n    grafana_managed_receiver_configs: (values.items ?? []).map((channelValues) => {\n      const existing: GrafanaManagedReceiverConfig | undefined = channelMap[channelValues.__id];\n      return formChannelValuesToGrafanaChannelConfig(channelValues, defaultChannelValues, values.name, existing);\n    }),\n  };\n}\n\nexport function formValuesToCloudReceiver(\n  values: ReceiverFormValues<CloudChannelValues>,\n  defaults: CloudChannelValues\n): Receiver {\n  const recv: Receiver = {\n    name: values.name,\n  };\n  values.items.forEach(({ __id, type, settings, sendResolved }) => {\n    const channel = omitEmptyValues({\n      ...settings,\n      send_resolved: sendResolved ?? defaults.sendResolved,\n    });\n\n    const configsKey = `${type}_configs`;\n    if (!recv[configsKey]) {\n      recv[configsKey] = [channel];\n    } else {\n      (recv[configsKey] as unknown[]).push(channel);\n    }\n  });\n  return recv;\n}\n\n// will add new receiver, or replace exisitng one\nexport function updateConfigWithReceiver(\n  config: AlertManagerCortexConfig,\n  receiver: Receiver,\n  replaceReceiverName?: string\n): AlertManagerCortexConfig {\n  const oldReceivers = config.alertmanager_config.receivers ?? [];\n\n  // sanity check that name is not duplicated\n  if (receiver.name !== replaceReceiverName && !!oldReceivers.find(({ name }) => name === receiver.name)) {\n    throw new Error(`Duplicate receiver name ${receiver.name}`);\n  }\n\n  // sanity check that existing receiver exists\n  if (replaceReceiverName && !oldReceivers.find(({ name }) => name === replaceReceiverName)) {\n    throw new Error(`Expected receiver ${replaceReceiverName} to exist, but did not find it in the config`);\n  }\n\n  const updated: AlertManagerCortexConfig = {\n    ...config,\n    alertmanager_config: {\n      // @todo rename receiver on routes as necessary\n      ...config.alertmanager_config,\n      receivers: replaceReceiverName\n        ? oldReceivers.map((existingReceiver) =>\n            existingReceiver.name === replaceReceiverName ? receiver : existingReceiver\n          )\n        : [...oldReceivers, receiver],\n    },\n  };\n\n  // if receiver was renamed, rename it in routes as well\n  if (updated.alertmanager_config.route && replaceReceiverName && receiver.name !== replaceReceiverName) {\n    updated.alertmanager_config.route = renameReceiverInRoute(\n      updated.alertmanager_config.route,\n      replaceReceiverName,\n      receiver.name\n    );\n  }\n\n  return updated;\n}\n\nfunction renameReceiverInRoute(route: Route, oldName: string, newName: string) {\n  const updated: Route = {\n    ...route,\n  };\n  if (updated.receiver === oldName) {\n    updated.receiver = newName;\n  }\n  if (updated.routes) {\n    updated.routes = updated.routes.map((route) => renameReceiverInRoute(route, oldName, newName));\n  }\n  return updated;\n}\n\nfunction cloudChannelConfigToFormChannelValues(\n  id: string,\n  type: CloudNotifierType,\n  channel: CloudChannelConfig\n): CloudChannelValues {\n  return {\n    __id: id,\n    type,\n    settings: {\n      ...channel,\n    },\n    secureFields: {},\n    secureSettings: {},\n    sendResolved: channel.send_resolved,\n  };\n}\n\nfunction grafanaChannelConfigToFormChannelValues(\n  id: string,\n  channel: GrafanaManagedReceiverConfig,\n  notifier?: NotifierDTO\n): GrafanaChannelValues {\n  const values: GrafanaChannelValues = {\n    __id: id,\n    type: channel.type as NotifierType,\n    secureSettings: {},\n    settings: { ...channel.settings },\n    secureFields: { ...channel.secureFields },\n    disableResolveMessage: channel.disableResolveMessage,\n  };\n\n  // work around https://github.com/grafana/alerting-squad/issues/100\n  notifier?.options.forEach((option) => {\n    if (option.secure && values.settings[option.propertyName]) {\n      delete values.settings[option.propertyName];\n      values.secureFields[option.propertyName] = true;\n    }\n  });\n\n  return values;\n}\n\nfunction formChannelValuesToGrafanaChannelConfig(\n  values: GrafanaChannelValues,\n  defaults: GrafanaChannelValues,\n  name: string,\n  existing?: GrafanaManagedReceiverConfig\n): GrafanaManagedReceiverConfig {\n  const channel: GrafanaManagedReceiverConfig = {\n    settings: omitEmptyValues({\n      ...(existing && existing.type === values.type ? existing.settings ?? {} : {}),\n      ...(values.settings ?? {}),\n    }),\n    secureSettings: values.secureSettings ?? {},\n    type: values.type,\n    name,\n    disableResolveMessage:\n      values.disableResolveMessage ?? existing?.disableResolveMessage ?? defaults.disableResolveMessage,\n  };\n  if (existing) {\n    channel.uid = existing.uid;\n  }\n  return channel;\n}\n\n// will remove properties that have empty ('', null, undefined) object properties.\n// traverses nested objects and arrays as well. in place, mutates the object.\n// this is needed because form will submit empty string for not filled in fields,\n// but for cloud alertmanager receiver config to use global default value the property must be omitted entirely\n// this isn't a perfect solution though. No way for user to intentionally provide an empty string. Will need rethinking later\nexport function omitEmptyValues<T>(obj: T): T {\n  if (isArray(obj)) {\n    obj.forEach(omitEmptyValues);\n  } else if (typeof obj === 'object' && obj !== null) {\n    Object.entries(obj).forEach(([key, value]) => {\n      if (value === '' || value === null || value === undefined) {\n        delete (obj as any)[key];\n      } else {\n        omitEmptyValues(value);\n      }\n    });\n  }\n  return obj;\n}\n","import { Checkbox, Field } from '@grafana/ui';\nimport React, { FC } from 'react';\nimport { CommonSettingsComponentProps } from '../../../types/receiver-form';\nimport { useFormContext } from 'react-hook-form';\n\nexport const CloudCommonChannelSettings: FC<CommonSettingsComponentProps> = ({ pathPrefix, className }) => {\n  const { register } = useFormContext();\n  return (\n    <div className={className}>\n      <Field>\n        <Checkbox\n          {...register(`${pathPrefix}sendResolved`)}\n          label=\"Send resolved\"\n          description=\"Whether or not to notify about resolved alerts.\"\n        />\n      </Field>\n    </div>\n  );\n};\n","import { useCallback } from 'react';\nimport { UseFormReturn } from 'react-hook-form';\n\nimport { set } from 'lodash';\n\ninterface Options<R> {\n  name: string;\n  formAPI: UseFormReturn<any>;\n  defaults?: R[];\n\n  // if true, sets `__deleted: true` but does not remove item from the array in values\n  softDelete?: boolean;\n}\n\nexport type ControlledField<R> = R & {\n  __deleted?: boolean;\n};\n\nconst EMPTY_ARRAY = [] as const;\n\n/*\n * react-hook-form's own useFieldArray is uncontrolled and super buggy.\n * this is a simple controlled version. It's dead simple and more robust at the cost of re-rendering the form\n * on every change to the sub forms in the array.\n * Warning: you'll have to take care of your own unique identiifer to use as `key` for the ReactNode array.\n * Using index will cause problems.\n */\nexport function useControlledFieldArray<R>(options: Options<R>) {\n  const { name, formAPI, defaults, softDelete } = options;\n  const { watch, getValues, reset, setValue } = formAPI;\n\n  const fields: Array<ControlledField<R>> = watch(name) ?? defaults ?? EMPTY_ARRAY;\n\n  const update = useCallback(\n    (updateFn: (fields: R[]) => R[]) => {\n      const values = JSON.parse(JSON.stringify(getValues()));\n      const newItems = updateFn(fields ?? []);\n      reset(set(values, name, newItems));\n    },\n    [getValues, name, reset, fields]\n  );\n\n  return {\n    fields,\n    append: useCallback((values: R) => update((fields) => [...fields, values]), [update]),\n    remove: useCallback(\n      (index: number) => {\n        if (softDelete) {\n          setValue(`${name}.${index}.__deleted`, true);\n        } else {\n          update((items) => {\n            const newItems = items.slice();\n            newItems.splice(index, 1);\n            return newItems;\n          });\n        }\n      },\n      [update, name, setValue, softDelete]\n    ),\n  };\n}\n","import { GrafanaTheme2 } from '@grafana/data';\nimport { css } from '@emotion/css';\n\nexport const getReceiverFormFieldStyles = (theme: GrafanaTheme2) => ({\n  collapsibleSection: css`\n    margin: 0;\n    padding: 0;\n  `,\n  wrapper: css`\n    margin: ${theme.spacing(2, 0)};\n    padding: ${theme.spacing(1)};\n    border: solid 1px ${theme.colors.border.medium};\n    border-radius: ${theme.shape.borderRadius(1)};\n    position: relative;\n  `,\n  description: css`\n    color: ${theme.colors.text.secondary};\n    font-size: ${theme.typography.size.sm};\n    font-weight: ${theme.typography.fontWeightRegular};\n    margin: 0;\n  `,\n  deleteIcon: css`\n    position: absolute;\n    right: ${theme.spacing(1)};\n    top: ${theme.spacing(1)};\n  `,\n  addButton: css`\n    margin-top: ${theme.spacing(1)};\n  `,\n});\n","import React, { FC, useState } from 'react';\nimport { NotificationChannelOption } from 'app/types';\nimport { FieldError, DeepMap, useFormContext } from 'react-hook-form';\nimport { OptionField } from './OptionField';\nimport { Button, useStyles2 } from '@grafana/ui';\nimport { ActionIcon } from '../../../rules/ActionIcon';\nimport { getReceiverFormFieldStyles } from './styles';\n\ninterface Props {\n  defaultValue: any;\n  option: NotificationChannelOption;\n  pathPrefix: string;\n  errors?: DeepMap<any, FieldError>;\n}\n\nexport const SubformField: FC<Props> = ({ option, pathPrefix, errors, defaultValue }) => {\n  const styles = useStyles2(getReceiverFormFieldStyles);\n  const name = `${pathPrefix}${option.propertyName}`;\n  const { watch } = useFormContext();\n  const _watchValue = watch(name);\n  const value = _watchValue === undefined ? defaultValue : _watchValue;\n\n  const [show, setShow] = useState(!!value);\n\n  return (\n    <div className={styles.wrapper} data-testid={`${name}.container`}>\n      <h6>{option.label}</h6>\n      {option.description && <p className={styles.description}>{option.description}</p>}\n      {show && (\n        <>\n          <ActionIcon\n            data-testid={`${name}.delete-button`}\n            icon=\"trash-alt\"\n            tooltip=\"delete\"\n            onClick={() => setShow(false)}\n            className={styles.deleteIcon}\n          />\n          {(option.subformOptions ?? []).map((subOption) => {\n            return (\n              <OptionField\n                defaultValue={defaultValue?.[subOption.propertyName]}\n                key={subOption.propertyName}\n                option={subOption}\n                pathPrefix={`${name}.`}\n                error={errors?.[subOption.propertyName]}\n              />\n            );\n          })}\n        </>\n      )}\n      {!show && (\n        <Button\n          className={styles.addButton}\n          type=\"button\"\n          variant=\"secondary\"\n          icon=\"plus\"\n          size=\"sm\"\n          onClick={() => setShow(true)}\n          data-testid={`${name}.add-button`}\n        >\n          Add\n        </Button>\n      )}\n    </div>\n  );\n};\n","import React, { FC, useEffect, useState } from 'react';\nimport { GrafanaTheme2 } from '@grafana/data';\nimport { css } from '@emotion/css';\nimport { Button, Input, useStyles2 } from '@grafana/ui';\nimport { ActionIcon } from '../../../rules/ActionIcon';\n\ninterface Props {\n  value?: Record<string, string>;\n  onChange: (value: Record<string, string>) => void;\n}\n\nexport const KeyValueMapInput: FC<Props> = ({ value, onChange }) => {\n  const styles = useStyles2(getStyles);\n  const [pairs, setPairs] = useState(recordToPairs(value));\n  useEffect(() => setPairs(recordToPairs(value)), [value]);\n\n  const emitChange = (pairs: Array<[string, string]>) => {\n    onChange(pairsToRecord(pairs));\n  };\n\n  const deleteItem = (index: number) => {\n    const newPairs = pairs.slice();\n    const removed = newPairs.splice(index, 1)[0];\n    setPairs(newPairs);\n    if (removed[0]) {\n      emitChange(newPairs);\n    }\n  };\n\n  const updatePair = (values: [string, string], index: number) => {\n    const old = pairs[index];\n    const newPairs = pairs.map((pair, i) => (i === index ? values : pair));\n    setPairs(newPairs);\n    if (values[0] || old[0]) {\n      emitChange(newPairs);\n    }\n  };\n\n  return (\n    <div>\n      {!!pairs.length && (\n        <table className={styles.table}>\n          <thead>\n            <tr>\n              <th>Name</th>\n              <th>Value</th>\n              <th></th>\n            </tr>\n          </thead>\n          <tbody>\n            {pairs.map(([key, value], index) => (\n              <tr key={index}>\n                <td>\n                  <Input value={key} onChange={(e) => updatePair([e.currentTarget.value, value], index)} />\n                </td>\n                <td>\n                  <Input value={value} onChange={(e) => updatePair([key, e.currentTarget.value], index)} />\n                </td>\n                <td>\n                  <ActionIcon icon=\"trash-alt\" tooltip=\"delete\" onClick={() => deleteItem(index)} />\n                </td>\n              </tr>\n            ))}\n          </tbody>\n        </table>\n      )}\n      <Button\n        className={styles.addButton}\n        type=\"button\"\n        variant=\"secondary\"\n        icon=\"plus\"\n        size=\"sm\"\n        onClick={() => setPairs([...pairs, ['', '']])}\n      >\n        Add\n      </Button>\n    </div>\n  );\n};\n\nconst getStyles = (theme: GrafanaTheme2) => ({\n  addButton: css`\n    margin-top: ${theme.spacing(1)};\n  `,\n  table: css`\n    tbody td {\n      padding: 0 ${theme.spacing(1)} ${theme.spacing(1)} 0;\n    }\n  `,\n});\n\nconst pairsToRecord = (pairs: Array<[string, string]>): Record<string, string> => {\n  const record: Record<string, string> = {};\n  for (const [key, value] of pairs) {\n    if (key) {\n      record[key] = value;\n    }\n  }\n  return record;\n};\n\nconst recordToPairs = (obj?: Record<string, string>): Array<[string, string]> => Object.entries(obj ?? {});\n","import { css, cx } from '@emotion/css';\nimport { GrafanaTheme2 } from '@grafana/data';\nimport { Icon, useStyles2 } from '@grafana/ui';\nimport React, { FC, useState } from 'react';\n\ninterface Props {\n  label: string;\n  description?: string;\n  className?: string;\n}\n\nexport const CollapsibleSection: FC<Props> = ({ label, description, children, className }) => {\n  const styles = useStyles2(getStyles);\n  const [isCollapsed, setIsCollapsed] = useState(true);\n\n  const toggleCollapse = () => setIsCollapsed(!isCollapsed);\n\n  return (\n    <div className={cx(styles.wrapper, className)}>\n      <div className={styles.heading} onClick={toggleCollapse}>\n        <Icon className={styles.caret} size=\"xl\" name={isCollapsed ? 'angle-right' : 'angle-down'} />\n        <h6>{label}</h6>\n      </div>\n      {description && <p className={styles.description}>{description}</p>}\n      <div className={isCollapsed ? styles.hidden : undefined}>{children}</div>\n    </div>\n  );\n};\n\nconst getStyles = (theme: GrafanaTheme2) => ({\n  wrapper: css`\n    margin-top: ${theme.spacing(1)};\n    padding-bottom: ${theme.spacing(1)};\n  `,\n  caret: css`\n    margin-left: -${theme.spacing(0.5)}; // make it align with fields despite icon size\n  `,\n  heading: css`\n    cursor: pointer;\n    h6 {\n      display: inline-block;\n    }\n  `,\n  hidden: css`\n    display: none;\n  `,\n  description: css`\n    color: ${theme.colors.text.secondary};\n    font-size: ${theme.typography.size.sm};\n    font-weight: ${theme.typography.fontWeightRegular};\n    margin: 0;\n  `,\n});\n","import React, { FC } from 'react';\nimport { NotificationChannelOption } from 'app/types';\nimport { FieldError, DeepMap, useFormContext } from 'react-hook-form';\nimport { Button, useStyles2 } from '@grafana/ui';\nimport { CollapsibleSection } from '../CollapsibleSection';\nimport { ActionIcon } from '../../../rules/ActionIcon';\nimport { OptionField } from './OptionField';\nimport { useControlledFieldArray } from 'app/features/alerting/unified/hooks/useControlledFieldArray';\nimport { getReceiverFormFieldStyles } from './styles';\n\ninterface Props {\n  defaultValues?: any[];\n  option: NotificationChannelOption;\n  pathPrefix: string;\n  errors?: Array<DeepMap<any, FieldError>>;\n}\n\nexport const SubformArrayField: FC<Props> = ({ option, pathPrefix, errors, defaultValues }) => {\n  const styles = useStyles2(getReceiverFormFieldStyles);\n  const path = `${pathPrefix}${option.propertyName}`;\n  const formAPI = useFormContext();\n  const { fields, append, remove } = useControlledFieldArray({ name: path, formAPI, defaults: defaultValues });\n\n  return (\n    <div className={styles.wrapper}>\n      <CollapsibleSection\n        className={styles.collapsibleSection}\n        label={`${option.label} (${fields.length})`}\n        description={option.description}\n      >\n        {(fields ?? defaultValues ?? []).map((field, itemIndex) => {\n          return (\n            <div key={itemIndex} className={styles.wrapper}>\n              <ActionIcon\n                data-testid={`${path}.${itemIndex}.delete-button`}\n                icon=\"trash-alt\"\n                tooltip=\"delete\"\n                onClick={() => remove(itemIndex)}\n                className={styles.deleteIcon}\n              />\n              {option.subformOptions?.map((option) => (\n                <OptionField\n                  defaultValue={field?.[option.propertyName]}\n                  key={option.propertyName}\n                  option={option}\n                  pathPrefix={`${path}.${itemIndex}.`}\n                  error={errors?.[itemIndex]?.[option.propertyName]}\n                />\n              ))}\n            </div>\n          );\n        })}\n        <Button\n          data-testid={`${path}.add-button`}\n          className={styles.addButton}\n          type=\"button\"\n          variant=\"secondary\"\n          icon=\"plus\"\n          size=\"sm\"\n          onClick={() => append({ __id: String(Math.random()) })}\n        >\n          Add\n        </Button>\n      </CollapsibleSection>\n    </div>\n  );\n};\n","import React, { FC } from 'react';\nimport { GrafanaTheme2 } from '@grafana/data';\nimport { css } from '@emotion/css';\nimport { Button, Input, useStyles2 } from '@grafana/ui';\nimport { ActionIcon } from '../../../rules/ActionIcon';\n\ninterface Props {\n  value?: string[];\n  onChange: (value: string[]) => void;\n}\n\nexport const StringArrayInput: FC<Props> = ({ value, onChange }) => {\n  const styles = useStyles2(getStyles);\n\n  const deleteItem = (index: number) => {\n    if (!value) {\n      return;\n    }\n    const newValue = value.slice();\n    newValue.splice(index, 1);\n    onChange(newValue);\n  };\n\n  const updateValue = (itemValue: string, index: number) => {\n    if (!value) {\n      return;\n    }\n    onChange(value.map((v, i) => (i === index ? itemValue : v)));\n  };\n\n  return (\n    <div>\n      {!!value?.length &&\n        value.map((v, index) => (\n          <div key={index} className={styles.row}>\n            <Input value={v} onChange={(e) => updateValue(e.currentTarget.value, index)} />\n            <ActionIcon\n              className={styles.deleteIcon}\n              icon=\"trash-alt\"\n              tooltip=\"delete\"\n              onClick={() => deleteItem(index)}\n            />\n          </div>\n        ))}\n      <Button\n        className={styles.addButton}\n        type=\"button\"\n        variant=\"secondary\"\n        icon=\"plus\"\n        size=\"sm\"\n        onClick={() => onChange([...(value ?? []), ''])}\n      >\n        Add\n      </Button>\n    </div>\n  );\n};\n\nconst getStyles = (theme: GrafanaTheme2) => ({\n  row: css`\n    display: flex;\n    flex-direction: row;\n    margin-bottom: ${theme.spacing(1)};\n    align-items: center;\n  `,\n  deleteIcon: css`\n    margin-left: ${theme.spacing(1)};\n  `,\n  addButton: css`\n    margin-top: ${theme.spacing(1)};\n  `,\n});\n","import React, { FC, useEffect } from 'react';\nimport { Checkbox, Field, Input, InputControl, Select, TextArea } from '@grafana/ui';\nimport { NotificationChannelOption } from 'app/types';\nimport { useFormContext, FieldError, DeepMap } from 'react-hook-form';\nimport { SubformField } from './SubformField';\nimport { css } from '@emotion/css';\nimport { KeyValueMapInput } from './KeyValueMapInput';\nimport { SubformArrayField } from './SubformArrayField';\nimport { StringArrayInput } from './StringArrayInput';\n\ninterface Props {\n  defaultValue: any;\n  option: NotificationChannelOption;\n  invalid?: boolean;\n  pathPrefix: string;\n  error?: FieldError | DeepMap<any, FieldError>;\n}\n\nexport const OptionField: FC<Props> = ({ option, invalid, pathPrefix, error, defaultValue }) => {\n  if (option.element === 'subform') {\n    return (\n      <SubformField\n        defaultValue={defaultValue}\n        option={option}\n        errors={error as DeepMap<any, FieldError> | undefined}\n        pathPrefix={pathPrefix}\n      />\n    );\n  }\n  if (option.element === 'subform_array') {\n    return (\n      <SubformArrayField\n        defaultValues={defaultValue}\n        option={option}\n        pathPrefix={pathPrefix}\n        errors={error as Array<DeepMap<any, FieldError>> | undefined}\n      />\n    );\n  }\n  return (\n    <Field\n      label={option.element !== 'checkbox' ? option.label : undefined}\n      description={option.description || undefined}\n      invalid={!!error}\n      error={error?.message}\n    >\n      <OptionInput\n        id={`${pathPrefix}${option.propertyName}`}\n        defaultValue={defaultValue}\n        option={option}\n        invalid={invalid}\n        pathPrefix={pathPrefix}\n      />\n    </Field>\n  );\n};\n\nconst OptionInput: FC<Props & { id: string }> = ({ option, invalid, id, pathPrefix = '' }) => {\n  const { control, register, unregister } = useFormContext();\n  const name = `${pathPrefix}${option.propertyName}`;\n\n  // workaround for https://github.com/react-hook-form/react-hook-form/issues/4993#issuecomment-829012506\n  useEffect(\n    () => () => {\n      unregister(name, { keepValue: false });\n    },\n    [unregister, name]\n  );\n  switch (option.element) {\n    case 'checkbox':\n      return (\n        <Checkbox\n          id={id}\n          className={styles.checkbox}\n          {...register(name)}\n          label={option.label}\n          description={option.description}\n        />\n      );\n    case 'input':\n      return (\n        <Input\n          id={id}\n          invalid={invalid}\n          type={option.inputType}\n          {...register(name, {\n            required: option.required ? 'Required' : false,\n            validate: (v) => (option.validationRule !== '' ? validateOption(v, option.validationRule) : true),\n          })}\n          placeholder={option.placeholder}\n        />\n      );\n\n    case 'select':\n      return (\n        <InputControl\n          render={({ field: { onChange, ref, ...field } }) => (\n            <Select\n              menuShouldPortal\n              {...field}\n              options={option.selectOptions ?? undefined}\n              invalid={invalid}\n              onChange={(value) => onChange(value.value)}\n            />\n          )}\n          control={control}\n          name={name}\n        />\n      );\n\n    case 'textarea':\n      return (\n        <TextArea\n          id={id}\n          invalid={invalid}\n          {...register(name, {\n            required: option.required ? 'Required' : false,\n            validate: (v) => (option.validationRule !== '' ? validateOption(v, option.validationRule) : true),\n          })}\n        />\n      );\n    case 'string_array':\n      return (\n        <InputControl\n          render={({ field: { value, onChange } }) => <StringArrayInput value={value} onChange={onChange} />}\n          control={control}\n          name={name}\n        />\n      );\n    case 'key_value_map':\n      return (\n        <InputControl\n          render={({ field: { value, onChange } }) => <KeyValueMapInput value={value} onChange={onChange} />}\n          control={control}\n          name={name}\n        />\n      );\n\n    default:\n      console.error('Element not supported', option.element);\n      return null;\n  }\n};\n\nconst styles = {\n  checkbox: css`\n    height: auto; // native chekbox has fixed height which does not take into account description\n  `,\n};\n\nconst validateOption = (value: string, validationRule: string) => {\n  return RegExp(validationRule).test(value) ? true : 'Invalid format';\n};\n","import React from 'react';\nimport { Button, Field, Input } from '@grafana/ui';\nimport { OptionField } from './fields/OptionField';\nimport { ChannelValues, ReceiverFormValues } from '../../../types/receiver-form';\nimport { useFormContext, FieldError, FieldErrors, DeepMap } from 'react-hook-form';\nimport { NotificationChannelOption, NotificationChannelSecureFields } from 'app/types';\n\nexport interface Props<R extends ChannelValues> {\n  defaultValues: R;\n  selectedChannelOptions: NotificationChannelOption[];\n  secureFields: NotificationChannelSecureFields;\n\n  onResetSecureField: (key: string) => void;\n  errors?: FieldErrors<R>;\n  pathPrefix?: string;\n}\n\nexport function ChannelOptions<R extends ChannelValues>({\n  defaultValues,\n  selectedChannelOptions,\n  onResetSecureField,\n  secureFields,\n  errors,\n  pathPrefix = '',\n}: Props<R>): JSX.Element {\n  const { watch } = useFormContext<ReceiverFormValues<R>>();\n  const currentFormValues = watch() as Record<string, any>; // react hook form types ARE LYING!\n  return (\n    <>\n      {selectedChannelOptions.map((option: NotificationChannelOption, index: number) => {\n        const key = `${option.label}-${index}`;\n        // Some options can be dependent on other options, this determines what is selected in the dependency options\n        // I think this needs more thought.\n        const selectedOptionValue = currentFormValues[`${pathPrefix}settings.${option.showWhen.field}`];\n\n        if (option.showWhen.field && selectedOptionValue !== option.showWhen.is) {\n          return null;\n        }\n\n        if (secureFields && secureFields[option.propertyName]) {\n          return (\n            <Field key={key} label={option.label} description={option.description || undefined}>\n              <Input\n                readOnly={true}\n                value=\"Configured\"\n                suffix={\n                  <Button\n                    onClick={() => onResetSecureField(option.propertyName)}\n                    variant=\"link\"\n                    type=\"button\"\n                    size=\"sm\"\n                  >\n                    Clear\n                  </Button>\n                }\n              />\n            </Field>\n          );\n        }\n\n        const error: FieldError | DeepMap<any, FieldError> | undefined = ((option.secure\n          ? errors?.secureSettings\n          : errors?.settings) as DeepMap<any, FieldError> | undefined)?.[option.propertyName];\n\n        const defaultValue = defaultValues?.settings?.[option.propertyName];\n\n        return (\n          <OptionField\n            defaultValue={defaultValue}\n            key={key}\n            error={error}\n            pathPrefix={option.secure ? `${pathPrefix}secureSettings.` : `${pathPrefix}settings.`}\n            option={option}\n          />\n        );\n      })}\n    </>\n  );\n}\n","import { GrafanaTheme2, SelectableValue } from '@grafana/data';\nimport { NotifierDTO } from 'app/types';\nimport React, { useEffect, useMemo, useState } from 'react';\nimport { css } from '@emotion/css';\nimport { Alert, Button, Field, InputControl, Select, useStyles2 } from '@grafana/ui';\nimport { useFormContext, FieldErrors } from 'react-hook-form';\nimport { ChannelValues, CommonSettingsComponentType } from '../../../types/receiver-form';\nimport { ChannelOptions } from './ChannelOptions';\nimport { CollapsibleSection } from './CollapsibleSection';\n\ninterface Props<R> {\n  defaultValues: R;\n  pathPrefix: string;\n  notifiers: NotifierDTO[];\n  onDuplicate: () => void;\n  commonSettingsComponent: CommonSettingsComponentType;\n\n  secureFields?: Record<string, boolean>;\n  errors?: FieldErrors<R>;\n  onDelete?: () => void;\n}\n\nexport function ChannelSubForm<R extends ChannelValues>({\n  defaultValues,\n  pathPrefix,\n  onDuplicate,\n  onDelete,\n  notifiers,\n  errors,\n  secureFields,\n  commonSettingsComponent: CommonSettingsComponent,\n}: Props<R>): JSX.Element {\n  const styles = useStyles2(getStyles);\n  const name = (fieldName: string) => `${pathPrefix}${fieldName}`;\n  const { control, watch, register } = useFormContext();\n  const selectedType = watch(name('type')) ?? defaultValues.type; // nope, setting \"default\" does not work at all.\n\n  useEffect(() => {\n    register(`${pathPrefix}.__id`);\n  }, [register, pathPrefix]);\n\n  const [_secureFields, setSecureFields] = useState(secureFields ?? {});\n\n  const onResetSecureField = (key: string) => {\n    if (_secureFields[key]) {\n      const updatedSecureFields = { ...secureFields };\n      delete updatedSecureFields[key];\n      setSecureFields(updatedSecureFields);\n    }\n  };\n\n  const typeOptions = useMemo(\n    (): SelectableValue[] =>\n      notifiers\n        .map(({ name, type }) => ({\n          label: name,\n          value: type,\n        }))\n        .sort((a, b) => a.label.localeCompare(b.label)),\n    [notifiers]\n  );\n\n  const notifier = notifiers.find(({ type }) => type === selectedType);\n  // if there are mandatory options defined, optional options will be hidden by a collapse\n  // if there aren't mandatory options, all options will be shown without collapse\n  const mandatoryOptions = notifier?.options.filter((o) => o.required);\n  const optionalOptions = notifier?.options.filter((o) => !o.required);\n\n  return (\n    <div className={styles.wrapper} data-testid=\"item-container\">\n      <div className={styles.topRow}>\n        <div>\n          <Field label=\"Contact point type\" data-testid={`${pathPrefix}type`}>\n            <InputControl\n              name={name('type')}\n              defaultValue={defaultValues.type}\n              render={({ field: { ref, onChange, ...field } }) => (\n                <Select\n                  menuShouldPortal\n                  {...field}\n                  width={37}\n                  options={typeOptions}\n                  onChange={(value) => onChange(value?.value)}\n                />\n              )}\n              control={control}\n              rules={{ required: true }}\n            />\n          </Field>\n        </div>\n        <div className={styles.buttons}>\n          <Button size=\"xs\" variant=\"secondary\" type=\"button\" onClick={() => onDuplicate()} icon=\"copy\">\n            Duplicate\n          </Button>\n          {onDelete && (\n            <Button\n              data-testid={`${pathPrefix}delete-button`}\n              size=\"xs\"\n              variant=\"secondary\"\n              type=\"button\"\n              onClick={() => onDelete()}\n              icon=\"trash-alt\"\n            >\n              Delete\n            </Button>\n          )}\n        </div>\n      </div>\n      {notifier && (\n        <div className={styles.innerContent}>\n          <ChannelOptions<R>\n            defaultValues={defaultValues}\n            selectedChannelOptions={mandatoryOptions?.length ? mandatoryOptions! : optionalOptions!}\n            secureFields={_secureFields}\n            errors={errors}\n            onResetSecureField={onResetSecureField}\n            pathPrefix={pathPrefix}\n          />\n          {!!(mandatoryOptions?.length && optionalOptions?.length) && (\n            <CollapsibleSection label={`Optional ${notifier.name} settings`}>\n              {notifier.info !== '' && (\n                <Alert title=\"\" severity=\"info\">\n                  {notifier.info}\n                </Alert>\n              )}\n              <ChannelOptions<R>\n                defaultValues={defaultValues}\n                selectedChannelOptions={optionalOptions!}\n                secureFields={_secureFields}\n                onResetSecureField={onResetSecureField}\n                errors={errors}\n                pathPrefix={pathPrefix}\n              />\n            </CollapsibleSection>\n          )}\n          <CollapsibleSection label=\"Notification settings\">\n            <CommonSettingsComponent pathPrefix={pathPrefix} />\n          </CollapsibleSection>\n        </div>\n      )}\n    </div>\n  );\n}\n\nconst getStyles = (theme: GrafanaTheme2) => ({\n  buttons: css`\n    & > * + * {\n      margin-left: ${theme.spacing(1)};\n    }\n  `,\n  innerContent: css`\n    max-width: 536px;\n  `,\n  wrapper: css`\n    margin: ${theme.spacing(2, 0)};\n    padding: ${theme.spacing(1)};\n    border: solid 1px ${theme.colors.border.medium};\n    border-radius: ${theme.shape.borderRadius(1)};\n    max-width: ${theme.breakpoints.values.xl}${theme.breakpoints.unit};\n  `,\n  topRow: css`\n    display: flex;\n    flex-direction: row;\n    justify-content: space-between;\n  `,\n  channelSettingsHeader: css`\n    margin-top: ${theme.spacing(2)};\n  `,\n});\n","import React, { useEffect } from 'react';\nimport { useFormContext } from 'react-hook-form';\n\ninterface Props {\n  pathPrefix: string;\n}\n\n// we can't drop the deleted item from list entirely because\n// there will be a rece condition with register/unregister calls in react-hook-form\n// and fields will become randomly erroneously unregistered\nexport function DeletedSubForm({ pathPrefix }: Props): JSX.Element {\n  const { register } = useFormContext();\n\n  // required to be registered or react-hook-form will randomly drop the values when it feels like it\n  useEffect(() => {\n    register(`${pathPrefix}.__id`);\n    register(`${pathPrefix}.__deleted`);\n  }, [register, pathPrefix]);\n\n  return <></>;\n}\n","import { css } from '@emotion/css';\nimport { GrafanaTheme2, AppEvents } from '@grafana/data';\nimport { Alert, Button, Field, Input, LinkButton, useStyles2 } from '@grafana/ui';\nimport { useCleanup } from 'app/core/hooks/useCleanup';\nimport { AlertManagerCortexConfig } from 'app/plugins/datasource/alertmanager/types';\nimport { NotifierDTO } from 'app/types';\nimport React, { useCallback } from 'react';\nimport { useForm, FormProvider, FieldErrors, Validate } from 'react-hook-form';\nimport { useControlledFieldArray } from '../../../hooks/useControlledFieldArray';\nimport { useUnifiedAlertingSelector } from '../../../hooks/useUnifiedAlertingSelector';\nimport { ChannelValues, CommonSettingsComponentType, ReceiverFormValues } from '../../../types/receiver-form';\nimport { makeAMLink } from '../../../utils/misc';\nimport { ChannelSubForm } from './ChannelSubForm';\nimport { DeletedSubForm } from './fields/DeletedSubform';\nimport { appEvents } from 'app/core/core';\n\ninterface Props<R extends ChannelValues> {\n  config: AlertManagerCortexConfig;\n  notifiers: NotifierDTO[];\n  defaultItem: R;\n  alertManagerSourceName: string;\n  onSubmit: (values: ReceiverFormValues<R>) => void;\n  takenReceiverNames: string[]; // will validate that user entered receiver name is not one of these\n  commonSettingsComponent: CommonSettingsComponentType;\n  initialValues?: ReceiverFormValues<R>;\n}\n\nexport function ReceiverForm<R extends ChannelValues>({\n  config,\n  initialValues,\n  defaultItem,\n  notifiers,\n  alertManagerSourceName,\n  onSubmit,\n  takenReceiverNames,\n  commonSettingsComponent,\n}: Props<R>): JSX.Element {\n  const styles = useStyles2(getStyles);\n\n  const defaultValues = initialValues || {\n    name: '',\n    items: [\n      {\n        ...defaultItem,\n        __id: String(Math.random()),\n      } as any,\n    ],\n  };\n\n  const formAPI = useForm<ReceiverFormValues<R>>({\n    // making a copy here beacuse react-hook-form will mutate these, and break if the object is frozen. for real.\n    defaultValues: JSON.parse(JSON.stringify(defaultValues)),\n  });\n\n  useCleanup((state) => state.unifiedAlerting.saveAMConfig);\n\n  const { loading } = useUnifiedAlertingSelector((state) => state.saveAMConfig);\n\n  const {\n    handleSubmit,\n    register,\n    formState: { errors },\n    getValues,\n  } = formAPI;\n\n  const { fields, append, remove } = useControlledFieldArray<R>({ name: 'items', formAPI, softDelete: true });\n\n  const validateNameIsAvailable: Validate<string> = useCallback(\n    (name: string) =>\n      takenReceiverNames.map((name) => name.trim().toLowerCase()).includes(name.trim().toLowerCase())\n        ? 'Another receiver with this name already exists.'\n        : true,\n    [takenReceiverNames]\n  );\n\n  const submitCallback = (values: ReceiverFormValues<R>) => {\n    onSubmit({\n      ...values,\n      items: values.items.filter((item) => !item.__deleted),\n    });\n  };\n\n  const onInvalid = () => {\n    appEvents.emit(AppEvents.alertError, ['There are errors in the form. Please correct them and try again!']);\n  };\n\n  return (\n    <FormProvider {...formAPI}>\n      {!config.alertmanager_config.route && (\n        <Alert severity=\"warning\" title=\"Attention\">\n          Because there is no default policy configured yet, this contact point will automatically be set as default.\n        </Alert>\n      )}\n      <form onSubmit={handleSubmit(submitCallback, onInvalid)}>\n        <h4 className={styles.heading}>{initialValues ? 'Update contact point' : 'Create contact point'}</h4>\n        <Field label=\"Name\" invalid={!!errors.name} error={errors.name && errors.name.message}>\n          <Input\n            id=\"name\"\n            {...register('name', {\n              required: 'Name is required',\n              validate: { nameIsAvailable: validateNameIsAvailable },\n            })}\n            width={39}\n          />\n        </Field>\n        {fields.map((field, index) => {\n          const pathPrefix = `items.${index}.`;\n          if (field.__deleted) {\n            return <DeletedSubForm key={field.__id} pathPrefix={pathPrefix} />;\n          }\n          const initialItem = initialValues?.items.find(({ __id }) => __id === field.__id);\n          return (\n            <ChannelSubForm<R>\n              defaultValues={field}\n              key={field.__id}\n              onDuplicate={() => {\n                const currentValues: R = getValues().items[index];\n                append({ ...currentValues, __id: String(Math.random()) });\n              }}\n              onDelete={() => remove(index)}\n              pathPrefix={pathPrefix}\n              notifiers={notifiers}\n              secureFields={initialItem?.secureFields}\n              errors={errors?.items?.[index] as FieldErrors<R>}\n              commonSettingsComponent={commonSettingsComponent}\n            />\n          );\n        })}\n        <Button\n          type=\"button\"\n          icon=\"plus\"\n          variant=\"secondary\"\n          onClick={() => append({ ...defaultItem, __id: String(Math.random()) } as R)}\n        >\n          New contact point type\n        </Button>\n        <div className={styles.buttons}>\n          {loading && (\n            <Button disabled={true} icon=\"fa fa-spinner\" variant=\"primary\">\n              Saving...\n            </Button>\n          )}\n          {!loading && <Button type=\"submit\">Save contact point</Button>}\n          <LinkButton\n            disabled={loading}\n            fill=\"outline\"\n            variant=\"secondary\"\n            href={makeAMLink('alerting/notifications', alertManagerSourceName)}\n          >\n            Cancel\n          </LinkButton>\n        </div>\n      </form>\n    </FormProvider>\n  );\n}\n\nconst getStyles = (theme: GrafanaTheme2) => ({\n  heading: css`\n    margin: ${theme.spacing(4, 0)};\n  `,\n  buttons: css`\n    margin-top: ${theme.spacing(4)};\n\n    & > * + * {\n      margin-left: ${theme.spacing(1)};\n    }\n  `,\n});\n","import { Alert } from '@grafana/ui';\nimport { AlertManagerCortexConfig, Receiver } from 'app/plugins/datasource/alertmanager/types';\nimport React, { FC, useMemo } from 'react';\nimport { useDispatch } from 'react-redux';\nimport { updateAlertManagerConfigAction } from '../../../state/actions';\nimport { CloudChannelValues, ReceiverFormValues, CloudChannelMap } from '../../../types/receiver-form';\nimport { cloudNotifierTypes } from '../../../utils/cloud-alertmanager-notifier-types';\nimport { makeAMLink } from '../../../utils/misc';\nimport {\n  cloudReceiverToFormValues,\n  formValuesToCloudReceiver,\n  updateConfigWithReceiver,\n} from '../../../utils/receiver-form';\nimport { CloudCommonChannelSettings } from './CloudCommonChannelSettings';\nimport { ReceiverForm } from './ReceiverForm';\n\ninterface Props {\n  alertManagerSourceName: string;\n  config: AlertManagerCortexConfig;\n  existing?: Receiver;\n}\n\nconst defaultChannelValues: CloudChannelValues = Object.freeze({\n  __id: '',\n  sendResolved: true,\n  secureSettings: {},\n  settings: {},\n  secureFields: {},\n  type: 'email',\n});\n\nexport const CloudReceiverForm: FC<Props> = ({ existing, alertManagerSourceName, config }) => {\n  const dispatch = useDispatch();\n\n  // transform receiver DTO to form values\n  const [existingValue] = useMemo((): [ReceiverFormValues<CloudChannelValues> | undefined, CloudChannelMap] => {\n    if (!existing) {\n      return [undefined, {}];\n    }\n    return cloudReceiverToFormValues(existing, cloudNotifierTypes);\n  }, [existing]);\n\n  const onSubmit = (values: ReceiverFormValues<CloudChannelValues>) => {\n    const newReceiver = formValuesToCloudReceiver(values, defaultChannelValues);\n    dispatch(\n      updateAlertManagerConfigAction({\n        newConfig: updateConfigWithReceiver(config, newReceiver, existing?.name),\n        oldConfig: config,\n        alertManagerSourceName,\n        successMessage: existing ? 'Contact point updated.' : 'Contact point created.',\n        redirectPath: makeAMLink('/alerting/notifications', alertManagerSourceName),\n      })\n    );\n  };\n\n  const takenReceiverNames = useMemo(\n    () => config.alertmanager_config.receivers?.map(({ name }) => name).filter((name) => name !== existing?.name) ?? [],\n    [config, existing]\n  );\n\n  return (\n    <>\n      <Alert title=\"Info\" severity=\"info\">\n        Note that empty string values will be replaced with global defaults were appropriate.\n      </Alert>\n      <ReceiverForm<CloudChannelValues>\n        config={config}\n        onSubmit={onSubmit}\n        initialValues={existingValue}\n        notifiers={cloudNotifierTypes}\n        alertManagerSourceName={alertManagerSourceName}\n        defaultItem={defaultChannelValues}\n        takenReceiverNames={takenReceiverNames}\n        commonSettingsComponent={CloudCommonChannelSettings}\n      />\n    </>\n  );\n};\n","import { Checkbox, Field } from '@grafana/ui';\nimport React, { FC } from 'react';\nimport { CommonSettingsComponentProps } from '../../../types/receiver-form';\nimport { useFormContext } from 'react-hook-form';\n\nexport const GrafanaCommonChannelSettings: FC<CommonSettingsComponentProps> = ({ pathPrefix, className }) => {\n  const { register } = useFormContext();\n  return (\n    <div className={className}>\n      <Field>\n        <Checkbox\n          {...register(`${pathPrefix}disableResolveMessage`)}\n          label=\"Disable resolved message\"\n          description=\"Disable the resolve message [OK] that is sent when alerting state returns to false\"\n        />\n      </Field>\n    </div>\n  );\n};\n","import { LoadingPlaceholder } from '@grafana/ui';\nimport {\n  AlertManagerCortexConfig,\n  GrafanaManagedReceiverConfig,\n  Receiver,\n} from 'app/plugins/datasource/alertmanager/types';\nimport React, { FC, useEffect, useMemo } from 'react';\nimport { useDispatch } from 'react-redux';\nimport { useUnifiedAlertingSelector } from '../../../hooks/useUnifiedAlertingSelector';\nimport { fetchGrafanaNotifiersAction, updateAlertManagerConfigAction } from '../../../state/actions';\nimport { GrafanaChannelValues, ReceiverFormValues } from '../../../types/receiver-form';\nimport { GRAFANA_RULES_SOURCE_NAME } from '../../../utils/datasource';\nimport {\n  formValuesToGrafanaReceiver,\n  grafanaReceiverToFormValues,\n  updateConfigWithReceiver,\n} from '../../../utils/receiver-form';\nimport { GrafanaCommonChannelSettings } from './GrafanaCommonChannelSettings';\nimport { ReceiverForm } from './ReceiverForm';\n\ninterface Props {\n  alertManagerSourceName: string;\n  config: AlertManagerCortexConfig;\n  existing?: Receiver;\n}\n\nconst defaultChannelValues: GrafanaChannelValues = Object.freeze({\n  __id: '',\n  secureSettings: {},\n  settings: {},\n  secureFields: {},\n  disableResolveMessage: false,\n  type: 'email',\n});\n\nexport const GrafanaReceiverForm: FC<Props> = ({ existing, alertManagerSourceName, config }) => {\n  const grafanaNotifiers = useUnifiedAlertingSelector((state) => state.grafanaNotifiers);\n\n  const dispatch = useDispatch();\n\n  useEffect(() => {\n    if (!(grafanaNotifiers.result || grafanaNotifiers.loading)) {\n      dispatch(fetchGrafanaNotifiersAction());\n    }\n  }, [grafanaNotifiers, dispatch]);\n\n  // transform receiver DTO to form values\n  const [existingValue, id2original] = useMemo((): [\n    ReceiverFormValues<GrafanaChannelValues> | undefined,\n    Record<string, GrafanaManagedReceiverConfig>\n  ] => {\n    if (!existing || !grafanaNotifiers.result) {\n      return [undefined, {}];\n    }\n    return grafanaReceiverToFormValues(existing, grafanaNotifiers.result!);\n  }, [existing, grafanaNotifiers.result]);\n\n  const onSubmit = (values: ReceiverFormValues<GrafanaChannelValues>) => {\n    const newReceiver = formValuesToGrafanaReceiver(values, id2original, defaultChannelValues);\n    dispatch(\n      updateAlertManagerConfigAction({\n        newConfig: updateConfigWithReceiver(config, newReceiver, existing?.name),\n        oldConfig: config,\n        alertManagerSourceName: GRAFANA_RULES_SOURCE_NAME,\n        successMessage: existing ? 'Contact point updated.' : 'Contact point created',\n        redirectPath: '/alerting/notifications',\n      })\n    );\n  };\n\n  const takenReceiverNames = useMemo(\n    () => config.alertmanager_config.receivers?.map(({ name }) => name).filter((name) => name !== existing?.name) ?? [],\n    [config, existing]\n  );\n\n  if (grafanaNotifiers.result) {\n    return (\n      <ReceiverForm<GrafanaChannelValues>\n        config={config}\n        onSubmit={onSubmit}\n        initialValues={existingValue}\n        notifiers={grafanaNotifiers.result}\n        alertManagerSourceName={alertManagerSourceName}\n        defaultItem={defaultChannelValues}\n        takenReceiverNames={takenReceiverNames}\n        commonSettingsComponent={GrafanaCommonChannelSettings}\n      />\n    );\n  } else {\n    return <LoadingPlaceholder text=\"Loading notifiers...\" />;\n  }\n};\n","import { InfoBox } from '@grafana/ui';\nimport { AlertManagerCortexConfig } from 'app/plugins/datasource/alertmanager/types';\nimport React, { FC } from 'react';\nimport { GRAFANA_RULES_SOURCE_NAME } from '../../utils/datasource';\nimport { CloudReceiverForm } from './form/CloudReceiverForm';\nimport { GrafanaReceiverForm } from './form/GrafanaReceiverForm';\n\ninterface Props {\n  receiverName: string;\n  config: AlertManagerCortexConfig;\n  alertManagerSourceName: string;\n}\n\nexport const EditReceiverView: FC<Props> = ({ config, receiverName, alertManagerSourceName }) => {\n  const receiver = config.alertmanager_config.receivers?.find(({ name }) => name === receiverName);\n  if (!receiver) {\n    return (\n      <InfoBox severity=\"error\" title=\"Receiver not found\">\n        Sorry, this receiver does not seem to exit.\n      </InfoBox>\n    );\n  }\n\n  if (alertManagerSourceName === GRAFANA_RULES_SOURCE_NAME) {\n    return <GrafanaReceiverForm config={config} alertManagerSourceName={alertManagerSourceName} existing={receiver} />;\n  } else {\n    return <CloudReceiverForm config={config} alertManagerSourceName={alertManagerSourceName} existing={receiver} />;\n  }\n};\n","import { css } from '@emotion/css';\nimport { GrafanaTheme2 } from '@grafana/data';\nimport { Alert, Button, Field, Input, LinkButton, TextArea, useStyles2 } from '@grafana/ui';\nimport { useCleanup } from 'app/core/hooks/useCleanup';\nimport { AlertManagerCortexConfig } from 'app/plugins/datasource/alertmanager/types';\nimport React, { FC } from 'react';\nimport { useForm, Validate } from 'react-hook-form';\nimport { useDispatch } from 'react-redux';\nimport { useUnifiedAlertingSelector } from '../../hooks/useUnifiedAlertingSelector';\nimport { updateAlertManagerConfigAction } from '../../state/actions';\nimport { makeAMLink } from '../../utils/misc';\nimport { ensureDefine } from '../../utils/templates';\n\ninterface Values {\n  name: string;\n  content: string;\n}\n\nconst defaults: Values = Object.freeze({\n  name: '',\n  content: '',\n});\n\ninterface Props {\n  existing?: Values;\n  config: AlertManagerCortexConfig;\n  alertManagerSourceName: string;\n}\n\nexport const TemplateForm: FC<Props> = ({ existing, alertManagerSourceName, config }) => {\n  const styles = useStyles2(getStyles);\n  const dispatch = useDispatch();\n\n  useCleanup((state) => state.unifiedAlerting.saveAMConfig);\n\n  const { loading, error } = useUnifiedAlertingSelector((state) => state.saveAMConfig);\n\n  const submit = (values: Values) => {\n    // wrap content in \"define\" if it's not already wrapped, in case user did not do it/\n    // it's not obvious that this is needed for template to work\n    const content = ensureDefine(values.name, values.content);\n\n    // add new template to template map\n    const template_files = {\n      ...config.template_files,\n      [values.name]: content,\n    };\n\n    // delete existing one (if name changed, otherwise it was overwritten in previous step)\n    if (existing && existing.name !== values.name) {\n      delete template_files[existing.name];\n    }\n\n    // make sure name for the template is configured on the alertmanager config object\n    const templates = [\n      ...(config.alertmanager_config.templates ?? []).filter((name) => name !== existing?.name),\n      values.name,\n    ];\n\n    const newConfig: AlertManagerCortexConfig = {\n      template_files,\n      alertmanager_config: {\n        ...config.alertmanager_config,\n        templates,\n      },\n    };\n    dispatch(\n      updateAlertManagerConfigAction({\n        alertManagerSourceName,\n        newConfig,\n        oldConfig: config,\n        successMessage: 'Template saved.',\n        redirectPath: '/alerting/notifications',\n      })\n    );\n  };\n\n  const {\n    handleSubmit,\n    register,\n    formState: { errors },\n  } = useForm<Values>({\n    mode: 'onSubmit',\n    defaultValues: existing ?? defaults,\n  });\n\n  const validateNameIsUnique: Validate<string> = (name: string) => {\n    return !config.template_files[name] || existing?.name === name\n      ? true\n      : 'Another template with this name already exists.';\n  };\n\n  return (\n    <form onSubmit={handleSubmit(submit)}>\n      <h4>{existing ? 'Edit message template' : 'Create message template'}</h4>\n      {error && (\n        <Alert severity=\"error\" title=\"Error saving template\">\n          {error.message || (error as any)?.data?.message || String(error)}\n        </Alert>\n      )}\n      <Field label=\"Template name\" error={errors?.name?.message} invalid={!!errors.name?.message}>\n        <Input\n          {...register('name', {\n            required: { value: true, message: 'Required.' },\n            validate: { nameIsUnique: validateNameIsUnique },\n          })}\n          width={42}\n          autoFocus={true}\n        />\n      </Field>\n      <Field\n        description={\n          <>\n            You can use the{' '}\n            <a\n              href=\"https://pkg.go.dev/text/template?utm_source=godoc\"\n              target=\"__blank\"\n              rel=\"noreferrer\"\n              className={styles.externalLink}\n            >\n              Go templating language\n            </a>\n            .{' '}\n            <a\n              href=\"https://prometheus.io/blog/2016/03/03/custom-alertmanager-templates/\"\n              target=\"__blank\"\n              rel=\"noreferrer\"\n              className={styles.externalLink}\n            >\n              More info about alertmanager templates\n            </a>\n          </>\n        }\n        label=\"Content\"\n        error={errors?.content?.message}\n        invalid={!!errors.content?.message}\n      >\n        <TextArea\n          {...register('content', { required: { value: true, message: 'Required.' } })}\n          className={styles.textarea}\n          rows={12}\n        />\n      </Field>\n      <div className={styles.buttons}>\n        {loading && (\n          <Button disabled={true} icon=\"fa fa-spinner\" variant=\"primary\">\n            Saving...\n          </Button>\n        )}\n        {!loading && <Button variant=\"primary\">Save template</Button>}\n        <LinkButton\n          disabled={loading}\n          href={makeAMLink('alerting/notifications', alertManagerSourceName)}\n          variant=\"secondary\"\n          type=\"button\"\n          fill=\"outline\"\n        >\n          Cancel\n        </LinkButton>\n      </div>\n    </form>\n  );\n};\n\nconst getStyles = (theme: GrafanaTheme2) => ({\n  externalLink: css`\n    color: ${theme.colors.text.secondary};\n    text-decoration: underline;\n  `,\n  buttons: css`\n    & > * + * {\n      margin-left: ${theme.spacing(1)};\n    }\n  `,\n  textarea: css`\n    max-width: 758px;\n  `,\n});\n","export function ensureDefine(templateName: string, templateContent: string): string {\n  // notification template content must be wrapped in {{ define \"name\" }} tag,\n  // but this is not obvious because user also has to provide name separately in the form.\n  // so if user does not manually add {{ define }} tag, we do it automatically\n  let content = templateContent.trim();\n  if (!content.match(/\\{\\{\\s*define/)) {\n    const indentedContent = content\n      .split('\\n')\n      .map((line) => '  ' + line)\n      .join('\\n');\n    content = `{{ define \"${templateName}\" }}\\n${indentedContent}\\n{{ end }}`;\n  }\n  return content;\n}\n","import { InfoBox } from '@grafana/ui';\nimport { AlertManagerCortexConfig } from 'app/plugins/datasource/alertmanager/types';\nimport React, { FC } from 'react';\nimport { TemplateForm } from './TemplateForm';\n\ninterface Props {\n  templateName: string;\n  config: AlertManagerCortexConfig;\n  alertManagerSourceName: string;\n}\n\nexport const EditTemplateView: FC<Props> = ({ config, templateName, alertManagerSourceName }) => {\n  const template = config.template_files?.[templateName];\n  if (!template) {\n    return (\n      <InfoBox severity=\"error\" title=\"Template not found\">\n        Sorry, this template does not seem to exit.\n      </InfoBox>\n    );\n  }\n  return (\n    <TemplateForm\n      alertManagerSourceName={alertManagerSourceName}\n      config={config}\n      existing={{ name: templateName, content: template }}\n    />\n  );\n};\n","import { useCleanup } from 'app/core/hooks/useCleanup';\nimport { AlertManagerCortexConfig } from 'app/plugins/datasource/alertmanager/types';\nimport React, { FC } from 'react';\nimport { useUnifiedAlertingSelector } from '../../hooks/useUnifiedAlertingSelector';\nimport { useForm, FormProvider } from 'react-hook-form';\nimport { globalConfigOptions } from '../../utils/cloud-alertmanager-notifier-types';\nimport { OptionField } from './form/fields/OptionField';\nimport { Alert, Button, HorizontalGroup, LinkButton, useStyles2 } from '@grafana/ui';\nimport { makeAMLink } from '../../utils/misc';\nimport { useDispatch } from 'react-redux';\nimport { updateAlertManagerConfigAction } from '../../state/actions';\nimport { omitEmptyValues } from '../../utils/receiver-form';\nimport { css } from '@emotion/css';\nimport { GrafanaTheme2 } from '@grafana/data';\n\ninterface Props {\n  config: AlertManagerCortexConfig;\n  alertManagerSourceName: string;\n}\n\ntype FormValues = Record<string, unknown>;\n\nconst defaultValues: FormValues = {\n  smtp_require_tls: true,\n} as const;\n\nexport const GlobalConfigForm: FC<Props> = ({ config, alertManagerSourceName }) => {\n  const dispatch = useDispatch();\n  useCleanup((state) => state.unifiedAlerting.saveAMConfig);\n  const { loading, error } = useUnifiedAlertingSelector((state) => state.saveAMConfig);\n\n  const styles = useStyles2(getStyles);\n\n  const formAPI = useForm<FormValues>({\n    // making a copy here beacuse react-hook-form will mutate these, and break if the object is frozen. for real.\n    defaultValues: JSON.parse(\n      JSON.stringify({\n        ...defaultValues,\n        ...(config.alertmanager_config.global ?? {}),\n      })\n    ),\n  });\n\n  const {\n    handleSubmit,\n    formState: { errors },\n  } = formAPI;\n\n  const onSubmitCallback = (values: FormValues) => {\n    dispatch(\n      updateAlertManagerConfigAction({\n        newConfig: {\n          ...config,\n          alertmanager_config: {\n            ...config.alertmanager_config,\n            global: omitEmptyValues(values),\n          },\n        },\n        oldConfig: config,\n        alertManagerSourceName,\n        successMessage: 'Global config updated.',\n        redirectPath: makeAMLink('/alerting/notifications', alertManagerSourceName),\n      })\n    );\n  };\n\n  return (\n    <FormProvider {...formAPI}>\n      <form onSubmit={handleSubmit(onSubmitCallback)}>\n        <h4 className={styles.heading}>Global config</h4>\n        {error && (\n          <Alert severity=\"error\" title=\"Error saving receiver\">\n            {error.message || String(error)}\n          </Alert>\n        )}\n        {globalConfigOptions.map((option) => (\n          <OptionField\n            defaultValue={defaultValues[option.propertyName]}\n            key={option.propertyName}\n            option={option}\n            error={errors[option.propertyName]}\n            pathPrefix={''}\n          />\n        ))}\n        <div>\n          <HorizontalGroup>\n            {loading && (\n              <Button disabled={true} icon=\"fa fa-spinner\" variant=\"primary\">\n                Saving...\n              </Button>\n            )}\n            {!loading && <Button type=\"submit\">Save global config</Button>}\n            <LinkButton\n              disabled={loading}\n              fill=\"outline\"\n              variant=\"secondary\"\n              href={makeAMLink('alerting/notifications', alertManagerSourceName)}\n            >\n              Cancel\n            </LinkButton>\n          </HorizontalGroup>\n        </div>\n      </form>\n    </FormProvider>\n  );\n};\n\nconst getStyles = (theme: GrafanaTheme2) => ({\n  heading: css`\n    margin: ${theme.spacing(4, 0)};\n  `,\n});\n","import { AlertManagerCortexConfig } from 'app/plugins/datasource/alertmanager/types';\nimport React, { FC } from 'react';\nimport { GRAFANA_RULES_SOURCE_NAME } from '../../utils/datasource';\nimport { CloudReceiverForm } from './form/CloudReceiverForm';\nimport { GrafanaReceiverForm } from './form/GrafanaReceiverForm';\n\ninterface Props {\n  config: AlertManagerCortexConfig;\n  alertManagerSourceName: string;\n}\n\nexport const NewReceiverView: FC<Props> = ({ alertManagerSourceName, config }) => {\n  if (alertManagerSourceName === GRAFANA_RULES_SOURCE_NAME) {\n    return <GrafanaReceiverForm alertManagerSourceName={alertManagerSourceName} config={config} />;\n  } else {\n    return <CloudReceiverForm alertManagerSourceName={alertManagerSourceName} config={config} />;\n  }\n};\n","import { AlertManagerCortexConfig } from 'app/plugins/datasource/alertmanager/types';\nimport React, { FC } from 'react';\nimport { TemplateForm } from './TemplateForm';\n\ninterface Props {\n  config: AlertManagerCortexConfig;\n  alertManagerSourceName: string;\n}\n\nexport const NewTemplateView: FC<Props> = ({ config, alertManagerSourceName }) => {\n  return <TemplateForm config={config} alertManagerSourceName={alertManagerSourceName} />;\n};\n","export const receiverTypeNames: Record<string, string> = {\n  pagerduty: 'PagerDuty',\n  pushover: 'Pushover',\n  slack: 'Slack',\n  opsgenie: 'OpsGenie',\n  webhook: 'Webhook',\n  victorops: 'VictorOps',\n  wechat: 'WeChat',\n};\n","import { receiverTypeNames } from 'app/plugins/datasource/alertmanager/consts';\nimport { GrafanaManagedReceiverConfig, Receiver } from 'app/plugins/datasource/alertmanager/types';\nimport { NotifierDTO } from 'app/types';\nimport { capitalize } from 'lodash';\n\n// extract notifier type name to count map, eg { Slack: 1, Email: 2 }\n\ntype NotifierTypeCounts = Record<string, number>; // name : count\n\nexport function extractNotifierTypeCounts(receiver: Receiver, grafanaNotifiers: NotifierDTO[]): NotifierTypeCounts {\n  if (receiver['grafana_managed_receiver_configs']) {\n    return getGrafanaNotifierTypeCounts(receiver.grafana_managed_receiver_configs ?? [], grafanaNotifiers);\n  }\n  return getCortexAlertManagerNotifierTypeCounts(receiver);\n}\n\nfunction getCortexAlertManagerNotifierTypeCounts(receiver: Receiver): NotifierTypeCounts {\n  return Object.entries(receiver)\n    .filter(([key]) => key !== 'grafana_managed_receiver_configs' && key.endsWith('_configs')) // filter out only properties that are alertmanager notifier\n    .filter(([_, value]) => Array.isArray(value) && !!value.length) // check that there are actually notifiers of this type configured\n    .reduce<NotifierTypeCounts>((acc, [key, value]) => {\n      const type = key.replace('_configs', ''); // remove the `_config` part from the key, making it intto a notifier name\n      const name = receiverTypeNames[type] ?? capitalize(type);\n      return {\n        ...acc,\n        [name]: (acc[name] ?? 0) + (Array.isArray(value) ? value.length : 1),\n      };\n    }, {});\n}\n\nfunction getGrafanaNotifierTypeCounts(\n  configs: GrafanaManagedReceiverConfig[],\n  grafanaNotifiers: NotifierDTO[]\n): NotifierTypeCounts {\n  return configs\n    .map((recv) => recv.type) // extract types from config\n    .map((type) => grafanaNotifiers.find((r) => r.type === type)?.name ?? capitalize(type)) // get readable name from notifier cofnig, or if not available, just capitalize\n    .reduce<NotifierTypeCounts>(\n      (acc, type) => ({\n        ...acc,\n        [type]: (acc[type] ?? 0) + 1,\n      }),\n      {}\n    );\n}\n","import { css, cx } from '@emotion/css';\nimport { GrafanaTheme2 } from '@grafana/data';\nimport { Button, useStyles2 } from '@grafana/ui';\nimport React, { FC } from 'react';\nimport { Link } from 'react-router-dom';\n\ninterface Props {\n  title: string;\n  description: string;\n  addButtonLabel: string;\n  addButtonTo: string;\n  className?: string;\n}\n\nexport const ReceiversSection: FC<Props> = ({\n  className,\n  title,\n  description,\n  addButtonLabel,\n  addButtonTo,\n  children,\n}) => {\n  const styles = useStyles2(getStyles);\n  return (\n    <>\n      <div className={cx(styles.heading, className)}>\n        <div>\n          <h4>{title}</h4>\n          <p className={styles.description}>{description}</p>\n        </div>\n        <Link to={addButtonTo}>\n          <Button icon=\"plus\">{addButtonLabel}</Button>\n        </Link>\n      </div>\n      {children}\n    </>\n  );\n};\n\nconst getStyles = (theme: GrafanaTheme2) => ({\n  heading: css`\n    display: flex;\n    justify-content: space-between;\n  `,\n  description: css`\n    color: ${theme.colors.text.secondary};\n  `,\n});\n","import { Button, ConfirmModal, Modal, useStyles2 } from '@grafana/ui';\nimport { AlertManagerCortexConfig } from 'app/plugins/datasource/alertmanager/types';\nimport React, { FC, useMemo, useState } from 'react';\nimport { useUnifiedAlertingSelector } from '../../hooks/useUnifiedAlertingSelector';\nimport { getAlertTableStyles } from '../../styles/table';\nimport { extractNotifierTypeCounts } from '../../utils/receivers';\nimport { ActionIcon } from '../rules/ActionIcon';\nimport { ReceiversSection } from './ReceiversSection';\nimport { makeAMLink } from '../../utils/misc';\nimport { GrafanaTheme2 } from '@grafana/data';\nimport { css } from '@emotion/css';\nimport { isReceiverUsed } from '../../utils/alertmanager';\nimport { useDispatch } from 'react-redux';\nimport { deleteReceiverAction } from '../../state/actions';\n\ninterface Props {\n  config: AlertManagerCortexConfig;\n  alertManagerName: string;\n}\n\nexport const ReceiversTable: FC<Props> = ({ config, alertManagerName }) => {\n  const dispatch = useDispatch();\n  const tableStyles = useStyles2(getAlertTableStyles);\n  const styles = useStyles2(getStyles);\n\n  const grafanaNotifiers = useUnifiedAlertingSelector((state) => state.grafanaNotifiers);\n\n  // receiver name slated for deletion. If this is set, a confirmation modal is shown. If user approves, this receiver is deleted\n  const [receiverToDelete, setReceiverToDelete] = useState<string>();\n  const [showCannotDeleteReceiverModal, setShowCannotDeleteReceiverModal] = useState(false);\n\n  const onClickDeleteReceiver = (receiverName: string): void => {\n    if (isReceiverUsed(receiverName, config)) {\n      setShowCannotDeleteReceiverModal(true);\n    } else {\n      setReceiverToDelete(receiverName);\n    }\n  };\n\n  const deleteReceiver = () => {\n    if (receiverToDelete) {\n      dispatch(deleteReceiverAction(receiverToDelete, alertManagerName));\n    }\n    setReceiverToDelete(undefined);\n  };\n\n  const rows = useMemo(\n    () =>\n      config.alertmanager_config.receivers?.map((receiver) => ({\n        name: receiver.name,\n        types: Object.entries(extractNotifierTypeCounts(receiver, grafanaNotifiers.result ?? [])).map(\n          ([type, count]) => {\n            if (count > 1) {\n              return `${type} (${count})`;\n            }\n            return type;\n          }\n        ),\n      })) ?? [],\n    [config, grafanaNotifiers.result]\n  );\n\n  return (\n    <ReceiversSection\n      className={styles.section}\n      title=\"Contact points\"\n      description=\"Define where the notifications will be sent to, for example email or Slack.\"\n      addButtonLabel=\"New contact point\"\n      addButtonTo={makeAMLink('/alerting/notifications/receivers/new', alertManagerName)}\n    >\n      <table className={tableStyles.table} data-testid=\"receivers-table\">\n        <colgroup>\n          <col />\n          <col />\n          <col />\n        </colgroup>\n        <thead>\n          <tr>\n            <th>Contact point name</th>\n            <th>Type</th>\n            <th>Actions</th>\n          </tr>\n        </thead>\n        <tbody>\n          {!rows.length && (\n            <tr className={tableStyles.evenRow}>\n              <td colSpan={3}>No receivers defined.</td>\n            </tr>\n          )}\n          {rows.map((receiver, idx) => (\n            <tr key={receiver.name} className={idx % 2 === 0 ? tableStyles.evenRow : undefined}>\n              <td>{receiver.name}</td>\n              <td>{receiver.types.join(', ')}</td>\n              <td className={tableStyles.actionsCell}>\n                <ActionIcon\n                  data-testid=\"edit\"\n                  to={makeAMLink(\n                    `/alerting/notifications/receivers/${encodeURIComponent(receiver.name)}/edit`,\n                    alertManagerName\n                  )}\n                  tooltip=\"Edit contact point\"\n                  icon=\"pen\"\n                />\n                <ActionIcon\n                  onClick={() => onClickDeleteReceiver(receiver.name)}\n                  tooltip=\"Delete contact point\"\n                  icon=\"trash-alt\"\n                />\n              </td>\n            </tr>\n          ))}\n        </tbody>\n      </table>\n      {!!showCannotDeleteReceiverModal && (\n        <Modal\n          isOpen={true}\n          title=\"Cannot delete contact point\"\n          onDismiss={() => setShowCannotDeleteReceiverModal(false)}\n        >\n          <p>\n            Contact point cannot be deleted because it is used in more policies. Please update or delete these policies\n            first.\n          </p>\n          <Modal.ButtonRow>\n            <Button variant=\"secondary\" onClick={() => setShowCannotDeleteReceiverModal(false)} fill=\"outline\">\n              Close\n            </Button>\n          </Modal.ButtonRow>\n        </Modal>\n      )}\n      {!!receiverToDelete && (\n        <ConfirmModal\n          isOpen={true}\n          title=\"Delete contact point\"\n          body={`Are you sure you want to delete contact point \"${receiverToDelete}\"?`}\n          confirmText=\"Yes, delete\"\n          onConfirm={deleteReceiver}\n          onDismiss={() => setReceiverToDelete(undefined)}\n        />\n      )}\n    </ReceiversSection>\n  );\n};\n\nconst getStyles = (theme: GrafanaTheme2) => ({\n  section: css`\n    margin-top: ${theme.spacing(4)};\n  `,\n});\n","import { ConfirmModal, useStyles2 } from '@grafana/ui';\nimport { AlertManagerCortexConfig } from 'app/plugins/datasource/alertmanager/types';\nimport React, { FC, Fragment, useMemo, useState } from 'react';\nimport { getAlertTableStyles } from '../../styles/table';\nimport { CollapseToggle } from '../CollapseToggle';\nimport { DetailsField } from '../DetailsField';\nimport { ActionIcon } from '../rules/ActionIcon';\nimport { ReceiversSection } from './ReceiversSection';\nimport { makeAMLink } from '../../utils/misc';\nimport { useDispatch } from 'react-redux';\nimport { deleteTemplateAction } from '../../state/actions';\n\ninterface Props {\n  config: AlertManagerCortexConfig;\n  alertManagerName: string;\n}\n\nexport const TemplatesTable: FC<Props> = ({ config, alertManagerName }) => {\n  const dispatch = useDispatch();\n  const [expandedTemplates, setExpandedTemplates] = useState<Record<string, boolean>>({});\n  const tableStyles = useStyles2(getAlertTableStyles);\n\n  const templateRows = useMemo(() => Object.entries(config.template_files), [config]);\n  const [templateToDelete, setTemplateToDelete] = useState<string>();\n\n  const deleteTemplate = () => {\n    if (templateToDelete) {\n      dispatch(deleteTemplateAction(templateToDelete, alertManagerName));\n    }\n    setTemplateToDelete(undefined);\n  };\n\n  return (\n    <ReceiversSection\n      title=\"Message templates\"\n      description=\"Templates construct the messages that get sent to the contact points.\"\n      addButtonLabel=\"New template\"\n      addButtonTo={makeAMLink('/alerting/notifications/templates/new', alertManagerName)}\n    >\n      <table className={tableStyles.table} data-testid=\"templates-table\">\n        <colgroup>\n          <col className={tableStyles.colExpand} />\n          <col />\n          <col />\n        </colgroup>\n        <thead>\n          <tr>\n            <th></th>\n            <th>Template</th>\n            <th>Actions</th>\n          </tr>\n        </thead>\n        <tbody>\n          {!templateRows.length && (\n            <tr className={tableStyles.evenRow}>\n              <td colSpan={3}>No templates defined.</td>\n            </tr>\n          )}\n          {templateRows.map(([name, content], idx) => {\n            const isExpanded = !!expandedTemplates[name];\n            return (\n              <Fragment key={name}>\n                <tr key={name} className={idx % 2 === 0 ? tableStyles.evenRow : undefined}>\n                  <td>\n                    <CollapseToggle\n                      isCollapsed={!expandedTemplates[name]}\n                      onToggle={() => setExpandedTemplates({ ...expandedTemplates, [name]: !isExpanded })}\n                    />\n                  </td>\n                  <td>{name}</td>\n                  <td className={tableStyles.actionsCell}>\n                    <ActionIcon\n                      to={makeAMLink(\n                        `/alerting/notifications/templates/${encodeURIComponent(name)}/edit`,\n                        alertManagerName\n                      )}\n                      tooltip=\"edit template\"\n                      icon=\"pen\"\n                    />\n                    <ActionIcon onClick={() => setTemplateToDelete(name)} tooltip=\"delete template\" icon=\"trash-alt\" />\n                  </td>\n                </tr>\n                {isExpanded && (\n                  <tr className={idx % 2 === 0 ? tableStyles.evenRow : undefined}>\n                    <td></td>\n                    <td colSpan={2}>\n                      <DetailsField label=\"Description\" horizontal={true}>\n                        <pre>{content}</pre>\n                      </DetailsField>\n                    </td>\n                  </tr>\n                )}\n              </Fragment>\n            );\n          })}\n        </tbody>\n      </table>\n\n      {!!templateToDelete && (\n        <ConfirmModal\n          isOpen={true}\n          title=\"Delete template\"\n          body={`Are you sure you want to delete template \"${templateToDelete}\"?`}\n          confirmText=\"Yes, delete\"\n          onConfirm={deleteTemplate}\n          onDismiss={() => setTemplateToDelete(undefined)}\n        />\n      )}\n    </ReceiversSection>\n  );\n};\n","import { css } from '@emotion/css';\nimport { GrafanaTheme2 } from '@grafana/data';\nimport { Alert, LinkButton, useStyles2 } from '@grafana/ui';\nimport { AlertManagerCortexConfig } from 'app/plugins/datasource/alertmanager/types';\nimport React, { FC } from 'react';\nimport { GRAFANA_RULES_SOURCE_NAME } from '../../utils/datasource';\nimport { makeAMLink } from '../../utils/misc';\nimport { ReceiversTable } from './ReceiversTable';\nimport { TemplatesTable } from './TemplatesTable';\n\ninterface Props {\n  config: AlertManagerCortexConfig;\n  alertManagerName: string;\n}\n\nexport const ReceiversAndTemplatesView: FC<Props> = ({ config, alertManagerName }) => {\n  const isCloud = alertManagerName !== GRAFANA_RULES_SOURCE_NAME;\n  const styles = useStyles2(getStyles);\n  return (\n    <>\n      <TemplatesTable config={config} alertManagerName={alertManagerName} />\n      <ReceiversTable config={config} alertManagerName={alertManagerName} />\n      {isCloud && (\n        <Alert className={styles.section} severity=\"info\" title=\"Global config for contact points\">\n          <p>\n            For each external Alertmanager you can define global settings, like server addresses, usernames and\n            password, for all the supported contact points.\n          </p>\n          <LinkButton href={makeAMLink('alerting/notifications/global-config', alertManagerName)} variant=\"secondary\">\n            Edit global config\n          </LinkButton>\n        </Alert>\n      )}\n    </>\n  );\n};\n\nconst getStyles = (theme: GrafanaTheme2) => ({\n  section: css`\n    margin-top: ${theme.spacing(4)};\n  `,\n});\n","import { Alert, LoadingPlaceholder, withErrorBoundary } from '@grafana/ui';\nimport React, { FC, useEffect } from 'react';\nimport { useDispatch } from 'react-redux';\nimport { Redirect, Route, RouteChildrenProps, Switch, useLocation } from 'react-router-dom';\nimport { AlertingPageWrapper } from './components/AlertingPageWrapper';\nimport { AlertManagerPicker } from './components/AlertManagerPicker';\nimport { EditReceiverView } from './components/receivers/EditReceiverView';\nimport { EditTemplateView } from './components/receivers/EditTemplateView';\nimport { GlobalConfigForm } from './components/receivers/GlobalConfigForm';\nimport { NewReceiverView } from './components/receivers/NewReceiverView';\nimport { NewTemplateView } from './components/receivers/NewTemplateView';\nimport { ReceiversAndTemplatesView } from './components/receivers/ReceiversAndTemplatesView';\nimport { useAlertManagerSourceName } from './hooks/useAlertManagerSourceName';\nimport { useUnifiedAlertingSelector } from './hooks/useUnifiedAlertingSelector';\nimport { fetchAlertManagerConfigAction, fetchGrafanaNotifiersAction } from './state/actions';\nimport { GRAFANA_RULES_SOURCE_NAME } from './utils/datasource';\nimport { initialAsyncRequestState } from './utils/redux';\n\nconst Receivers: FC = () => {\n  const [alertManagerSourceName, setAlertManagerSourceName] = useAlertManagerSourceName();\n  const dispatch = useDispatch();\n\n  const location = useLocation();\n  const isRoot = location.pathname.endsWith('/alerting/notifications');\n\n  const configRequests = useUnifiedAlertingSelector((state) => state.amConfigs);\n\n  const { result: config, loading, error } =\n    (alertManagerSourceName && configRequests[alertManagerSourceName]) || initialAsyncRequestState;\n  const receiverTypes = useUnifiedAlertingSelector((state) => state.grafanaNotifiers);\n\n  const shouldLoadConfig = isRoot || !config;\n\n  useEffect(() => {\n    if (alertManagerSourceName && shouldLoadConfig) {\n      dispatch(fetchAlertManagerConfigAction(alertManagerSourceName));\n    }\n  }, [alertManagerSourceName, dispatch, shouldLoadConfig]);\n\n  useEffect(() => {\n    if (alertManagerSourceName === GRAFANA_RULES_SOURCE_NAME && !(receiverTypes.result || receiverTypes.loading)) {\n      dispatch(fetchGrafanaNotifiersAction());\n    }\n  }, [alertManagerSourceName, dispatch, receiverTypes]);\n\n  const disableAmSelect = !isRoot;\n\n  if (!alertManagerSourceName) {\n    return <Redirect to=\"/alerting/notifications\" />;\n  }\n\n  return (\n    <AlertingPageWrapper pageId=\"receivers\">\n      <AlertManagerPicker\n        current={alertManagerSourceName}\n        disabled={disableAmSelect}\n        onChange={setAlertManagerSourceName}\n      />\n      {error && !loading && (\n        <Alert severity=\"error\" title=\"Error loading Alertmanager config\">\n          {error.message || 'Unknown error.'}\n        </Alert>\n      )}\n      {loading && !config && <LoadingPlaceholder text=\"loading configuration...\" />}\n      {config && !error && (\n        <Switch>\n          <Route exact={true} path=\"/alerting/notifications\">\n            <ReceiversAndTemplatesView config={config} alertManagerName={alertManagerSourceName} />\n          </Route>\n          <Route exact={true} path=\"/alerting/notifications/templates/new\">\n            <NewTemplateView config={config} alertManagerSourceName={alertManagerSourceName} />\n          </Route>\n          <Route exact={true} path=\"/alerting/notifications/templates/:name/edit\">\n            {({ match }: RouteChildrenProps<{ name: string }>) =>\n              match?.params.name && (\n                <EditTemplateView\n                  alertManagerSourceName={alertManagerSourceName}\n                  config={config}\n                  templateName={decodeURIComponent(match?.params.name)}\n                />\n              )\n            }\n          </Route>\n          <Route exact={true} path=\"/alerting/notifications/receivers/new\">\n            <NewReceiverView config={config} alertManagerSourceName={alertManagerSourceName} />\n          </Route>\n          <Route exact={true} path=\"/alerting/notifications/receivers/:name/edit\">\n            {({ match }: RouteChildrenProps<{ name: string }>) =>\n              match?.params.name && (\n                <EditReceiverView\n                  alertManagerSourceName={alertManagerSourceName}\n                  config={config}\n                  receiverName={decodeURIComponent(match?.params.name)}\n                />\n              )\n            }\n          </Route>\n          <Route exact={true} path=\"/alerting/notifications/global-config\">\n            <GlobalConfigForm config={config} alertManagerSourceName={alertManagerSourceName} />\n          </Route>\n        </Switch>\n      )}\n    </AlertingPageWrapper>\n  );\n};\n\nexport default withErrorBoundary(Receivers, { style: 'page' });\n","import { config } from '@grafana/runtime';\nimport NotificationsListPage from './NotificationsListPage';\nimport Receivers from './unified/Receivers';\n\n// route between unified and \"old\" alerting pages based on feature flag\n\nexport default config.featureToggles.ngalert ? Receivers : NotificationsListPage;\n","import { UrlQueryMap } from '@grafana/data';\nimport { locationSearchToObject, locationService } from '@grafana/runtime';\nimport { useCallback, useMemo } from 'react';\nimport { useLocation } from 'react-router-dom';\n\nexport function useQueryParams(): [UrlQueryMap, (values: UrlQueryMap, replace?: boolean) => void] {\n  const { search } = useLocation();\n  const queryParams = useMemo(() => locationSearchToObject(search || ''), [search]);\n  const update = useCallback(\n    (values: UrlQueryMap, replace?: boolean) => setImmediate(() => locationService.partial(values, replace)),\n    []\n  );\n  return [queryParams, update];\n}\n","import { Icon, IconName, useStyles, Tooltip } from '@grafana/ui';\nimport { PopoverContent } from '@grafana/ui/src/components/Tooltip/Tooltip';\nimport { TooltipPlacement } from '@grafana/ui/src/components/Tooltip/PopoverController';\nimport React, { FC } from 'react';\nimport { css, cx } from '@emotion/css';\nimport { Link } from 'react-router-dom';\n\ninterface Props {\n  tooltip: PopoverContent;\n  icon: IconName;\n\n  className?: string;\n  tooltipPlacement?: TooltipPlacement;\n  to?: string;\n  target?: string;\n  onClick?: (e: React.MouseEvent<HTMLDivElement, MouseEvent>) => void;\n  'data-testid'?: string;\n}\n\nexport const ActionIcon: FC<Props> = ({\n  tooltip,\n  icon,\n  to,\n  target,\n  onClick,\n  className,\n  tooltipPlacement = 'top',\n  ...rest\n}) => {\n  const iconEl = <Icon className={cx(useStyles(getStyle), className)} onClick={onClick} name={icon} {...rest} />;\n\n  return (\n    <Tooltip content={tooltip} placement={tooltipPlacement}>\n      {(() => {\n        if (to) {\n          return (\n            <Link to={to} target={target}>\n              {iconEl}\n            </Link>\n          );\n        }\n        return iconEl;\n      })()}\n    </Tooltip>\n  );\n};\n\nexport const getStyle = () => css`\n  cursor: pointer;\n`;\n","import { GrafanaTheme2 } from '@grafana/data';\nimport { css } from '@emotion/css';\n\nexport const getAlertTableStyles = (theme: GrafanaTheme2) => ({\n  table: css`\n    width: 100%;\n    border-radius: ${theme.shape.borderRadius()};\n    border: solid 1px ${theme.colors.border.weak};\n    background-color: ${theme.colors.background.secondary};\n\n    th {\n      padding: ${theme.spacing(1)};\n    }\n\n    td {\n      padding: 0 ${theme.spacing(1)};\n    }\n\n    tr {\n      height: 38px;\n    }\n  `,\n  evenRow: css`\n    background-color: ${theme.colors.background.primary};\n  `,\n  colExpand: css`\n    width: 36px;\n  `,\n  actionsCell: css`\n    text-align: right;\n    width: 1%;\n    white-space: nowrap;\n\n    & > * + * {\n      margin-left: ${theme.spacing(1)};\n    }\n  `,\n});\n","import { useEffect, useRef } from 'react';\nimport { useDispatch } from 'react-redux';\nimport { cleanUpAction, StateSelector } from '../actions/cleanUp';\n\nexport function useCleanup<T>(stateSelector: StateSelector<T>) {\n  const dispatch = useDispatch();\n  //bit of a hack to unburden user from having to wrap stateSelcetor in a useCallback. Otherwise cleanup would happen on every render\n  const selectorRef = useRef(stateSelector);\n  selectorRef.current = stateSelector;\n  useEffect(() => {\n    return () => {\n      dispatch(cleanUpAction({ stateSelector: selectorRef.current }));\n    };\n  }, [dispatch]);\n}\n","var scope = (typeof global !== \"undefined\" && global) ||\n            (typeof self !== \"undefined\" && self) ||\n            window;\nvar apply = Function.prototype.apply;\n\n// DOM APIs, for completeness\n\nexports.setTimeout = function() {\n  return new Timeout(apply.call(setTimeout, scope, arguments), clearTimeout);\n};\nexports.setInterval = function() {\n  return new Timeout(apply.call(setInterval, scope, arguments), clearInterval);\n};\nexports.clearTimeout =\nexports.clearInterval = function(timeout) {\n  if (timeout) {\n    timeout.close();\n  }\n};\n\nfunction Timeout(id, clearFn) {\n  this._id = id;\n  this._clearFn = clearFn;\n}\nTimeout.prototype.unref = Timeout.prototype.ref = function() {};\nTimeout.prototype.close = function() {\n  this._clearFn.call(scope, this._id);\n};\n\n// Does not start the time, just sets up the members needed.\nexports.enroll = function(item, msecs) {\n  clearTimeout(item._idleTimeoutId);\n  item._idleTimeout = msecs;\n};\n\nexports.unenroll = function(item) {\n  clearTimeout(item._idleTimeoutId);\n  item._idleTimeout = -1;\n};\n\nexports._unrefActive = exports.active = function(item) {\n  clearTimeout(item._idleTimeoutId);\n\n  var msecs = item._idleTimeout;\n  if (msecs >= 0) {\n    item._idleTimeoutId = setTimeout(function onTimeout() {\n      if (item._onTimeout)\n        item._onTimeout();\n    }, msecs);\n  }\n};\n\n// setimmediate attaches itself to the global object\nrequire(\"setimmediate\");\n// On some exotic environments, it's not clear which object `setimmediate` was\n// able to install onto.  Search each possibility in the same order as the\n// `setimmediate` library.\nexports.setImmediate = (typeof self !== \"undefined\" && self.setImmediate) ||\n                       (typeof global !== \"undefined\" && global.setImmediate) ||\n                       (this && this.setImmediate);\nexports.clearImmediate = (typeof self !== \"undefined\" && self.clearImmediate) ||\n                         (typeof global !== \"undefined\" && global.clearImmediate) ||\n                         (this && this.clearImmediate);\n","(function (global, undefined) {\n    \"use strict\";\n\n    if (global.setImmediate) {\n        return;\n    }\n\n    var nextHandle = 1; // Spec says greater than zero\n    var tasksByHandle = {};\n    var currentlyRunningATask = false;\n    var doc = global.document;\n    var registerImmediate;\n\n    function setImmediate(callback) {\n      // Callback can either be a function or a string\n      if (typeof callback !== \"function\") {\n        callback = new Function(\"\" + callback);\n      }\n      // Copy function arguments\n      var args = new Array(arguments.length - 1);\n      for (var i = 0; i < args.length; i++) {\n          args[i] = arguments[i + 1];\n      }\n      // Store and register the task\n      var task = { callback: callback, args: args };\n      tasksByHandle[nextHandle] = task;\n      registerImmediate(nextHandle);\n      return nextHandle++;\n    }\n\n    function clearImmediate(handle) {\n        delete tasksByHandle[handle];\n    }\n\n    function run(task) {\n        var callback = task.callback;\n        var args = task.args;\n        switch (args.length) {\n        case 0:\n            callback();\n            break;\n        case 1:\n            callback(args[0]);\n            break;\n        case 2:\n            callback(args[0], args[1]);\n            break;\n        case 3:\n            callback(args[0], args[1], args[2]);\n            break;\n        default:\n            callback.apply(undefined, args);\n            break;\n        }\n    }\n\n    function runIfPresent(handle) {\n        // From the spec: \"Wait until any invocations of this algorithm started before this one have completed.\"\n        // So if we're currently running a task, we'll need to delay this invocation.\n        if (currentlyRunningATask) {\n            // Delay by doing a setTimeout. setImmediate was tried instead, but in Firefox 7 it generated a\n            // \"too much recursion\" error.\n            setTimeout(runIfPresent, 0, handle);\n        } else {\n            var task = tasksByHandle[handle];\n            if (task) {\n                currentlyRunningATask = true;\n                try {\n                    run(task);\n                } finally {\n                    clearImmediate(handle);\n                    currentlyRunningATask = false;\n                }\n            }\n        }\n    }\n\n    function installNextTickImplementation() {\n        registerImmediate = function(handle) {\n            process.nextTick(function () { runIfPresent(handle); });\n        };\n    }\n\n    function canUsePostMessage() {\n        // The test against `importScripts` prevents this implementation from being installed inside a web worker,\n        // where `global.postMessage` means something completely different and can't be used for this purpose.\n        if (global.postMessage && !global.importScripts) {\n            var postMessageIsAsynchronous = true;\n            var oldOnMessage = global.onmessage;\n            global.onmessage = function() {\n                postMessageIsAsynchronous = false;\n            };\n            global.postMessage(\"\", \"*\");\n            global.onmessage = oldOnMessage;\n            return postMessageIsAsynchronous;\n        }\n    }\n\n    function installPostMessageImplementation() {\n        // Installs an event handler on `global` for the `message` event: see\n        // * https://developer.mozilla.org/en/DOM/window.postMessage\n        // * http://www.whatwg.org/specs/web-apps/current-work/multipage/comms.html#crossDocumentMessages\n\n        var messagePrefix = \"setImmediate$\" + Math.random() + \"$\";\n        var onGlobalMessage = function(event) {\n            if (event.source === global &&\n                typeof event.data === \"string\" &&\n                event.data.indexOf(messagePrefix) === 0) {\n                runIfPresent(+event.data.slice(messagePrefix.length));\n            }\n        };\n\n        if (global.addEventListener) {\n            global.addEventListener(\"message\", onGlobalMessage, false);\n        } else {\n            global.attachEvent(\"onmessage\", onGlobalMessage);\n        }\n\n        registerImmediate = function(handle) {\n            global.postMessage(messagePrefix + handle, \"*\");\n        };\n    }\n\n    function installMessageChannelImplementation() {\n        var channel = new MessageChannel();\n        channel.port1.onmessage = function(event) {\n            var handle = event.data;\n            runIfPresent(handle);\n        };\n\n        registerImmediate = function(handle) {\n            channel.port2.postMessage(handle);\n        };\n    }\n\n    function installReadyStateChangeImplementation() {\n        var html = doc.documentElement;\n        registerImmediate = function(handle) {\n            // Create a <script> element; its readystatechange event will be fired asynchronously once it is inserted\n            // into the document. Do so, thus queuing up the task. Remember to clean up once it's been called.\n            var script = doc.createElement(\"script\");\n            script.onreadystatechange = function () {\n                runIfPresent(handle);\n                script.onreadystatechange = null;\n                html.removeChild(script);\n                script = null;\n            };\n            html.appendChild(script);\n        };\n    }\n\n    function installSetTimeoutImplementation() {\n        registerImmediate = function(handle) {\n            setTimeout(runIfPresent, 0, handle);\n        };\n    }\n\n    // If supported, we should attach to the prototype of global, since that is where setTimeout et al. live.\n    var attachTo = Object.getPrototypeOf && Object.getPrototypeOf(global);\n    attachTo = attachTo && attachTo.setTimeout ? attachTo : global;\n\n    // Don't get fooled by e.g. browserify environments.\n    if ({}.toString.call(global.process) === \"[object process]\") {\n        // For Node.js before 0.9\n        installNextTickImplementation();\n\n    } else if (canUsePostMessage()) {\n        // For non-IE10 modern browsers\n        installPostMessageImplementation();\n\n    } else if (global.MessageChannel) {\n        // For web workers, where supported\n        installMessageChannelImplementation();\n\n    } else if (doc && \"onreadystatechange\" in doc.createElement(\"script\")) {\n        // For IE 6–8\n        installReadyStateChangeImplementation();\n\n    } else {\n        // For older browsers\n        installSetTimeoutImplementation();\n    }\n\n    attachTo.setImmediate = setImmediate;\n    attachTo.clearImmediate = clearImmediate;\n}(typeof self === \"undefined\" ? typeof global === \"undefined\" ? this : global : self));\n","import { useQueryParams } from 'app/core/hooks/useQueryParams';\nimport store from 'app/core/store';\nimport { useCallback } from 'react';\nimport { ALERTMANAGER_NAME_LOCAL_STORAGE_KEY, ALERTMANAGER_NAME_QUERY_KEY } from '../utils/constants';\nimport { getAlertManagerDataSources, GRAFANA_RULES_SOURCE_NAME } from '../utils/datasource';\n\nfunction isAlertManagerSource(alertManagerSourceName: string): boolean {\n  return (\n    alertManagerSourceName === GRAFANA_RULES_SOURCE_NAME ||\n    !!getAlertManagerDataSources().find((ds) => ds.name === alertManagerSourceName)\n  );\n}\n\n/* this will return am name either from query params or from local storage or a default (grafana).\n *\n * fallbackUrl - if provided, will redirect to this url if alertmanager provided in query no longer\n */\nexport function useAlertManagerSourceName(): [string | undefined, (alertManagerSourceName: string) => void] {\n  const [queryParams, updateQueryParams] = useQueryParams();\n\n  const update = useCallback(\n    (alertManagerSourceName: string) => {\n      if (!isAlertManagerSource(alertManagerSourceName)) {\n        return;\n      }\n      if (alertManagerSourceName === GRAFANA_RULES_SOURCE_NAME) {\n        store.delete(ALERTMANAGER_NAME_LOCAL_STORAGE_KEY);\n        updateQueryParams({ [ALERTMANAGER_NAME_QUERY_KEY]: null });\n      } else {\n        store.set(ALERTMANAGER_NAME_LOCAL_STORAGE_KEY, alertManagerSourceName);\n        updateQueryParams({ [ALERTMANAGER_NAME_QUERY_KEY]: alertManagerSourceName });\n      }\n    },\n    [updateQueryParams]\n  );\n\n  const querySource = queryParams[ALERTMANAGER_NAME_QUERY_KEY];\n\n  if (querySource && typeof querySource === 'string') {\n    if (isAlertManagerSource(querySource)) {\n      return [querySource, update];\n    } else {\n      // non existing alertmanager\n      return [undefined, update];\n    }\n  }\n  const storeSource = store.get(ALERTMANAGER_NAME_LOCAL_STORAGE_KEY);\n  if (storeSource && typeof storeSource === 'string' && isAlertManagerSource(storeSource)) {\n    update(storeSource);\n    return [storeSource, update];\n  }\n\n  return [GRAFANA_RULES_SOURCE_NAME, update];\n}\n","import React, { FC } from 'react';\nimport { css, cx } from '@emotion/css';\nimport { GrafanaTheme2 } from '@grafana/data';\nimport { useStyles2 } from '@grafana/ui';\n\ninterface Props {\n  label: React.ReactNode;\n  className?: string;\n  horizontal?: boolean;\n}\n\nexport const DetailsField: FC<Props> = ({ className, label, horizontal, children }) => {\n  const styles = useStyles2(getStyles);\n\n  return (\n    <div className={cx(className, styles.field, horizontal ? styles.fieldHorizontal : styles.fieldVertical)}>\n      <div>{label}</div>\n      <div>{children}</div>\n    </div>\n  );\n};\n\nconst getStyles = (theme: GrafanaTheme2) => ({\n  fieldHorizontal: css`\n    flex-direction: row;\n    ${theme.breakpoints.down('md')} {\n      flex-direction: column;\n    }\n  `,\n  fieldVertical: css`\n    flex-direction: column;\n  `,\n  field: css`\n    display: flex;\n    margin: ${theme.spacing(2)} 0;\n\n    & > div:first-child {\n      width: 110px;\n      padding-right: ${theme.spacing(1)};\n      font-size: ${theme.typography.size.sm};\n      font-weight: ${theme.typography.fontWeightBold};\n      line-height: 1.8;\n    }\n    & > div:nth-child(2) {\n      flex: 1;\n      color: ${theme.colors.text.secondary};\n    }\n  `,\n});\n","import { SelectableValue, GrafanaTheme2 } from '@grafana/data';\nimport { DataSourceType, GRAFANA_RULES_SOURCE_NAME } from '../utils/datasource';\nimport React, { FC, useMemo } from 'react';\nimport { Field, Select, useStyles2 } from '@grafana/ui';\nimport { getAllDataSources } from '../utils/config';\nimport { css } from '@emotion/css';\n\ninterface Props {\n  onChange: (alertManagerSourceName: string) => void;\n  current?: string;\n  disabled?: boolean;\n}\n\nexport const AlertManagerPicker: FC<Props> = ({ onChange, current, disabled = false }) => {\n  const styles = useStyles2(getStyles);\n\n  const options: Array<SelectableValue<string>> = useMemo(() => {\n    return [\n      {\n        label: 'Grafana',\n        value: GRAFANA_RULES_SOURCE_NAME,\n        imgUrl: 'public/img/grafana_icon.svg',\n        meta: {},\n      },\n      ...getAllDataSources()\n        .filter((ds) => ds.type === DataSourceType.Alertmanager)\n        .map((ds) => ({\n          label: ds.name.substr(0, 37),\n          value: ds.name,\n          imgUrl: ds.meta.info.logos.small,\n          meta: ds.meta,\n        })),\n    ];\n  }, []);\n\n  // no need to show the picker if there's only one option\n  if (options.length === 1) {\n    return null;\n  }\n\n  return (\n    <Field\n      className={styles.field}\n      label={disabled ? 'Alertmanager' : 'Choose Alertmanager'}\n      disabled={disabled}\n      data-testid=\"alertmanager-picker\"\n    >\n      <Select\n        menuShouldPortal\n        width={29}\n        className=\"ds-picker select-container\"\n        backspaceRemovesValue={false}\n        onChange={(value) => value.value && onChange(value.value)}\n        options={options}\n        maxMenuHeight={500}\n        noOptionsMessage=\"No datasources found\"\n        value={current}\n        getOptionLabel={(o) => o.label}\n      />\n    </Field>\n  );\n};\n\nconst getStyles = (theme: GrafanaTheme2) => ({\n  field: css`\n    margin-bottom: ${theme.spacing(4)};\n  `,\n});\n","import React, { FC } from 'react';\nimport Page from 'app/core/components/Page/Page';\nimport { getNavModel } from 'app/core/selectors/navModel';\nimport { useSelector } from 'react-redux';\nimport { StoreState } from 'app/types/store';\n\ninterface Props {\n  pageId: string;\n  isLoading?: boolean;\n}\n\nexport const AlertingPageWrapper: FC<Props> = ({ children, pageId, isLoading }) => {\n  const navModel = getNavModel(\n    useSelector((state: StoreState) => state.navIndex),\n    pageId\n  );\n\n  return (\n    <Page navModel={navModel}>\n      <Page.Contents isLoading={isLoading}>{children}</Page.Contents>\n    </Page>\n  );\n};\n","import React, { FC, HTMLAttributes } from 'react';\nimport { css, cx } from '@emotion/css';\nimport { IconSize, useStyles, Icon } from '@grafana/ui';\n\ninterface Props extends HTMLAttributes<HTMLButtonElement> {\n  isCollapsed: boolean;\n  onToggle: (isCollapsed: boolean) => void;\n  size?: IconSize;\n  className?: string;\n  text?: string;\n}\n\nexport const CollapseToggle: FC<Props> = ({ isCollapsed, onToggle, className, text, size = 'xl', ...restOfProps }) => {\n  const styles = useStyles(getStyles);\n\n  return (\n    <button className={cx(styles.expandButton, className)} onClick={() => onToggle(!isCollapsed)} {...restOfProps}>\n      <Icon size={size} name={isCollapsed ? 'angle-right' : 'angle-down'} />\n      {text}\n    </button>\n  );\n};\n\nexport const getStyles = () => ({\n  expandButton: css`\n    background: none;\n    border: none;\n\n    outline: none !important;\n\n    display: inline-flex;\n    align-items: center;\n\n    svg {\n      margin-bottom: 0;\n    }\n  `,\n});\n"],"sourceRoot":""}