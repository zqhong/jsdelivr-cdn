(window.webpackJsonp=window.webpackJsonp||[]).push([[76],{nKVo:function(e,t,a){"use strict";a.r(t);var r=a("LvDl"),n=a("Obii");function s(e,t,a){return t in e?Object.defineProperty(e,t,{value:a,enumerable:!0,configurable:!0,writable:!0}):e[t]=a,e}const i=/^(\d+)(?:\.(\d+))?(?:\.(\d+))?(?:-([0-9A-Za-z\.]+))?/;class o{constructor(e){s(this,"major",void 0),s(this,"minor",void 0),s(this,"patch",void 0),s(this,"meta",void 0),this.major=0,this.minor=0,this.patch=0,this.meta="";const t=i.exec(e);t&&(this.major=Number(t[1]),this.minor=Number(t[2]||0),this.patch=Number(t[3]||0),this.meta=t[4])}isGtOrEq(e){const t=new o(e);for(let e=0;e<this.comparable.length;++e){if(this.comparable[e]>t.comparable[e])return!0;if(this.comparable[e]<t.comparable[e])return!1}return!0}isValid(){return Object(r.isNumber)(this.major)}get comparable(){return[this.major,this.minor,this.patch]}}function m(e,t){return new o(e).isGtOrEq(t)}function c(e,t,a){return t in e?Object.defineProperty(e,t,{value:a,enumerable:!0,configurable:!0,writable:!0}):e[t]=a,e}const l={};function p(e){e.params=e.params||[],e.defaultParams=e.defaultParams||[],l[e.name]=e,e.shortName&&(l[e.shortName]=e)}const u=[{name:"other",type:"value_or_series",optional:!0,multiple:!0}];function d(e,t){return!e.version||m(t,e.version)}p({name:"scaleToSeconds",category:"Transform",params:[{name:"seconds",type:"int"}],defaultParams:[1]}),p({name:"perSecond",category:"Transform",params:[{name:"max value",type:"int",optional:!0}],defaultParams:[]}),p({name:"holtWintersForecast",category:"Calculate"}),p({name:"holtWintersConfidenceBands",category:"Calculate",params:[{name:"delta",type:"int"}],defaultParams:[3]}),p({name:"holtWintersAberration",category:"Calculate",params:[{name:"delta",type:"int"}],defaultParams:[3]}),p({name:"nPercentile",category:"Calculate",params:[{name:"Nth percentile",type:"int"}],defaultParams:[95]}),p({name:"diffSeries",params:u,defaultParams:["#A"],category:"Combine"}),p({name:"stddevSeries",params:u,defaultParams:[""],category:"Combine"}),p({name:"divideSeries",params:u,defaultParams:["#A"],category:"Combine"}),p({name:"multiplySeries",params:u,defaultParams:["#A"],category:"Combine"}),p({name:"asPercent",params:u,defaultParams:["#A"],category:"Combine"}),p({name:"group",params:u,defaultParams:["#A","#B"],category:"Combine"}),p({name:"sumSeries",shortName:"sum",category:"Combine",params:u,defaultParams:[""]}),p({name:"averageSeries",shortName:"avg",category:"Combine",params:u,defaultParams:[""]}),p({name:"rangeOfSeries",category:"Combine"}),p({name:"percentileOfSeries",category:"Combine",params:[{name:"n",type:"int"},{name:"interpolate",type:"boolean",options:["true","false"]}],defaultParams:[95,"false"]}),p({name:"sumSeriesWithWildcards",category:"Combine",params:[{name:"node",type:"int",multiple:!0}],defaultParams:[3]}),p({name:"maxSeries",shortName:"max",category:"Combine"}),p({name:"minSeries",shortName:"min",category:"Combine"}),p({name:"averageSeriesWithWildcards",category:"Combine",params:[{name:"node",type:"int",multiple:!0}],defaultParams:[3]}),p({name:"alias",category:"Alias",params:[{name:"alias",type:"string"}],defaultParams:["alias"]}),p({name:"aliasSub",category:"Alias",params:[{name:"search",type:"string"},{name:"replace",type:"string"}],defaultParams:["","\\1"]}),p({name:"consolidateBy",category:"Special",params:[{name:"function",type:"string",options:["sum","average","min","max"]}],defaultParams:["max"]}),p({name:"cumulative",category:"Special",params:[],defaultParams:[]}),p({name:"groupByNode",category:"Combine",params:[{name:"node",type:"int",options:[0,1,2,3,4,5,6,7,8,9,10,12]},{name:"function",type:"string",options:["sum","avg","maxSeries"]}],defaultParams:[3,"sum"]}),p({name:"aliasByNode",category:"Alias",params:[{name:"node",type:"int",options:[0,1,2,3,4,5,6,7,8,9,10,12],multiple:!0}],defaultParams:[3]}),p({name:"substr",category:"Special",params:[{name:"start",type:"int",options:[-6,-5,-4,-3,-2,-1,0,1,2,3,4,5,6,7,8,9,10,12]},{name:"stop",type:"int",options:[-6,-5,-4,-3,-2,-1,0,1,2,3,4,5,6,7,8,9,10,12]}],defaultParams:[0,0]}),p({name:"sortByName",category:"Sorting",params:[{name:"natural",type:"boolean",options:["true","false"],optional:!0}],defaultParams:["false"]}),p({name:"sortByMaxima",category:"Sorting"}),p({name:"sortByMinima",category:"Sorting"}),p({name:"sortByTotal",category:"Sorting"}),p({name:"aliasByMetric",category:"Alias"}),p({name:"randomWalk",fake:!0,category:"Special",params:[{name:"name",type:"string"}],defaultParams:["randomWalk"]}),p({name:"countSeries",category:"Combine"}),p({name:"constantLine",category:"Special",params:[{name:"value",type:"int"}],defaultParams:[10]}),p({name:"cactiStyle",category:"Special"}),p({name:"keepLastValue",category:"Transform",params:[{name:"n",type:"int"}],defaultParams:[100]}),p({name:"changed",category:"Special",params:[],defaultParams:[]}),p({name:"scale",category:"Transform",params:[{name:"factor",type:"int"}],defaultParams:[1]}),p({name:"offset",category:"Transform",params:[{name:"amount",type:"int"}],defaultParams:[10]}),p({name:"transformNull",category:"Transform",params:[{name:"amount",type:"int"}],defaultParams:[0]}),p({name:"integral",category:"Transform"}),p({name:"derivative",category:"Transform"}),p({name:"nonNegativeDerivative",category:"Transform",params:[{name:"max value or 0",type:"int",optional:!0}],defaultParams:[""]}),p({name:"timeShift",category:"Transform",params:[{name:"amount",type:"select",options:["1h","6h","12h","1d","2d","7d","14d","30d"]}],defaultParams:["1d"]}),p({name:"timeStack",category:"Transform",params:[{name:"timeShiftUnit",type:"select",options:["1h","6h","12h","1d","2d","7d","14d","30d"]},{name:"timeShiftStart",type:"int"},{name:"timeShiftEnd",type:"int"}],defaultParams:["1d",0,7]}),p({name:"summarize",category:"Transform",params:[{name:"interval",type:"string"},{name:"func",type:"select",options:["sum","avg","min","max","last"]},{name:"alignToFrom",type:"boolean",optional:!0,options:["false","true"]}],defaultParams:["1h","sum","false"]}),p({name:"smartSummarize",category:"Transform",params:[{name:"interval",type:"string"},{name:"func",type:"select",options:["sum","avg","min","max","last"]}],defaultParams:["1h","sum"]}),p({name:"absolute",category:"Transform"}),p({name:"hitcount",category:"Transform",params:[{name:"interval",type:"string"}],defaultParams:["10s"]}),p({name:"log",category:"Transform",params:[{name:"base",type:"int"}],defaultParams:["10"]}),p({name:"averageAbove",category:"Filter Series",params:[{name:"n",type:"int"}],defaultParams:[25]}),p({name:"averageBelow",category:"Filter Series",params:[{name:"n",type:"int"}],defaultParams:[25]}),p({name:"currentAbove",category:"Filter Series",params:[{name:"n",type:"int"}],defaultParams:[25]}),p({name:"currentBelow",category:"Filter Series",params:[{name:"n",type:"int"}],defaultParams:[25]}),p({name:"maximumAbove",category:"Filter Series",params:[{name:"value",type:"int"}],defaultParams:[0]}),p({name:"maximumBelow",category:"Filter Series",params:[{name:"value",type:"int"}],defaultParams:[0]}),p({name:"minimumAbove",category:"Filter Series",params:[{name:"value",type:"int"}],defaultParams:[0]}),p({name:"minimumBelow",category:"Filter Series",params:[{name:"value",type:"int"}],defaultParams:[0]}),p({name:"limit",category:"Filter Series",params:[{name:"n",type:"int"}],defaultParams:[5]}),p({name:"mostDeviant",category:"Filter Series",params:[{name:"n",type:"int"}],defaultParams:[10]}),p({name:"exclude",category:"Filter Series",params:[{name:"exclude",type:"string"}],defaultParams:["exclude"]}),p({name:"highestCurrent",category:"Filter Series",params:[{name:"count",type:"int"}],defaultParams:[5]}),p({name:"highestMax",category:"Filter Series",params:[{name:"count",type:"int"}],defaultParams:[5]}),p({name:"lowestCurrent",category:"Filter Series",params:[{name:"count",type:"int"}],defaultParams:[5]}),p({name:"movingAverage",category:"Calculate",params:[{name:"windowSize",type:"int_or_interval",options:["5","7","10","5min","10min","30min","1hour"]}],defaultParams:[10]}),p({name:"movingMedian",category:"Calculate",params:[{name:"windowSize",type:"int_or_interval",options:["5","7","10","5min","10min","30min","1hour"]}],defaultParams:["5"]}),p({name:"stdev",category:"Calculate",params:[{name:"n",type:"int"},{name:"tolerance",type:"int"}],defaultParams:[5,.1]}),p({name:"highestAverage",category:"Filter Series",params:[{name:"count",type:"int"}],defaultParams:[5]}),p({name:"lowestAverage",category:"Filter Series",params:[{name:"count",type:"int"}],defaultParams:[5]}),p({name:"removeAbovePercentile",category:"Filter Data",params:[{name:"n",type:"int"}],defaultParams:[5]}),p({name:"removeAboveValue",category:"Filter Data",params:[{name:"n",type:"int"}],defaultParams:[5]}),p({name:"removeBelowPercentile",category:"Filter Data",params:[{name:"n",type:"int"}],defaultParams:[5]}),p({name:"removeBelowValue",category:"Filter Data",params:[{name:"n",type:"int"}],defaultParams:[5]}),p({name:"useSeriesAbove",category:"Filter Series",params:[{name:"value",type:"int"},{name:"search",type:"string"},{name:"replace",type:"string"}],defaultParams:[0,"search","replace"]}),p({name:"aggregateLine",category:"Calculate",params:[{name:"func",type:"select",options:["sum","avg","min","max","last"]}],defaultParams:["avg"],version:"1.0"}),p({name:"averageOutsidePercentile",category:"Filter Series",params:[{name:"n",type:"int"}],defaultParams:[95],version:"1.0"}),p({name:"delay",category:"Transform",params:[{name:"steps",type:"int"}],defaultParams:[1],version:"1.0"}),p({name:"exponentialMovingAverage",category:"Calculate",params:[{name:"windowSize",type:"int_or_interval",options:["5","7","10","5min","10min","30min","1hour"]}],defaultParams:[10],version:"1.0"}),p({name:"fallbackSeries",category:"Special",params:[{name:"fallback",type:"string"}],defaultParams:["constantLine(0)"],version:"1.0"}),p({name:"grep",category:"Filter Series",params:[{name:"grep",type:"string"}],defaultParams:["grep"],version:"1.0"}),p({name:"groupByNodes",category:"Combine",params:[{name:"function",type:"string",options:["sum","avg","maxSeries"]},{name:"node",type:"int",options:[0,1,2,3,4,5,6,7,8,9,10,12],multiple:!0}],defaultParams:["sum",3],version:"1.0"}),p({name:"integralByInterval",category:"Transform",params:[{name:"intervalUnit",type:"select",options:["1h","6h","12h","1d","2d","7d","14d","30d"]}],defaultParams:["1d"],version:"1.0"}),p({name:"interpolate",category:"Transform",params:[{name:"limit",type:"int",optional:!0}],defaultParams:[],version:"1.0"}),p({name:"invert",category:"Transform",version:"1.0"}),p({name:"isNonNull",category:"Combine",version:"1.0"}),p({name:"linearRegression",category:"Calculate",params:[{name:"startSourceAt",type:"select",options:["-1h","-6h","-12h","-1d","-2d","-7d","-14d","-30d"],optional:!0},{name:"endSourceAt",type:"select",options:["-1h","-6h","-12h","-1d","-2d","-7d","-14d","-30d"],optional:!0}],defaultParams:[],version:"1.0"}),p({name:"mapSeries",shortName:"map",params:[{name:"node",type:"int"}],defaultParams:[3],category:"Combine",version:"1.0"}),p({name:"movingMin",category:"Calculate",params:[{name:"windowSize",type:"int_or_interval",options:["5","7","10","5min","10min","30min","1hour"]}],defaultParams:[10],version:"1.0"}),p({name:"movingMax",category:"Calculate",params:[{name:"windowSize",type:"int_or_interval",options:["5","7","10","5min","10min","30min","1hour"]}],defaultParams:[10],version:"1.0"}),p({name:"movingSum",category:"Calculate",params:[{name:"windowSize",type:"int_or_interval",options:["5","7","10","5min","10min","30min","1hour"]}],defaultParams:[10],version:"1.0"}),p({name:"multiplySeriesWithWildcards",category:"Combine",params:[{name:"position",type:"int",options:[0,1,2,3,4,5,6,7,8,9,10,12],multiple:!0}],defaultParams:[2],version:"1.0"}),p({name:"offsetToZero",category:"Transform",version:"1.0"}),p({name:"pow",category:"Transform",params:[{name:"factor",type:"int"}],defaultParams:[10],version:"1.0"}),p({name:"powSeries",category:"Transform",params:u,defaultParams:[""],version:"1.0"}),p({name:"reduceSeries",shortName:"reduce",params:[{name:"function",type:"string",options:["asPercent","diffSeries","divideSeries"]},{name:"reduceNode",type:"int",options:[0,1,2,3,4,5,6,7,8,9,10,11,12,13]},{name:"reduceMatchers",type:"string",multiple:!0}],defaultParams:["asPercent",2,"used_bytes"],category:"Combine",version:"1.0"}),p({name:"removeBetweenPercentile",category:"Filter Series",params:[{name:"n",type:"int"}],defaultParams:[95],version:"1.0"}),p({name:"removeEmptySeries",category:"Filter Series",version:"1.0"}),p({name:"squareRoot",category:"Transform",version:"1.0"}),p({name:"timeSlice",category:"Transform",params:[{name:"startSliceAt",type:"select",options:["-1h","-6h","-12h","-1d","-2d","-7d","-14d","-30d"]},{name:"endSliceAt",type:"select",options:["-1h","-6h","-12h","-1d","-2d","-7d","-14d","-30d"],optional:!0}],defaultParams:["-1h"],version:"1.0"}),p({name:"weightedAverage",category:"Combine",params:[{name:"other",type:"value_or_series",optional:!0},{name:"node",type:"int",options:[0,1,2,3,4,5,6,7,8,9,10,12]}],defaultParams:["#A",4],version:"1.0"}),p({name:"seriesByTag",category:"Special",params:[{name:"tagExpression",type:"string",multiple:!0}],version:"1.1"}),p({name:"groupByTags",category:"Combine",params:[{name:"function",type:"string",options:["sum","avg","maxSeries"]},{name:"tag",type:"string",multiple:!0}],defaultParams:["sum","tag"],version:"1.1"}),p({name:"aliasByTags",category:"Alias",params:[{name:"tag",type:"string",multiple:!0}],defaultParams:["tag"],version:"1.1"});class g{constructor(e,t){c(this,"def",void 0),c(this,"params",void 0),c(this,"text",void 0),c(this,"hidden",void 0),this.def=e,this.params=[],t&&t.withDefaultParams&&e.defaultParams&&(this.params=e.defaultParams.slice(0)),this.updateText()}render(e,t){const a=this.def.name+"(",n=Object(r.map)(this.params,(e,a)=>{let n;if(a<this.def.params.length?n=this.def.params[a].type:Object(r.get)(Object(r.last)(this.def.params),"multiple")&&(n=Object(r.get)(Object(r.last)(this.def.params),"type")),Object(r.includes)(["value_or_series","boolean","int","float","node","int_or_infinity"],n))return e;const s=Object(r.isString)(e)?t(e):e;return Object(r.includes)(["int_or_interval","node_or_tag"],n)&&Object(r.isFinite)(+s)?Object(r.toString)(e):"'"+e+"'"});for(;""===n[n.length-1];)n.pop();return e&&n.unshift(e),a+n.join(", ")+")"}_hasMultipleParamsInString(e,t){return-1!==e.indexOf(",")&&(!(!this.def.params[t+1]||!this.def.params[t+1].optional)||!!(t+1>=this.def.params.length&&Object(r.get)(Object(r.last)(this.def.params),"multiple")))}updateParam(e,t){this._hasMultipleParamsInString(e,t)?Object(r.each)(e.split(","),(e,a)=>{this.updateParam(e.trim(),t+a)}):(""===e&&(t>=this.def.params.length||this.def.params[t].optional)?this.params.splice(t,1):this.params[t]=e,this.updateText())}updateText(){if(0===this.params.length)return void(this.text=this.def.name+"()");let e=this.def.name+"(";e+=this.params.join(", "),e+=")",this.text=e}}function h(e,t){return(t||l)[e]?(t||l)[e]:{name:e,params:[{name:"",type:"",multiple:!0}],defaultParams:[""],unknown:!0}}var f={createFuncInstance:function(e,t,a){return Object(r.isString)(e)&&(e=h(e,a)),new g(e,t)},getFuncDef:h,getFuncDefs:function(e,t){const a={};return Object(r.forEach)(t||l,t=>{d(t,e)&&(a[t.name]=Object(r.assign)({},t,{params:Object(r.filter)(t.params,t=>d(t,e))}))}),a},parseFuncDefs:function(e){const t={};return Object(r.forEach)(e||{},(e,a)=>{if("Graph"===e.group)return;let n=e.description;n&&(n=n.replace(/:py:func:`(.+)( <[^>]*>)?`/g,"``$1``").replace(/.. seealso:: /g,"See also: ").replace(/.. code-block *:: *none/g,".. code-block::"));const s={name:e.name,description:n,category:e.group,params:[],defaultParams:[],fake:!1};/^seriesLists?$/.test(Object(r.get)(e,"params[0].type",""))?e.params[0].multiple?e.params[0].required=!1:e.params.shift():s.fake=!0,Object(r.forEach)(e.params,e=>{const t={name:e.name,type:"string",optional:!e.required,multiple:!!e.multiple,options:void 0};void 0!==e.default?e.default===1/0?s.defaultParams.push("inf"):s.defaultParams.push(Object(r.toString)(e.default)):e.suggestions?s.defaultParams.push(Object(r.toString)(e.suggestions[0])):s.defaultParams.push(""),"boolean"===e.type?(t.type="boolean",t.options=["true","false"]):"integer"===e.type?t.type="int":"float"===e.type?t.type="float":"node"===e.type?(t.type="node",t.options=["0","1","2","3","4","5","6","7","8","9","10","11","12"]):"nodeOrTag"===e.type?(t.type="node_or_tag",t.options=["name","0","1","2","3","4","5","6","7","8","9","10","11","12"]):"intOrInterval"===e.type?t.type="int_or_interval":"seriesList"===e.type?t.type="value_or_series":"intOrInf"===e.type&&(t.type="int_or_infinity"),e.options?t.options=Object(r.map)(e.options,r.toString):e.suggestions&&(t.options=Object(r.map)(e.suggestions,r.toString)),s.params.push(t)}),t[a]=s}),t}},y=a("t8hP"),b=a("5kRJ");let v;function j(e){if(e)return parseInt(e,10)}function O(e){if(e)return"true"===e||"false"!==e&&parseInt(e,10)}function x(e){for(const a of e){const e=a["archive-read"];if(e>0){var t;return{text:`Data is rolled up, aggregated over ${w(a["schema-retentions"])[e].interval} using ${(null!==(t=a["consolidator-normfetch"])&&void 0!==t?t:"").replace("Consolidator","")} function`,severity:"info",inspect:"meta"}}}return null}function S(e){for(const a of e){const e=a["aggnum-rc"];if(e>0){var t;return{text:`Data is runtime consolidated, ${e} datapoints combined using ${(null!==(t=a["consolidator-rc"])&&void 0!==t?t:"").replace("Consolidator","")} function`,severity:"info",inspect:"meta"}}}return null}function w(e){return e?e.split(",").map(e=>{const t=e.split(":");return{interval:t[0],retention:t[1],chunkspan:t[2],numchunks:j(t[3]),ready:O(t[4])}}):[]}!function(e){e.Default="default",e.Metrictank="metrictank"}(v||(v={}));var P=a("+JjO"),T=a("F/XL"),C=a("XlPw"),D=a("y3By"),M=a("67Y/"),q=a("9Z1F");const F=["0.9","1.0","1.1"],I=Object(r.last)(F);function k(){return(k=Object.assign||function(e){for(var t=1;t<arguments.length;t++){var a=arguments[t];for(var r in a)Object.prototype.hasOwnProperty.call(a,r)&&(e[r]=a[r])}return e}).apply(this,arguments)}function N(e,t,a){return t in e?Object.defineProperty(e,t,{value:a,enumerable:!0,configurable:!0,writable:!0}):e[t]=a,e}class A extends n.DataSourceApi{constructor(e,t=Object(b.a)()){var a,s;super(e),N(this,"basicAuth",void 0),N(this,"url",void 0),N(this,"name",void 0),N(this,"graphiteVersion",void 0),N(this,"supportsTags",void 0),N(this,"isMetricTank",void 0),N(this,"rollupIndicatorEnabled",void 0),N(this,"cacheTimeout",void 0),N(this,"withCredentials",void 0),N(this,"funcDefs",null),N(this,"funcDefsPromise",null),N(this,"_seriesRefLetters",void 0),N(this,"metricMappings",void 0),N(this,"convertResponseToDataFrames",e=>{const t=[];if(!e||!e.data)return{data:t};const a=e.data.series||e.data;if(!Object(r.isArray)(a))throw{message:"Missing series in result",data:e};for(let r=0;r<a.length;r++){const s=a[r];s.title=s.target;for(let e=0;e<s.datapoints.length;e++)s.datapoints[e][1]*=1e3;const i=Object(n.toDataFrame)(s);if(s.meta){if(i.meta={custom:{requestMetaList:e.data.meta,seriesMetaList:s.meta}},this.rollupIndicatorEnabled){const e=x(s.meta),t=S(s.meta);e?i.meta.notices=[e]:t&&(i.meta.notices=[t])}0===r&&e.data.meta.stats&&(i.meta.stats=this.getRequestStats(e.data.meta))}t.push(i)}return{data:t}}),this.templateSrv=t,this.basicAuth=e.basicAuth,this.url=e.url,this.name=e.name,this.graphiteVersion=e.jsonData.graphiteVersion||I,this.metricMappings=(null===(a=e.jsonData.importConfiguration)||void 0===a||null===(s=a.loki)||void 0===s?void 0:s.mappings)||[],this.isMetricTank=e.jsonData.graphiteType===v.Metrictank,this.supportsTags=m(this.graphiteVersion,"1.1"),this.cacheTimeout=e.cacheTimeout,this.rollupIndicatorEnabled=e.jsonData.rollupIndicatorEnabled,this.withCredentials=e.withCredentials,this.funcDefs=null,this.funcDefsPromise=null,this._seriesRefLetters="ABCDEFGHIJKLMNOPQRSTUVWXYZ"}getQueryOptionsInfo(){return{maxDataPoints:!0,cacheTimeout:!0,links:[{text:"Help",url:"http://docs.grafana.org/features/datasources/graphite/#using-graphite-in-grafana"}]}}getImportQueryConfiguration(){return{loki:{mappings:this.metricMappings}}}query(e){const t={from:this.translateTime(e.range.raw.from,!1,e.timezone),until:this.translateTime(e.range.raw.to,!0,e.timezone),targets:e.targets,format:e.format,cacheTimeout:e.cacheTimeout||this.cacheTimeout,maxDataPoints:e.maxDataPoints},a=this.buildGraphiteParams(t,e.scopedVars);if(0===a.length)return Object(T.a)({data:[]});this.isMetricTank&&a.push("meta=true");const r={method:"POST",url:"/render",data:a.join("&"),headers:{"Content-Type":"application/x-www-form-urlencoded"}};return this.addTracingHeaders(r,e),e.panelId&&(r.requestId=this.name+".panelId."+e.panelId),this.doGraphiteRequest(r).pipe(Object(M.a)(this.convertResponseToDataFrames))}addTracingHeaders(e,t){!this.url.match(/^http/)&&(t.dashboardId&&(e.headers["X-Dashboard-Id"]=t.dashboardId),t.panelId&&(e.headers["X-Panel-Id"]=t.panelId))}getRequestStats(e){const t=[];for(const a in e.stats){let r=void 0;a.endsWith(".ms")&&(r="ms"),t.push({displayName:a,value:e.stats[a],unit:r})}return t}parseTags(e){let t=[];return t=e.split(","),1===t.length&&(t=e.split(" "),""===t[0]&&(t=[])),t}interpolateVariablesInQueries(e,t){let a=e;return e&&e.length>0&&(a=e.map(e=>{var a;return k({},e,{datasource:this.name,target:this.templateSrv.replace(null!==(a=e.target)&&void 0!==a?a:"",t)})})),a}annotationQuery(e){if(e.annotation.target){const t=this.templateSrv.replace(e.annotation.target,{},"glob"),a={range:e.range,targets:[{target:t}],format:"json",maxDataPoints:100};return this.query(a).pipe(Object(M.a)(t=>{const a=[];for(let r=0;r<t.data.length;r++){const n=t.data[r];for(let t=0;t<n.length;t++){const r=n.fields[0].values.get(t);n.fields[1].values.get(t)&&a.push({annotation:e.annotation,time:r,title:n.name})}}return a})).toPromise()}{const t=this.templateSrv.replace(e.annotation.tags);return this.events({range:e.range,tags:t}).then(t=>{const a=[];if(!Object(r.isArray)(t.data))return console.error(`Unable to get annotations from ${t.url}.`),[];for(let n=0;n<t.data.length;n++){const s=t.data[n];let i=s.tags;Object(r.isString)(s.tags)&&(i=this.parseTags(s.tags)),a.push({annotation:e.annotation,time:1e3*s.when,title:s.what,tags:i,text:s.data})}return a})}}events(e){try{let t="";return e.tags&&(t="&tags="+e.tags),this.doGraphiteRequest({method:"GET",url:"/events/get_data?from="+this.translateTime(e.range.raw.from,!1,e.timezone)+"&until="+this.translateTime(e.range.raw.to,!0,e.timezone)+t}).toPromise()}catch(e){return Promise.reject(e)}}targetContainsTemplate(e){var t;return this.templateSrv.variableExists(null!==(t=e.target)&&void 0!==t?t:"")}translateTime(e,t,a){if(Object(r.isString)(e)){if("now"===e)return"now";if(e.indexOf("now-")>=0&&-1===e.indexOf("/"))return e=(e=(e=e.substring(3)).replace("m","min")).replace("M","mon");e=n.dateMath.parse(e,t,a)}return t?e.get("s")&&e.add(1,"s"):!1===t&&e.get("s")&&e.subtract(1,"s"),e.unix()}metricFindQuery(e,t){const a=t||{};let r=this.templateSrv.replace(e,Object(P.g)({query:e,wildcardChar:"",options:t})),n=r.match(/^tag_values\((.*)\)$/),s=n?n[1].split(",").filter(e=>!!e):void 0;if(s)return a.limit=1e4,this.getTagValuesAutoComplete(s.slice(1),s[0],void 0,a);if(n=r.match(/^tags\((.*)\)$/),s=n?n[1].split(",").filter(e=>!!e):void 0,s)return a.limit=1e4,this.getTagsAutoComplete(s,void 0,a);let i,o=e.match(/^expand\((.*)\)$/);return e=o?o[1]:e,r=this.templateSrv.replace(e,Object(P.g)({query:e,wildcardChar:"*",options:t})),a.range&&(i={from:this.translateTime(a.range.from,!1,a.timezone),until:this.translateTime(a.range.to,!0,a.timezone)}),o?this.requestMetricExpand(r,a.requestId,i):this.requestMetricFind(r,a.requestId,i)}requestMetricFind(e,t,a){const n={method:"POST",url:"/metrics/find",params:{},data:"query="+e,headers:{"Content-Type":"application/x-www-form-urlencoded"},requestId:t};return a&&(n.params.from=a.from,n.params.until=a.until),this.doGraphiteRequest(n).pipe(Object(M.a)(e=>Object(r.map)(e.data,e=>({text:e.text,expandable:!!e.expandable})))).toPromise()}requestMetricExpand(e,t,a){const n={method:"GET",url:"/metrics/expand",params:{query:e},headers:{"Content-Type":"application/x-www-form-urlencoded"},requestId:t};return a&&(n.params.from=a.from,n.params.until=a.until),this.doGraphiteRequest(n).pipe(Object(M.a)(e=>Object(r.map)(e.data.results,e=>({text:e,expandable:!1})))).toPromise()}getTags(e){const t=e||{},a={method:"GET",url:"/tags",requestId:t.requestId};return t.range&&(a.params.from=this.translateTime(t.range.from,!1,t.timezone),a.params.until=this.translateTime(t.range.to,!0,t.timezone)),this.doGraphiteRequest(a).pipe(Object(M.a)(e=>Object(r.map)(e.data,e=>({text:e.tag,id:e.id})))).toPromise()}getTagValues(e={}){const t={method:"GET",url:"/tags/"+this.templateSrv.replace(e.key),requestId:e.requestId};return e.range&&(t.params.from=this.translateTime(e.range.from,!1,e.timezone),t.params.until=this.translateTime(e.range.to,!0,e.timezone)),this.doGraphiteRequest(t).pipe(Object(M.a)(e=>e.data&&e.data.values?Object(r.map)(e.data.values,e=>({text:e.value,id:e.id})):[])).toPromise()}getTagsAutoComplete(e,t,a){const n=a||{},s={method:"GET",url:"/tags/autoComplete/tags",params:{expr:Object(r.map)(e,e=>this.templateSrv.replace((e||"").trim()))},requestId:n.requestId};return t&&(s.params.tagPrefix=t),n.limit&&(s.params.limit=n.limit),n.range&&(s.params.from=this.translateTime(n.range.from,!1,n.timezone),s.params.until=this.translateTime(n.range.to,!0,n.timezone)),this.doGraphiteRequest(s).pipe(E()).toPromise()}getTagValuesAutoComplete(e,t,a,n){const s=n||{},i={method:"GET",url:"/tags/autoComplete/values",params:{expr:Object(r.map)(e,e=>this.templateSrv.replace((e||"").trim())),tag:this.templateSrv.replace((t||"").trim())},requestId:s.requestId};return a&&(i.params.valuePrefix=a),s.limit&&(i.params.limit=s.limit),s.range&&(i.params.from=this.translateTime(s.range.from,!1,s.timezone),i.params.until=this.translateTime(s.range.to,!0,s.timezone)),this.doGraphiteRequest(i).pipe(E()).toPromise()}getVersion(e){const t={method:"GET",url:"/version",requestId:(e||{}).requestId};return this.doGraphiteRequest(t).pipe(Object(M.a)(e=>{if(e.data){return new o(e.data).isValid()?e.data:""}return""}),Object(q.a)(()=>Object(T.a)(""))).toPromise()}createFuncInstance(e,t){return f.createFuncInstance(e,t,this.funcDefs)}getFuncDef(e){return f.getFuncDef(e,this.funcDefs)}waitForFuncDefsLoaded(){return this.getFuncDefs()}getFuncDefs(){if(null!==this.funcDefsPromise)return this.funcDefsPromise;if(!m(this.graphiteVersion,"1.1"))return this.funcDefs=f.getFuncDefs(this.graphiteVersion),this.funcDefsPromise=Promise.resolve(this.funcDefs),this.funcDefsPromise;return this.doGraphiteRequest({method:"GET",url:"/functions"}).pipe(Object(M.a)(e=>{if(200!==e.status||"object"!=typeof e.data)if("string"==typeof e.data){const t=JSON.parse(e.data.replace(/"default": ?Infinity/g,'"default": 1e9999'));this.funcDefs=f.parseFuncDefs(t)}else this.funcDefs=f.getFuncDefs(this.graphiteVersion);else this.funcDefs=f.parseFuncDefs(e.data);return this.funcDefs}),Object(q.a)(e=>(console.error("Fetching graphite functions error",e),this.funcDefs=f.getFuncDefs(this.graphiteVersion),Object(T.a)(this.funcDefs)))).toPromise()}testDatasource(){return this.query({panelId:3,rangeRaw:{from:"now-1h",to:"now"},range:{raw:{from:"now-1h",to:"now"}},targets:[{target:"constantLine(100)"}],maxDataPoints:300}).toPromise().then(()=>({status:"success",message:"Data source is working"}))}doGraphiteRequest(e){return(this.basicAuth||this.withCredentials)&&(e.withCredentials=!0),this.basicAuth&&(e.headers=e.headers||{},e.headers.Authorization=this.basicAuth),e.url=this.url+e.url,e.inspect={type:"graphite"},Object(y.getBackendSrv)().fetch(e).pipe(Object(q.a)(e=>Object(C.a)(function(e){var t,a;if(e&&500===e.status&&null!==(t=e.data)&&void 0!==t&&null!==(a=t.message)&&void 0!==a&&a.startsWith("<body")){const t=Object(r.last)(e.data.message.replace(/(<([^>]+)>)/gi,"").trim().split(/\n/)).replace(/u?&#[^;]+;/g,"");e.data.message="Graphite encountered an unexpected error while handling your request. "+t}return e}(e))))}buildGraphiteParams(e,t){const a=["from","until","rawData","format","maxDataPoints","cacheTimeout"],n=[],s={};let i,o,m;const c=/\#([A-Z])/g,l=/'(\d+)m'/gi;let p=!1;function u(e){return e.replace("m","min").replace("M","mon")}for(e.format="json",m=0;m<e.targets.length;m++)i=e.targets[m],i.target&&(i.refId||(i.refId=this._seriesRefLetters[m]),o=this.templateSrv.replace(i.target,t),o=o.replace(l,u),s[i.refId]=o);function d(e,t){return s[t]||e}for(m=0;m<e.targets.length;m++)i=e.targets[m],i.target&&(o=s[i.refId],o=o.replace(c,d),s[i.refId]=o,i.hide||(p=!0,n.push("target="+encodeURIComponent(o))));return Object(r.each)(e,(e,t)=>{-1!==Object(r.indexOf)(a,t)&&e&&n.push(t+"="+encodeURIComponent(e))}),p?n:[]}}function E(){return Object(D.a)(Object(M.a)(e=>e.data?Object(r.map)(e.data,e=>({text:e})):[]))}var $=a("LzXI"),G=a("1A6m"),_=a("iODs"),B=a("vMjj"),R=a("UvM7");const V=["=","!=","=~","!=~"];async function z(e){e.queryModel.parseTarget(),await L(e)}async function L(e,t=!0){e.segments=Object(r.map)(e.queryModel.segments,t=>e.uiSegmentSrv.newSegment(t));const a=e.queryModel.checkOtherSegmentsIndex||0;await W(e,a,t),e.queryModel.seriesByTagUsed&&J(e)}function H(e){e.queryModel.addSelectMetricSegment(),e.segments.push(e.uiSegmentSrv.newSelectMetric())}async function W(e,t,a=!0){if(1===e.queryModel.segments.length&&"series-ref"===e.queryModel.segments[0].type)return;if(0===t)return void H(e);const r=e.queryModel.getSegmentPathUpTo(t+1);if(""!==r)try{const n=await e.datasource.metricFindQuery(r);0===n.length?""!==r&&a&&(e.queryModel.segments=e.queryModel.segments.splice(0,t),e.segments=e.segments.splice(0,t),H(e)):n[0].expandable&&(e.segments.length===t?H(e):await W(e,t+1))}catch(t){Z(e,t)}}function U(e,t){Object(r.each)(e.segments,(e,a)=>{e.focus=t===a})}function Q(e){e.queryModel.segments=[],e.segments=[]}function J(e){e.addTagSegments=[e.uiSegmentSrv.newPlusButton()]}function X(e){if(e.queryModel.error)return;const t=e.queryModel.target.target;e.queryModel.updateModelTarget(e.panelCtrl.panel.targets),e.queryModel.target.target===t||e.paused||e.panelCtrl.refresh()}function Z(e,t){return console.error(t),e.metricAutoCompleteErrorShown||(e.metricAutoCompleteErrorShown=!0,Object(_.a)(Object(B.c)(Object(R.a)(`Fetching metrics failed: ${t.message}.`)))),e}function K(e,t){return console.error(t),e.tagsAutoCompleteErrorShown||(e.tagsAutoCompleteErrorShown=!0,Object(_.a)(Object(B.c)(Object(R.a)(`Fetching tags failed: ${t.message}.`)))),e}async function Y(e,t,a){let n=a.length>0?"*"+a+"*":"*";t>0&&(n=e.queryModel.getSegmentPathUpTo(t)+"."+n);const s={range:e.panelCtrl.range,requestId:"get-alt-segments"};try{const i=await e.datasource.metricFindQuery(n,s),o=Object(r.map)(i,t=>e.uiSegmentSrv.newSegment({value:t.text,expandable:t.expandable}));return t>0&&0===o.length?o:(0===t&&Object(r.eachRight)(e.panelCtrl.panel.targets,t=>{t.refId!==e.queryModel.target.refId&&o.unshift(e.uiSegmentSrv.newSegment({type:"series-ref",value:"#"+t.refId,expandable:!1}))}),Object(r.eachRight)(e.templateSrv.getVariables(),t=>{o.unshift(e.uiSegmentSrv.newSegment({type:"template",value:"$"+t.name,expandable:!0}))}),o.unshift(e.uiSegmentSrv.newSegment("*")),e.supportsTags&&0===t?(function(e){Object(r.remove)(e,e=>"_tagged"===e.value)}(o),await async function(e,t,a){let n=await ee(e,t);return n=Object(r.map)(n,e=>(e.value="tag: "+e.value,e)),a.concat(...n)}(e,a,o)):o)}catch(t){Z(e,t)}return[]}async function ee(e,t){let a=[];try{const n=e.queryModel.renderTagExpressions(),s=await e.datasource.getTagsAutoComplete(n,t);a=Object(r.map)(s,t=>e.uiSegmentSrv.newSegment({value:t.text,type:"tag",expandable:!1}))}catch(t){a=[],K(e,t)}return a}function te(e){return Object(r.map)(e,e=>({text:e,value:e}))}var ae=a("Mug+");function re(){return(re=Object.assign||function(e){for(var t=1;t<arguments.length;t++){var a=arguments[t];for(var r in a)Object.prototype.hasOwnProperty.call(a,r)&&(e[r]=a[r])}return e}).apply(this,arguments)}const ne=async(e,t)=>{if(t=re({},t),G.a.init.match(e)){const a=e.payload;a.target.target=a.target.target||"",await a.datasource.waitForFuncDefsLoaded(),t=re({},t,a,{queryModel:new ae.a(a.datasource,a.target,Object(y.getTemplateSrv)()),supportsTags:a.datasource.supportsTags,paused:!1,removeTagValue:"-- remove tag --",funcDefs:a.datasource.funcDefs}),await L(t,!1)}if(G.a.segmentValueChanged.match(e)){const{segment:a,index:r}=e.payload;if(t.error=null,t.queryModel.updateSegmentValue(a,r),t.queryModel.functions.length>0&&t.queryModel.functions[0].def.fake&&(t.queryModel.functions=[]),"tag"===a.type){const e=a.value.replace("tag: ","");return function(e){e.paused=!0}(t),await async function(e,t){const a=e.datasource.createFuncInstance("seriesByTag",{withDefaultParams:!1}),r=t+"=";a.params=[r],e.queryModel.addFunction(a),a.added=!0,Q(e),X(e),await z(e)}(t,e),t}a.expandable?(await W(t,r+1),U(t,r+1),X(t)):function(e,t){e.segments=e.segments.splice(0,t),e.queryModel.segments=e.queryModel.segments.splice(0,t)}(t,r+1),U(t,r+1),X(t)}if(G.a.tagChanged.match(e)){const{tag:a,index:r}=e.payload;t.queryModel.updateTag(a,r),X(t)}if(G.a.addNewTag.match(e)){const a={key:e.payload.segment.value,operator:"=",value:""};t.queryModel.addTag(a),X(t),J(t)}if(G.a.unpause.match(e)&&(t.paused=!1,t.panelCtrl.refresh()),G.a.addFunction.match(e)){const a=t.datasource.createFuncInstance(e.payload.name,{withDefaultParams:!0});a.added=!0,t.queryModel.addFunction(a),function(e,t){if("aliasByNode"===t.def.name)for(let a=0;a<e.segments.length;a++)if(e.segments[a].value.indexOf("*")>=0)return t.params[0]=a,t.added=!1,void X(e)}(t,a),1===t.segments.length&&t.segments[0].fake&&Q(t),!a.params.length&&a.added&&X(t),"seriesByTag"===a.def.name&&await z(t)}if(G.a.removeFunction.match(e)&&(t.queryModel.removeFunction(e.payload.func),X(t)),G.a.moveFunction.match(e)){const{func:a,offset:r}=e.payload;t.queryModel.moveFunction(a,r),X(t)}if(G.a.updateFunctionParam.match(e)){const{func:a,index:r,value:n}=e.payload;a.updateParam(n,r),X(t)}return G.a.updateQuery.match(e)&&(t.target.target=e.payload.query,X(t)),G.a.runQuery.match(e)&&t.panelCtrl.refresh(),G.a.toggleEditorMode.match(e)&&(t.target.textEditor=!t.target.textEditor,await z(t)),re({},t)};function se(e,t,a){return t in e?Object.defineProperty(e,t,{value:a,enumerable:!0,configurable:!0,writable:!0}):e[t]=a,e}class ie extends $.QueryCtrl{constructor(e,t,a,r){super(e,t),se(this,"segments",[]),se(this,"addTagSegments",[]),se(this,"supportsTags",!1),se(this,"paused",!1),se(this,"state",void 0),se(this,"dispatch",void 0),this.uiSegmentSrv=a,this.templateSrv=r;const n={panelCtrl:this.panelCtrl,target:this.target,datasource:this.datasource,uiSegmentSrv:this.uiSegmentSrv,templateSrv:this.templateSrv},[s,i]=(e=>{let t={};return[async a=>{t=await ne(a,t),e(t)},t]})(e=>{this.state=e,this.$scope.$digest()});this.state=i,this.dispatch=s,this.dispatch(G.a.init(n))}parseTarget(){}async toggleEditorMode(){await this.dispatch(G.a.toggleEditorMode())}buildSegments(e=!0){}addSelectMetricSegment(){}checkOtherSegments(e,t=!0){}setSegmentFocus(e){}async getAltSegments(e,t){return await Y(this.state,e,t)}addAltTagSegments(e,t){}removeTaggedEntry(e){}async segmentValueChanged(e,t){await this.dispatch(G.a.segmentValueChanged({segment:e,index:t}))}spliceSegments(e){}emptySegments(){}async targetTextChanged(e){}updateModelTarget(){}async addFunction(e){await this.dispatch(G.a.addFunction({name:e}))}removeFunction(e){}moveFunction(e,t){}addSeriesByTagFunc(e){}smartlyHandleNewAliasByNode(e){}getAllTags(){}async getTags(e,t){return await async function(e,t,a){try{const n=e.queryModel.renderTagExpressions(t),s=await e.datasource.getTagsAutoComplete(n,a),i=Object(r.map)(s,"text");return i.splice(0,0,e.removeTagValue),te(i)}catch(t){K(e,t)}return[]}(this.state,e,t)}async getTagsAsSegments(e){return await ee(this.state,e)}getTagOperators(){return te(V)}getAllTagValues(e){}async getTagValues(e,t,a){return await async function(e,t,a,n){const s=e.queryModel.renderTagExpressions(a),i=t.key,o=await e.datasource.getTagValuesAutoComplete(s,i,n,{}),m=Object(r.map)(o,"text");return Object(r.eachRight)(e.templateSrv.getVariables(),e=>{m.push("${"+e.name+":regex}")}),te(m)}(this.state,e,t,a)}async tagChanged(e,t){await this.dispatch(G.a.tagChanged({tag:e,index:t}))}async addNewTag(e){await this.dispatch(G.a.addNewTag({segment:e}))}removeTag(e){}fixTagSegments(){}showDelimiter(e){}pause(){}async unpause(){await this.dispatch(G.a.unpause())}getCollapsedText(){}handleTagsAutoCompleteError(e){}handleMetricsAutoCompleteError(e){}}ie.$inject=["$scope","$injector","uiSegmentSrv","templateSrv"],se(ie,"templateUrl","partials/query.editor.html");var oe,me,ce,le,pe,ue,de,ge=a("q1tI"),he=a("kDLi"),fe=a("nKUr");function ye(e){return Object(fe.jsxs)(he.Alert,{severity:"info",title:"How to map Graphite metrics to labels?",onRemove:e.onDismiss,children:[oe||(oe=Object(fe.jsx)("p",{children:"Mappings are currently supported only between Graphite and Loki queries."})),me||(me=Object(fe.jsx)("p",{children:"When you switch your data source from Graphite to Loki, your queries are mapped according to the mappings defined in the example below. To define a mapping, write the full path of the metric and replace nodes you want to map to label with the label name in parentheses. The value of the label is extracted from your Graphite query when you switch data sources."})),ce||(ce=Object(fe.jsx)("p",{children:"All tags are automatically mapped to labels regardless of the mapping configuration. Graphite matching patterns (using {}) are converted to Loki's regular expressions matching patterns. When you use functions in your queries, the metrics, and tags are extracted to match them with defined mappings."})),le||(le=Object(fe.jsxs)("p",{children:["Example: for a mapping = ",Object(fe.jsx)("code",{children:"servers.(cluster).(server).*"}),":"]})),pe||(pe=Object(fe.jsxs)("table",{children:[Object(fe.jsx)("thead",{children:Object(fe.jsxs)("tr",{children:[Object(fe.jsx)("th",{children:"Graphite query"}),Object(fe.jsx)("th",{children:"Mapped to Loki query"})]})}),Object(fe.jsxs)("tbody",{children:[Object(fe.jsxs)("tr",{children:[Object(fe.jsx)("td",{children:Object(fe.jsxs)("code",{children:["alias(servers.",Object(fe.jsx)("u",{children:"west"}),".",Object(fe.jsx)("u",{children:"001"}),".cpu,1,2)"]})}),Object(fe.jsx)("td",{children:Object(fe.jsxs)("code",{children:['{cluster="',Object(fe.jsx)("u",{children:"west"}),'", server="',Object(fe.jsx)("u",{children:"001"}),'"}']})})]}),Object(fe.jsxs)("tr",{children:[Object(fe.jsx)("td",{children:Object(fe.jsxs)("code",{children:["alias(servers.*.",Object(fe.jsx)("u",{children:"{001,002}"}),".*,1,2)"]})}),Object(fe.jsx)("td",{children:Object(fe.jsxs)("code",{children:['{server=~"',Object(fe.jsx)("u",{children:"(001|002)"}),'"}']})})]}),Object(fe.jsxs)("tr",{children:[Object(fe.jsx)("td",{children:Object(fe.jsx)("code",{children:"interpolate(seriesByTag('foo=bar', 'server=002'), inf))"})}),Object(fe.jsx)("td",{children:Object(fe.jsx)("code",{children:'{foo="bar", server="002"}'})})]})]})]}))]})}const be=e=>{const[t,a]=Object(ge.useState)(e.mappings||[]);return Object(fe.jsxs)("div",{children:[ue||(ue=Object(fe.jsx)("h3",{className:"page-heading",children:"Label mappings"})),!e.showHelp&&Object(fe.jsx)("p",{children:Object(fe.jsx)(he.Button,{variant:"link",onClick:e.onRestoreHelp,children:"Learn how label mappings work"})}),e.showHelp&&Object(fe.jsx)(ye,{onDismiss:e.onDismiss}),Object(fe.jsxs)("div",{className:"gf-form-group",children:[t.map((r,n)=>Object(fe.jsxs)(he.InlineFieldRow,{children:[Object(fe.jsx)(he.InlineField,{label:`Mapping (${n+1})`,children:Object(fe.jsx)(he.Input,{width:50,onChange:e=>{let r=t.concat();r[n]=e.target.value,a(r)},onBlur:()=>{e.onChange(t)},placeholder:"e.g. test.metric.(labelName).*",value:r})}),Object(fe.jsx)(he.Button,{type:"button","aria-label":"Remove header",variant:"secondary",size:"xs",onClick:r=>{let s=t.concat();s.splice(n,1),a(s),e.onChange(s)},children:de||(de=Object(fe.jsx)(he.Icon,{name:"trash-alt"}))})]},n)),Object(fe.jsx)(he.Button,{variant:"secondary",icon:"plus",type:"button",onClick:()=>{a([...t,""])},children:"Add label mapping"})]})]})};function ve(e){return{matchers:e.split(".").map(e=>e.startsWith("(")&&e.endsWith(")")?{value:"*",labelName:e.slice(1,-1)}:{value:e})}}function je(e){return e.matchers.map(e=>e.labelName?`(${e.labelName})`:""+e.value).join(".")}var Oe,xe,Se,we,Pe=a("SMGL");function Te(){return(Te=Object.assign||function(e){for(var t=1;t<arguments.length;t++){var a=arguments[t];for(var r in a)Object.prototype.hasOwnProperty.call(a,r)&&(e[r]=a[r])}return e}).apply(this,arguments)}const{Select:Ce,Switch:De}=he.LegacyForms,Me="grafana.datasources.graphite.config.showMappingsHelp",qe=F.map(e=>({label:e+".x",value:e})),Fe=Object.entries(v).map(([e,t])=>({label:e,value:t}));class Ie extends ge.PureComponent{constructor(e){var t,a,r;super(e),r=()=>Oe||(Oe=Object(fe.jsxs)("p",{children:["There are different types of Graphite compatible backends. Here you can specify the type you are using. If you are using"," ",Object(fe.jsx)("a",{href:"https://github.com/grafana/metrictank",className:"pointer",target:"_blank",rel:"noreferrer",children:"Metrictank"})," ","then select that here. This will enable Metrictank specific features like query processing meta data. Metrictank is a multi-tenant timeseries engine for Graphite and friends."]})),(a="renderTypeHelp")in(t=this)?Object.defineProperty(t,a,{value:r,enumerable:!0,configurable:!0,writable:!0}):t[a]=r,this.state={showMappingsHelp:Pe.a.getObject(Me,!0)}}componentDidMount(){Object(n.updateDatasourcePluginJsonDataOption)(this.props,"graphiteVersion",this.currentGraphiteVersion)}render(){var e,t;const{options:a,onOptionsChange:r}=this.props,s=qe.find(e=>e.value===this.currentGraphiteVersion);return Object(fe.jsxs)(fe.Fragment,{children:["direct"===a.access&&(xe||(xe=Object(fe.jsx)(he.Alert,{title:"Deprecation Notice",severity:"warning",children:"This data source uses browser access mode. This mode is deprecated and will be removed in the future. Please use server access mode instead."}))),Object(fe.jsx)(he.DataSourceHttpSettings,{defaultUrl:"http://localhost:8080",dataSourceConfig:a,onChange:r}),Se||(Se=Object(fe.jsx)("h3",{className:"page-heading",children:"Graphite details"})),Object(fe.jsxs)("div",{className:"gf-form-group",children:[Object(fe.jsx)("div",{className:"gf-form-inline",children:Object(fe.jsxs)("div",{className:"gf-form",children:[we||(we=Object(fe.jsx)(he.InlineFormLabel,{tooltip:"This option controls what functions are available in the Graphite query editor.",children:"Version"})),Object(fe.jsx)(Ce,{menuShouldPortal:!0,value:s,options:qe,width:8,onChange:Object(n.onUpdateDatasourceJsonDataOptionSelect)(this.props,"graphiteVersion")})]})}),Object(fe.jsx)("div",{className:"gf-form-inline",children:Object(fe.jsxs)("div",{className:"gf-form",children:[Object(fe.jsx)(he.InlineFormLabel,{tooltip:this.renderTypeHelp,children:"Type"}),Object(fe.jsx)(Ce,{menuShouldPortal:!0,options:Fe,value:Fe.find(e=>e.value===a.jsonData.graphiteType),width:8,onChange:Object(n.onUpdateDatasourceJsonDataOptionSelect)(this.props,"graphiteType")})]})}),a.jsonData.graphiteType===v.Metrictank&&Object(fe.jsx)("div",{className:"gf-form-inline",children:Object(fe.jsx)("div",{className:"gf-form",children:Object(fe.jsx)(De,{label:"Rollup indicator",labelClass:"width-10",tooltip:"Shows up as an info icon in panel headers when data is aggregated",checked:!!a.jsonData.rollupIndicatorEnabled,onChange:Object(n.onUpdateDatasourceJsonDataOptionChecked)(this.props,"rollupIndicatorEnabled")})})})]}),Object(fe.jsx)(be,{mappings:((null===(e=a.jsonData.importConfiguration)||void 0===e||null===(t=e.loki)||void 0===t?void 0:t.mappings)||[]).map(je),showHelp:this.state.showMappingsHelp,onDismiss:()=>{this.setState({showMappingsHelp:!1}),Pe.a.setObject(Me,!1)},onRestoreHelp:()=>{this.setState({showMappingsHelp:!0}),Pe.a.setObject(Me,!0)},onChange:e=>{r(Te({},a,{jsonData:Te({},a.jsonData,{importConfiguration:Te({},a.jsonData.importConfiguration,{loki:{mappings:e.map(ve)}})})}))}})]})}get currentGraphiteVersion(){return this.props.options.jsonData.graphiteVersion||I}}var ke,Ne,Ae,Ee,$e,Ge=a("vF1F"),_e=a("ZFWI");class Be extends ge.PureComponent{renderMeta(e,t){var a;const r=Re(),s=w(e["schema-retentions"]),i=x([e]),o=S([e]),m=(null!==(a=e["consolidator-normfetch"])&&void 0!==a?a:"").replace("Consolidator",""),c=s.reduce((e,t)=>e+(t.retention?n.rangeUtil.intervalToSeconds(t.retention):0),0);return Object(fe.jsxs)("div",{className:r.metaItem,children:[Object(fe.jsxs)("div",{className:r.metaItemHeader,children:["Schema: ",e["schema-name"],Object(fe.jsxs)("div",{className:"small muted",children:["Series count: ",e.count]})]}),Object(fe.jsxs)("div",{className:r.metaItemBody,children:[Object(fe.jsxs)("div",{className:r.step,children:[Object(fe.jsx)("div",{className:r.stepHeading,children:"Step 1: Fetch"}),Object(fe.jsx)("div",{className:r.stepDescription,children:"First data is fetched, either from raw data archive or a rollup archive"}),i&&Object(fe.jsx)("p",{children:i.text}),!i&&(ke||(ke=Object(fe.jsx)("p",{children:"No rollup archive was used"}))),Object(fe.jsx)("div",{children:s.map((t,a)=>{const s=(t.retention?n.rangeUtil.intervalToSeconds(t.retention):0)/c*100,i=a===e["archive-read"];return Object(fe.jsxs)("div",{className:r.bucket,children:[Object(fe.jsx)("div",{className:r.bucketInterval,children:t.interval}),Object(fe.jsx)("div",{className:Object(Ge.cx)(r.bucketRetention,{[r.bucketRetentionActive]:i}),style:{flexGrow:s}}),Object(fe.jsx)("div",{style:{flexGrow:100-s},children:t.retention})]},t.retention)})})]}),Object(fe.jsxs)("div",{className:r.step,children:[Object(fe.jsx)("div",{className:r.stepHeading,children:"Step 2: Normalization"}),Object(fe.jsx)("div",{className:r.stepDescription,children:"Normalization happens when series with different intervals between points are combined."}),e["aggnum-norm"]>1&&Object(fe.jsxs)("p",{children:["Normalization did occur using ",m]}),1===e["aggnum-norm"]&&(Ne||(Ne=Object(fe.jsx)("p",{children:"No normalization was needed"})))]}),Object(fe.jsxs)("div",{className:r.step,children:[Object(fe.jsx)("div",{className:r.stepHeading,children:"Step 3: Runtime consolidation"}),Object(fe.jsx)("div",{className:r.stepDescription,children:"If there are too many data points at this point Metrictank will consolidate them down to below max data points (set in queries tab)."}),o&&Object(fe.jsx)("p",{children:o.text}),!o&&(Ae||(Ae=Object(fe.jsx)("p",{children:"No runtime consolidation"})))]})]})]},t)}render(){const{data:e}=this.props,t={};for(const a of e)if(a.meta&&a.meta.custom)for(const e of a.meta.custom.seriesMetaList){const a=""+JSON.stringify(e);t[a]?t[a].count+=e.count:t[a]=e}return 0===Object.keys(t).length?Ee||(Ee=Object(fe.jsx)("div",{children:"No response meta data"})):Object(fe.jsxs)("div",{children:[$e||($e=Object(fe.jsx)("h2",{className:"page-heading",children:"Metrictank Lineage"})),Object.keys(t).map(e=>this.renderMeta(t[e],e))]})}}const Re=Object(he.stylesFactory)(()=>{const{theme:e}=_e.a,t=e.isDark?e.palette.gray25:e.palette.gray85,a=e.isDark?e.palette.dark1:e.palette.white,r=e.isDark?e.palette.gray15:e.palette.gray85;return{metaItem:Ge.css`
      background: ${a};
      border: 1px solid ${t};
      margin-bottom: ${e.spacing.md};
    `,metaItemHeader:Ge.css`
      background: ${r};
      padding: ${e.spacing.xs} ${e.spacing.md};
      font-size: ${e.typography.size.md};
      display: flex;
      justify-content: space-between;
    `,metaItemBody:Ge.css`
      padding: ${e.spacing.md};
    `,stepHeading:Ge.css`
      font-size: ${e.typography.size.md};
    `,stepDescription:Ge.css`
      font-size: ${e.typography.size.sm};
      color: ${e.colors.textWeak};
      margin-bottom: ${e.spacing.sm};
    `,step:Ge.css`
      margin-bottom: ${e.spacing.lg};

      &:last-child {
        margin-bottom: 0;
      }
    `,bucket:Ge.css`
      display: flex;
      margin-bottom: ${e.spacing.sm};
      border-radius: ${e.border.radius.md};
    `,bucketInterval:Ge.css`
      flex-grow: 0;
      width: 60px;
    `,bucketRetention:Ge.css`
      background: linear-gradient(0deg, ${e.palette.blue85}, ${e.palette.blue95});
      text-align: center;
      color: ${e.palette.white};
      margin-right: ${e.spacing.md};
      border-radius: ${e.border.radius.md};
    `,bucketRetentionActive:Ge.css`
      background: linear-gradient(0deg, ${e.palette.greenBase}, ${e.palette.greenShade});
    `}});a.d(t,"plugin",(function(){return We}));class Ve{}var ze,Le,He;He="partials/annotations.editor.html",(Le="templateUrl")in(ze=Ve)?Object.defineProperty(ze,Le,{value:He,enumerable:!0,configurable:!0,writable:!0}):ze[Le]=He;const We=new n.DataSourcePlugin(A).setQueryCtrl(ie).setConfigEditor(Ie).setMetadataInspector(Be).setAnnotationQueryCtrl(Ve)}}]);
//# sourceMappingURL=graphitePlugin.807b3f41627421e0a149.js.map