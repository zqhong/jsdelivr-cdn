{"version":3,"sources":["webpack:///./public/app/features/alerting/state/actions.ts","webpack:///./public/app/features/alerting/AlertRuleList.tsx","webpack:///./public/app/features/alerting/AlertRuleItem.tsx","webpack:///./public/app/features/alerting/state/selectors.ts","webpack:///./public/app/features/alerting/AlertHowToModal.tsx"],"names":["getAlertRulesAsync","options","async","dispatch","loadAlertRules","rules","getBackendSrv","get","loadedAlertRules","togglePauseAlertRule","id","post","state","locationService","getSearchObject","toString","createNotificationChannel","data","appEvents","emit","AppEvents","alertSuccess","push","error","alertError","updateNotificationChannel","put","testNotificationChannel","getState","channel","notificationChannel","loadNotificationTypes","notificationTypes","sort","o1","o2","name","setNotificationChannels","loadNotificationChannel","notificationChannelLoaded","mapDispatchToProps","setSearchQuery","connector","connect","navModel","getNavModel","navIndex","alertRules","getAlertRuleItems","search","getSearchQuery","isLoading","AlertRuleListUnconnected","PureComponent","label","value","option","partial","publish","ShowModalReactEvent","component","AlertHowToModal","this","props","rule","paused","text","componentDidMount","fetchRules","componentDidUpdate","prevProps","queryParams","getStateFilter","render","Contents","className","placeholder","onChange","onSearchQueryChange","menuShouldPortal","stateFilters","onStateFilterChanged","config","featureToggles","ngalert","variant","href","onClick","onOpenHowTo","spacing","map","onTogglePause","hot","module","AlertRuleItem","ruleUrl","url","panelId","renderText","useCallback","highlightClassName","textToHighlight","searchWords","heading","Figure","size","stateIcon","stateClass","Meta","stateText","stateAge","info","Actions","icon","searchQuery","regex","RegExp","items","filter","item","test","onDismiss","title","isOpen","onClickBackdrop","src","alt"],"mappings":"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","file":"AlertRuleList.807b3f41627421e0a149.js","sourcesContent":["import { AppEvents } from '@grafana/data';\nimport { getBackendSrv, locationService } from '@grafana/runtime';\nimport { appEvents } from 'app/core/core';\nimport { loadAlertRules, loadedAlertRules, notificationChannelLoaded, setNotificationChannels } from './reducers';\nimport { AlertRuleDTO, NotifierDTO, ThunkResult } from 'app/types';\n\nexport function getAlertRulesAsync(options: { state: string }): ThunkResult<void> {\n  return async (dispatch) => {\n    dispatch(loadAlertRules());\n    const rules: AlertRuleDTO[] = await getBackendSrv().get('/api/alerts', options);\n    dispatch(loadedAlertRules(rules));\n  };\n}\n\nexport function togglePauseAlertRule(id: number, options: { paused: boolean }): ThunkResult<void> {\n  return async (dispatch) => {\n    await getBackendSrv().post(`/api/alerts/${id}/pause`, options);\n    const stateFilter = locationService.getSearchObject().state || 'all';\n    dispatch(getAlertRulesAsync({ state: stateFilter.toString() }));\n  };\n}\n\nexport function createNotificationChannel(data: any): ThunkResult<void> {\n  return async (dispatch) => {\n    try {\n      await getBackendSrv().post(`/api/alert-notifications`, data);\n      appEvents.emit(AppEvents.alertSuccess, ['Notification created']);\n      locationService.push('/alerting/notifications');\n    } catch (error) {\n      appEvents.emit(AppEvents.alertError, [error.data.error]);\n    }\n  };\n}\n\nexport function updateNotificationChannel(data: any): ThunkResult<void> {\n  return async (dispatch) => {\n    try {\n      await getBackendSrv().put(`/api/alert-notifications/${data.id}`, data);\n      appEvents.emit(AppEvents.alertSuccess, ['Notification updated']);\n    } catch (error) {\n      appEvents.emit(AppEvents.alertError, [error.data.error]);\n    }\n  };\n}\n\nexport function testNotificationChannel(data: any): ThunkResult<void> {\n  return async (dispatch, getState) => {\n    const channel = getState().notificationChannel.notificationChannel;\n    await getBackendSrv().post('/api/alert-notifications/test', { id: channel.id, ...data });\n  };\n}\n\nexport function loadNotificationTypes(): ThunkResult<void> {\n  return async (dispatch) => {\n    const alertNotifiers: NotifierDTO[] = await getBackendSrv().get(`/api/alert-notifiers`);\n\n    const notificationTypes = alertNotifiers.sort((o1, o2) => {\n      if (o1.name > o2.name) {\n        return 1;\n      }\n      return -1;\n    });\n\n    dispatch(setNotificationChannels(notificationTypes));\n  };\n}\n\nexport function loadNotificationChannel(id: number): ThunkResult<void> {\n  return async (dispatch) => {\n    await dispatch(loadNotificationTypes());\n    const notificationChannel = await getBackendSrv().get(`/api/alert-notifications/${id}`);\n    dispatch(notificationChannelLoaded(notificationChannel));\n  };\n}\n","import React, { PureComponent } from 'react';\nimport { hot } from 'react-hot-loader';\nimport { connect, ConnectedProps } from 'react-redux';\nimport Page from 'app/core/components/Page/Page';\nimport AlertRuleItem from './AlertRuleItem';\nimport appEvents from 'app/core/app_events';\nimport { getNavModel } from 'app/core/selectors/navModel';\nimport { AlertRule, StoreState } from 'app/types';\nimport { getAlertRulesAsync, togglePauseAlertRule } from './state/actions';\nimport { getAlertRuleItems, getSearchQuery } from './state/selectors';\nimport { FilterInput } from 'app/core/components/FilterInput/FilterInput';\nimport { SelectableValue } from '@grafana/data';\nimport { config, locationService } from '@grafana/runtime';\nimport { setSearchQuery } from './state/reducers';\nimport { Button, LinkButton, Select, VerticalGroup } from '@grafana/ui';\nimport { GrafanaRouteComponentProps } from 'app/core/navigation/types';\nimport { ShowModalReactEvent } from '../../types/events';\nimport { AlertHowToModal } from './AlertHowToModal';\n\nfunction mapStateToProps(state: StoreState) {\n  return {\n    navModel: getNavModel(state.navIndex, 'alert-list'),\n    alertRules: getAlertRuleItems(state),\n    search: getSearchQuery(state.alertRules),\n    isLoading: state.alertRules.isLoading,\n  };\n}\n\nconst mapDispatchToProps = {\n  getAlertRulesAsync,\n  setSearchQuery,\n  togglePauseAlertRule,\n};\n\nconst connector = connect(mapStateToProps, mapDispatchToProps);\n\ninterface OwnProps extends GrafanaRouteComponentProps<{}, { state: string }> {}\n\nexport type Props = OwnProps & ConnectedProps<typeof connector>;\n\nexport class AlertRuleListUnconnected extends PureComponent<Props> {\n  stateFilters = [\n    { label: 'All', value: 'all' },\n    { label: 'OK', value: 'ok' },\n    { label: 'Not OK', value: 'not_ok' },\n    { label: 'Alerting', value: 'alerting' },\n    { label: 'No data', value: 'no_data' },\n    { label: 'Paused', value: 'paused' },\n    { label: 'Pending', value: 'pending' },\n  ];\n\n  componentDidMount() {\n    this.fetchRules();\n  }\n\n  componentDidUpdate(prevProps: Props) {\n    if (prevProps.queryParams.state !== this.props.queryParams.state) {\n      this.fetchRules();\n    }\n  }\n\n  async fetchRules() {\n    await this.props.getAlertRulesAsync({ state: this.getStateFilter() });\n  }\n\n  getStateFilter(): string {\n    return this.props.queryParams.state ?? 'all';\n  }\n\n  onStateFilterChanged = (option: SelectableValue) => {\n    locationService.partial({ state: option.value });\n  };\n\n  onOpenHowTo = () => {\n    appEvents.publish(new ShowModalReactEvent({ component: AlertHowToModal }));\n  };\n\n  onSearchQueryChange = (value: string) => {\n    this.props.setSearchQuery(value);\n  };\n\n  onTogglePause = (rule: AlertRule) => {\n    this.props.togglePauseAlertRule(rule.id, { paused: rule.state !== 'paused' });\n  };\n\n  alertStateFilterOption = ({ text, value }: { text: string; value: string }) => {\n    return (\n      <option key={value} value={value}>\n        {text}\n      </option>\n    );\n  };\n\n  render() {\n    const { navModel, alertRules, search, isLoading } = this.props;\n\n    return (\n      <Page navModel={navModel}>\n        <Page.Contents isLoading={isLoading}>\n          <div className=\"page-action-bar\">\n            <div className=\"gf-form gf-form--grow\">\n              <FilterInput placeholder=\"Search alerts\" value={search} onChange={this.onSearchQueryChange} />\n            </div>\n            <div className=\"gf-form\">\n              <label className=\"gf-form-label\">States</label>\n\n              <div className=\"width-13\">\n                <Select\n                  menuShouldPortal\n                  options={this.stateFilters}\n                  onChange={this.onStateFilterChanged}\n                  value={this.getStateFilter()}\n                />\n              </div>\n            </div>\n            <div className=\"page-action-bar__spacer\" />\n            {config.featureToggles.ngalert && (\n              <LinkButton variant=\"primary\" href=\"alerting/ng/new\">\n                Add NG Alert\n              </LinkButton>\n            )}\n            <Button variant=\"secondary\" onClick={this.onOpenHowTo}>\n              How to add an alert\n            </Button>\n          </div>\n          <VerticalGroup spacing=\"none\">\n            {alertRules.map((rule) => {\n              return (\n                <AlertRuleItem\n                  rule={rule as AlertRule}\n                  key={rule.id}\n                  search={search}\n                  onTogglePause={() => this.onTogglePause(rule as AlertRule)}\n                />\n              );\n            })}\n          </VerticalGroup>\n        </Page.Contents>\n      </Page>\n    );\n  }\n}\n\nexport default hot(module)(connector(AlertRuleListUnconnected));\n","import React, { useCallback } from 'react';\n// @ts-ignore\nimport Highlighter from 'react-highlight-words';\nimport { Icon, IconName, Button, LinkButton, Card } from '@grafana/ui';\nimport { AlertRule } from '../../types';\n\nexport interface Props {\n  rule: AlertRule;\n  search: string;\n  onTogglePause: () => void;\n}\n\nconst AlertRuleItem = ({ rule, search, onTogglePause }: Props) => {\n  const ruleUrl = `${rule.url}?editPanel=${rule.panelId}&tab=alert`;\n  const renderText = useCallback(\n    (text) => (\n      <Highlighter\n        key={text}\n        highlightClassName=\"highlight-search-match\"\n        textToHighlight={text}\n        searchWords={[search]}\n      />\n    ),\n    [search]\n  );\n\n  return (\n    <Card heading={<a href={ruleUrl}>{renderText(rule.name)}</a>}>\n      <Card.Figure>\n        <Icon size=\"xl\" name={rule.stateIcon as IconName} className={`alert-rule-item__icon ${rule.stateClass}`} />\n      </Card.Figure>\n      <Card.Meta>\n        <span key=\"state\">\n          <span key=\"text\" className={`${rule.stateClass}`}>\n            {renderText(rule.stateText)}{' '}\n          </span>\n          for {rule.stateAge}\n        </span>\n        {rule.info ? renderText(rule.info) : null}\n      </Card.Meta>\n      <Card.Actions>\n        <Button\n          key=\"play\"\n          variant=\"secondary\"\n          icon={rule.state === 'paused' ? 'play' : 'pause'}\n          onClick={onTogglePause}\n        >\n          {rule.state === 'paused' ? 'Resume' : 'Pause'}\n        </Button>\n        <LinkButton key=\"edit\" variant=\"secondary\" href={ruleUrl} icon=\"cog\">\n          Edit alert\n        </LinkButton>\n      </Card.Actions>\n    </Card>\n  );\n};\n\nexport default AlertRuleItem;\n","import { AlertRule, AlertRulesState, NotificationChannelState, StoreState } from 'app/types';\n\nexport const getSearchQuery = (state: AlertRulesState) => state.searchQuery;\n\nexport const getAlertRuleItems = (state: StoreState): AlertRule[] => {\n  const regex = new RegExp(state.alertRules.searchQuery, 'i');\n\n  return state.alertRules.items.filter((item) => {\n    return regex.test(item.name) || regex.test(item.stateText) || regex.test(item.info!);\n  });\n};\n\nexport const getNotificationChannel = (state: NotificationChannelState, channelId: number) => {\n  if (state.notificationChannel.id === channelId) {\n    return state.notificationChannel;\n  }\n\n  return null;\n};\n","import { Modal, VerticalGroup } from '@grafana/ui';\nimport React from 'react';\n\nexport interface AlertHowToModalProps {\n  onDismiss: () => void;\n}\n\nexport function AlertHowToModal({ onDismiss }: AlertHowToModalProps): JSX.Element {\n  return (\n    <Modal title=\"Adding an Alert\" isOpen onDismiss={onDismiss} onClickBackdrop={onDismiss}>\n      <VerticalGroup spacing=\"sm\">\n        <img src=\"public/img/alert_howto_new.png\" alt=\"link to how to alert image\" />\n        <p>\n          Alerts are added and configured in the Alert tab of any dashboard graph panel, letting you build and visualize\n          an alert using existing queries.\n        </p>\n        <p>Remember to save the dashboard to persist your alert rule changes.</p>\n      </VerticalGroup>\n    </Modal>\n  );\n}\n"],"sourceRoot":""}